\hypertarget{a02421_source}{}\doxysection{finiteelements/mechanics/kirchhoffloveshell.hh}
\label{a02421_source}\index{kirchhoffloveshell.hh@{kirchhoffloveshell.hh}}
\mbox{\hyperlink{a02421}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/localfefunctions/cachedlocalBasis/cachedlocalBasis.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00113}{ikarus/finiteelements/febases/powerbasisfe.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00125}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00158}{ikarus/finiteelements/mechanics/materials.hh}}>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00119}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00295}{Ikarus}} \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{38   \textcolor{keyword}{template} <\textcolor{keyword}{class} ScalarType>}
\DoxyCodeLine{39   ScalarType \mbox{\hyperlink{a00295_a10529d3a284b885b2f89440faa693877}{energyHelper}}(\textcolor{keyword}{const} Eigen::Vector<ScalarType, 3>\& epsV, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Aconv, \textcolor{keywordtype}{double} E, \textcolor{keywordtype}{double} nu) \{}
\DoxyCodeLine{40     \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambda   = E * nu / ((1.0 + nu) * (1.0 -\/ 2.0 * nu));}
\DoxyCodeLine{41     \textcolor{keyword}{const} \textcolor{keywordtype}{double} mu       = E / (2.0 * (1.0 + nu));}
\DoxyCodeLine{42     \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambdbar = 2.0 * lambda * mu / (lambda + 2.0 * mu);}
\DoxyCodeLine{43     Eigen::TensorFixedSize<double, Eigen::Sizes<3, 3, 3, 3>> moduli;}
\DoxyCodeLine{44     \textcolor{keyword}{const} \textcolor{keyword}{auto} AconvT = \mbox{\hyperlink{a00291_ga5cfd9d098384fb067d897b3c0499b447}{tensorView}}(Aconv, std::array<Eigen::Index, 2>(\{3, 3\}));}
\DoxyCodeLine{45     moduli            = lambdbar * \mbox{\hyperlink{a00291_gab2cea9ac847cc3635812467c9d96ceb4}{dyadic}}(AconvT, AconvT).eval() + 2 * mu * symmetricFourthOrder<double>(Aconv, Aconv);}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \textcolor{keyword}{auto} C   = \mbox{\hyperlink{a00291_ga4304655095296ce9283e012587817a51}{toVoigt}}(moduli);}
\DoxyCodeLine{48     \textcolor{keyword}{auto} C33 = C(\{0, 1, 5\}, \{0, 1, 5\}).eval();}
\DoxyCodeLine{49     \textcolor{keywordflow}{return} 0.5 * epsV.dot(C33 * epsV);}
\DoxyCodeLine{50   \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{63   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Basis\_, \textcolor{keyword}{typename} FERequirements\_ = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false>}
\DoxyCodeLine{64   \textcolor{keyword}{class }\mbox{\hyperlink{a01262}{KirchhoffLoveShell}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01194}{PowerBasisFE}}<typename Basis\_::FlatBasis> \{}
\DoxyCodeLine{65   \textcolor{keyword}{public}:}
\DoxyCodeLine{66     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_aff08f23fc6273613460eb026e8600b55}{Basis}}                   = Basis\_;}
\DoxyCodeLine{67     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_a01bddbf8b0a84653e765e254592cbe1c}{FlatBasis}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01418_ab9e57abdb5f4abeb030f6122df75849e}{Basis::FlatBasis}};}
\DoxyCodeLine{68     \textcolor{keyword}{using }\mbox{\hyperlink{a01194}{BasePowerFE}}             = \mbox{\hyperlink{a01194}{PowerBasisFE<FlatBasis>}};  \textcolor{comment}{// Handles globalIndices function}}
\DoxyCodeLine{69     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}       = FERequirements\_;}
\DoxyCodeLine{70     \textcolor{keyword}{using }\mbox{\hyperlink{a01230}{ResultRequirementsType}}  = \mbox{\hyperlink{a01230}{ResultRequirements<FERequirementType>}};}
\DoxyCodeLine{71     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_a1c7174db95cf392d498ed6a79e54004a}{LocalView}}               = \textcolor{keyword}{typename} FlatBasis::LocalView;}
\DoxyCodeLine{72     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_a665a7d8755b3ca37133a8fdfecbb5e53}{Element}}                 = \textcolor{keyword}{typename} LocalView::Element;}
\DoxyCodeLine{73     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_a53ff5e7dfc6018836c490d40160fa901}{Geometry}}                = \textcolor{keyword}{typename} Element::Geometry;}
\DoxyCodeLine{74     \textcolor{keyword}{using }\mbox{\hyperlink{a01262_ab0f57da5f1f7d65ae88278f4ee6e8870}{GridView}}                = \textcolor{keyword}{typename} FlatBasis::GridView;}
\DoxyCodeLine{75     \textcolor{keyword}{using }\mbox{\hyperlink{a01298}{Traits}}                  = \mbox{\hyperlink{a01298}{TraitsFromLocalView<LocalView, useEigenRef>}};}
\DoxyCodeLine{76     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01262_a22273fa4834535f534e9dfab377aec83}{myDim}}    = \mbox{\hyperlink{a01298_ab29f61e7d71697962fe41642d683f9f5}{Traits::mydim}};}
\DoxyCodeLine{77     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01262_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} = \mbox{\hyperlink{a01298_a47ccda97cc8e04f87be6d2c3a165ba98}{Traits::worlddim}};}
\DoxyCodeLine{78 }
\DoxyCodeLine{95     \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{96     \mbox{\hyperlink{a01262_ae749b820da13eb29aafad5f0b704ea39}{KirchhoffLoveShell}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01262_aff08f23fc6273613460eb026e8600b55}{Basis}}\& globalBasis, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keywordtype}{double} emod, \textcolor{keywordtype}{double} nu,}
\DoxyCodeLine{97                        \textcolor{keywordtype}{double} thickness, VolumeLoad p\_volumeLoad = \{\},}
\DoxyCodeLine{98                        \textcolor{keyword}{const} BoundaryPatch<GridView>* p\_neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{99                        NeumannBoundaryLoad p\_neumannBoundaryLoad        = \{\})}
\DoxyCodeLine{100         : \mbox{\hyperlink{a01262_aeaf83b598c252b329eca52e852768e0c}{BasePowerFE}}(globalBasis.flat(), element),}
\DoxyCodeLine{101           \mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}\{p\_neumannBoundary\},}
\DoxyCodeLine{102           \mbox{\hyperlink{a01262_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}}\{emod\},}
\DoxyCodeLine{103           \mbox{\hyperlink{a01262_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}}\{nu\},}
\DoxyCodeLine{104           \mbox{\hyperlink{a01262_aa055b97524c73a6917b026571f3de686}{thickness\_}}\{thickness\} \{}
\DoxyCodeLine{105       this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().bind(element);}
\DoxyCodeLine{106       \textcolor{keyword}{auto}\& first\_child = this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(0);}
\DoxyCodeLine{107       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe    = first\_child.finiteElement();}
\DoxyCodeLine{108       \mbox{\hyperlink{a01262_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}     = fe.size();}
\DoxyCodeLine{109       \mbox{\hyperlink{a01262_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}}.resize(fe.size());}
\DoxyCodeLine{110       \mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}      = 2 * (fe.localBasis().order());}
\DoxyCodeLine{111       \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}} = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{112       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().getQuadratureRule(\mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}); \})}
\DoxyCodeLine{113         \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{114           \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(this-\/>localView().element().impl().getQuadratureRule(\mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}), Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{115         \textcolor{keywordflow}{else}}
\DoxyCodeLine{116           \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), \mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}),}
\DoxyCodeLine{117                           Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{118       \textcolor{keywordflow}{else}}
\DoxyCodeLine{119         \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), \mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}),}
\DoxyCodeLine{120                         Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{121 }
\DoxyCodeLine{122       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!std::is\_same\_v<VolumeLoad, utils::LoadDefault>) \mbox{\hyperlink{a01262_a313ee03a124d29ac3d5c758e206321d3}{volumeLoad}} = p\_volumeLoad;}
\DoxyCodeLine{123       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!std::is\_same\_v<NeumannBoundaryLoad, utils::LoadDefault>)}
\DoxyCodeLine{124         \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}} = p\_neumannBoundaryLoad;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126       assert(((not p\_neumannBoundary and not \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}}) or (p\_neumannBoundary and \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}}))}
\DoxyCodeLine{127              \&\& \textcolor{stringliteral}{"{}If you pass a Neumann boundary you should also pass the function for the Neumann load!"{}});}
\DoxyCodeLine{128     \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   \textcolor{keyword}{public}:}
\DoxyCodeLine{141     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{142     \textcolor{keyword}{auto} \mbox{\hyperlink{a01262_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01262_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par,}
\DoxyCodeLine{143                                  \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{144       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00282_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{145 }
\DoxyCodeLine{146       Dune::BlockVector<Dune::RealTuple<ScalarType, Traits::worlddim>> disp(\mbox{\hyperlink{a01262_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}}.size());}
\DoxyCodeLine{147       \textcolor{keywordflow}{if} (dx)}
\DoxyCodeLine{148         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < disp.size(); ++i)}
\DoxyCodeLine{149           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < \mbox{\hyperlink{a01262_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}}; ++k2)}
\DoxyCodeLine{150             disp[i][k2] = dx.value()[i * \mbox{\hyperlink{a01262_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} + k2]}
\DoxyCodeLine{151                           + d[this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().index(this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{152       \textcolor{keywordflow}{else}}
\DoxyCodeLine{153         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < disp.size(); ++i)}
\DoxyCodeLine{154           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < \mbox{\hyperlink{a01262_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}}; ++k2)}
\DoxyCodeLine{155             disp[i][k2] = d[this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().index(this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{156 }
\DoxyCodeLine{157       \textcolor{keyword}{auto} geo = std::make\_shared<const typename GridView::GridView::template Codim<0>::Entity::Geometry>(}
\DoxyCodeLine{158           this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry());}
\DoxyCodeLine{159       Dune::StandardLocalFunction uFunction(\mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, disp, geo);}
\DoxyCodeLine{160       \textcolor{keywordflow}{return} std::make\_pair(uFunction, disp);}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{171     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01262_adc2c303a601a1100fbe0a6f7987e0d8e}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01262_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(par); \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{183     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01262_aadd4c3a051e2c530a9fa5ebb86417141}{calculateAt}}([[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01230}{ResultRequirementsType}}\& req,}
\DoxyCodeLine{184                      [[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01330}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{185                      [[maybe\_unused]] \mbox{\hyperlink{a01226}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{186       DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}No results are implemented"{}});}
\DoxyCodeLine{187     \}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     Dune::CachedLocalBasis<}
\DoxyCodeLine{190         std::remove\_cvref\_t<decltype(std::declval<LocalView>().tree().child(0).finiteElement().localBasis())>>}
\DoxyCodeLine{191         \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}};}
\DoxyCodeLine{192     std::function<Eigen::Vector<double, Traits::worlddim>(\textcolor{keyword}{const} Eigen::Vector<double, Traits::worlddim>\&,}
\DoxyCodeLine{193                                                           \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>}
\DoxyCodeLine{194         \mbox{\hyperlink{a01262_a313ee03a124d29ac3d5c758e206321d3}{volumeLoad}};}
\DoxyCodeLine{195     std::function<Eigen::Vector<double, Traits::worlddim>(\textcolor{keyword}{const} Eigen::Vector<double, Traits::worlddim>\&,}
\DoxyCodeLine{196                                                           \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>}
\DoxyCodeLine{197         \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}};}
\DoxyCodeLine{198     \textcolor{keyword}{const} BoundaryPatch<GridView>* \mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}};}
\DoxyCodeLine{199     \textcolor{keyword}{mutable} Dune::BlockVector<Dune::RealTuple<double, Traits::dimension>> \mbox{\hyperlink{a01262_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}};}
\DoxyCodeLine{200     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01262_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}};}
\DoxyCodeLine{201     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01262_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}};}
\DoxyCodeLine{202     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01262_aa055b97524c73a6917b026571f3de686}{thickness\_}};}
\DoxyCodeLine{203     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01262_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}\{0\};}
\DoxyCodeLine{204     \textcolor{keywordtype}{int} \mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}}\{\};}
\DoxyCodeLine{205 }
\DoxyCodeLine{206   \textcolor{keyword}{protected}:}
\DoxyCodeLine{218     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{219     \textcolor{keyword}{auto} \mbox{\hyperlink{a01262_a83c5d12a0591fce31bc29ea903156863}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01262_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par, \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx}
\DoxyCodeLine{220                                                            = std::nullopt) \textcolor{keyword}{const} -\/> ScalarType \{}
\DoxyCodeLine{221       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{222       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00299}{Dune}};}
\DoxyCodeLine{223       \textcolor{keyword}{const} \textcolor{keyword}{auto} [uFunction, uNodes] = \mbox{\hyperlink{a01262_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(par, dx);}
\DoxyCodeLine{224       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda             = par.getParameter(\mbox{\hyperlink{a00282_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{225       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo                 = this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry();}
\DoxyCodeLine{226       ScalarType energy              = 0.0;}
\DoxyCodeLine{227       \textcolor{keyword}{const} \textcolor{keyword}{auto} uasMatrix           = \mbox{\hyperlink{a00290_gaf9d7cf401f9f03ce1aae728c646ce178}{Dune::viewAsEigenMatrixAsDynFixed}}(uNodes);}
\DoxyCodeLine{228 }
\DoxyCodeLine{229       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{230         \textcolor{keyword}{const} \textcolor{keyword}{auto} [X, Jd, Hd]                      = geo.impl().zeroFirstAndSecondDerivativeOfPosition(gp.position());}
\DoxyCodeLine{231         \textcolor{keyword}{const} \textcolor{keyword}{auto} J                                = toEigen(Jd);}
\DoxyCodeLine{232         \textcolor{keyword}{const} \textcolor{keyword}{auto} H                                = toEigen(Hd);}
\DoxyCodeLine{233         \textcolor{keyword}{const} Eigen::Matrix<double, 2, 2> A         = J * J.transpose();}
\DoxyCodeLine{234         \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 2> gradu = toEigen(}
\DoxyCodeLine{235             uFunction.evaluateDerivative(gpIndex, wrt(spatialAll), Dune::on(DerivativeDirections::referenceElement)));}
\DoxyCodeLine{236         \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 2, 3> j = J + gradu.transpose();}
\DoxyCodeLine{237 }
\DoxyCodeLine{238         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd                     = \mbox{\hyperlink{a01262_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{239         \textcolor{keyword}{const} \textcolor{keyword}{auto} h                        = H + Ndd.transpose().template cast<ScalarType>() * uasMatrix;}
\DoxyCodeLine{240         \textcolor{keyword}{const} Eigen::Vector3<ScalarType> a3 = (j.row(0).cross(j.row(1))).normalized();}
\DoxyCodeLine{241         Eigen::Vector<ScalarType, 3> bV     = h * a3;}
\DoxyCodeLine{242         bV(2) *= 2;  \textcolor{comment}{// Voigt notation requires the two here}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244         Eigen::Matrix<double, 3, 3> G;}
\DoxyCodeLine{245         G.setZero();}
\DoxyCodeLine{246         G.block<2, 2>(0, 0)                    = A;}
\DoxyCodeLine{247         G(2, 2)                                = 1;}
\DoxyCodeLine{248         \textcolor{keyword}{const} Eigen::Matrix<double, 3, 3> GInv = G.inverse();}
\DoxyCodeLine{249 }
\DoxyCodeLine{250         \textcolor{keyword}{const} \textcolor{keyword}{auto} epsV                 = \mbox{\hyperlink{a00291_ga4304655095296ce9283e012587817a51}{toVoigt}}((0.5 * (j * j.transpose() -\/ A)).eval()).eval();}
\DoxyCodeLine{251         \textcolor{keyword}{const} \textcolor{keyword}{auto} BV                   = \mbox{\hyperlink{a00291_ga4304655095296ce9283e012587817a51}{toVoigt}}(toEigen(geo.impl().secondFundamentalForm(gp.position())));}
\DoxyCodeLine{252         \textcolor{keyword}{const} \textcolor{keyword}{auto} kappaV               = (BV -\/ bV).eval();}
\DoxyCodeLine{253         \textcolor{keyword}{const} ScalarType membraneEnergy = \mbox{\hyperlink{a01262_aa055b97524c73a6917b026571f3de686}{thickness\_}} * \mbox{\hyperlink{a00295_a10529d3a284b885b2f89440faa693877}{energyHelper}}(epsV, GInv, \mbox{\hyperlink{a01262_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}}, \mbox{\hyperlink{a01262_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}});}
\DoxyCodeLine{254         \textcolor{keyword}{const} ScalarType bendingEnergy  = Dune::power(\mbox{\hyperlink{a01262_aa055b97524c73a6917b026571f3de686}{thickness\_}}, 3) / 12.0 * \mbox{\hyperlink{a00295_a10529d3a284b885b2f89440faa693877}{energyHelper}}(kappaV, GInv, \mbox{\hyperlink{a01262_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}}, \mbox{\hyperlink{a01262_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}});}
\DoxyCodeLine{255         energy += (membraneEnergy + bendingEnergy) * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{256       \}}
\DoxyCodeLine{257 }
\DoxyCodeLine{258       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01262_a313ee03a124d29ac3d5c758e206321d3}{volumeLoad}}) \{}
\DoxyCodeLine{259         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{260           \textcolor{keyword}{const} \textcolor{keyword}{auto} u                                       = uFunction.evaluate(gpIndex);}
\DoxyCodeLine{261           \textcolor{keyword}{const} Eigen::Vector<double, Traits::worlddim> fExt = \mbox{\hyperlink{a01262_a313ee03a124d29ac3d5c758e206321d3}{volumeLoad}}(toEigen(geo.global(gp.position())), lambda);}
\DoxyCodeLine{262           energy -\/= u.dot(fExt) * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{263         \}}
\DoxyCodeLine{264       \}}
\DoxyCodeLine{265 }
\DoxyCodeLine{266       \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{267       \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} and not \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}}) \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{268 }
\DoxyCodeLine{269       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& element = this-\/>\mbox{\hyperlink{a01194_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element();}
\DoxyCodeLine{270       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& intersection : intersections(\mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>gridView(), element)) \{}
\DoxyCodeLine{271         \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} or not \mbox{\hyperlink{a01262_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>contains(intersection)) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{272 }
\DoxyCodeLine{273         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& quadLine = Dune::QuadratureRules<double, Traits::mydim -\/ 1>::rule(intersection.type(), \mbox{\hyperlink{a01262_a63b27f61b7f57f12671618edf3ef99ef}{order}});}
\DoxyCodeLine{274 }
\DoxyCodeLine{275         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& curQuad : quadLine) \{}
\DoxyCodeLine{276           \textcolor{comment}{// Local position of the quadrature point}}
\DoxyCodeLine{277           \textcolor{keyword}{const} \mbox{\hyperlink{a01330}{Dune::FieldVector<double, Traits::mydim>}}\& quadPos}
\DoxyCodeLine{278               = intersection.geometryInInside().global(curQuad.position());}
\DoxyCodeLine{279 }
\DoxyCodeLine{280           \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = intersection.geometry().integrationElement(curQuad.position());}
\DoxyCodeLine{281 }
\DoxyCodeLine{282           \textcolor{comment}{// The value of the local function}}
\DoxyCodeLine{283           \textcolor{keyword}{const} \textcolor{keyword}{auto} u = uFunction.evaluate(quadPos);}
\DoxyCodeLine{284 }
\DoxyCodeLine{285           \textcolor{comment}{// Value of the Neumann data at the current position}}
\DoxyCodeLine{286           \textcolor{keyword}{const} \textcolor{keyword}{auto} neumannValue}
\DoxyCodeLine{287               = \mbox{\hyperlink{a01262_a563abc01ddb7619f4ceea05a8b308284}{neumannBoundaryLoad}}(toEigen(intersection.geometry().global(curQuad.position())), lambda);}
\DoxyCodeLine{288           energy -\/= neumannValue.dot(u) * curQuad.weight() * intElement;}
\DoxyCodeLine{289         \}}
\DoxyCodeLine{290       \}}
\DoxyCodeLine{291 }
\DoxyCodeLine{292       \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{293     \}}
\DoxyCodeLine{294   \};}
\DoxyCodeLine{295 \}  \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
