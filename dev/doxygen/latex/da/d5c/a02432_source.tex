\hypertarget{a02432_source}{}\doxysection{finiteelements/mechanics/kirchhoffloveshell.hh}
\label{a02432_source}\index{kirchhoffloveshell.hh@{kirchhoffloveshell.hh}}
\mbox{\hyperlink{a02432}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/localfefunctions/cachedlocalBasis/cachedlocalBasis.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00113}{ikarus/finiteelements/febases/powerbasisfe.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00125}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00158}{ikarus/finiteelements/mechanics/materials.hh}}>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00164}{ikarus/finiteelements/mechanics/membranestrains.hh}}>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00119}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00298}{Ikarus}} \{}
\DoxyCodeLine{24 }
\DoxyCodeLine{36   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Basis\_, \textcolor{keyword}{typename} FERequirements\_ = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false>}
\DoxyCodeLine{37   \textcolor{keyword}{class }\mbox{\hyperlink{a01265}{KirchhoffLoveShell}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01197}{PowerBasisFE}}<typename Basis\_::FlatBasis> \{}
\DoxyCodeLine{38   \textcolor{keyword}{public}:}
\DoxyCodeLine{39     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_aff08f23fc6273613460eb026e8600b55}{Basis}}                             = Basis\_;}
\DoxyCodeLine{40     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_a01bddbf8b0a84653e765e254592cbe1c}{FlatBasis}}                         = \textcolor{keyword}{typename} \mbox{\hyperlink{a01429_ab9e57abdb5f4abeb030f6122df75849e}{Basis::FlatBasis}};}
\DoxyCodeLine{41     \textcolor{keyword}{using }\mbox{\hyperlink{a01197}{BasePowerFE}}                       = \mbox{\hyperlink{a01197}{PowerBasisFE<FlatBasis>}};  \textcolor{comment}{// Handles globalIndices function}}
\DoxyCodeLine{42     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}                 = FERequirements\_;}
\DoxyCodeLine{43     \textcolor{keyword}{using }\mbox{\hyperlink{a01233}{ResultRequirementsType}}            = \mbox{\hyperlink{a01233}{ResultRequirements<FERequirementType>}};}
\DoxyCodeLine{44     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_a1c7174db95cf392d498ed6a79e54004a}{LocalView}}                         = \textcolor{keyword}{typename} FlatBasis::LocalView;}
\DoxyCodeLine{45     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_a665a7d8755b3ca37133a8fdfecbb5e53}{Element}}                           = \textcolor{keyword}{typename} LocalView::Element;}
\DoxyCodeLine{46     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_a53ff5e7dfc6018836c490d40160fa901}{Geometry}}                          = \textcolor{keyword}{typename} Element::Geometry;}
\DoxyCodeLine{47     \textcolor{keyword}{using }\mbox{\hyperlink{a01265_ab0f57da5f1f7d65ae88278f4ee6e8870}{GridView}}                          = \textcolor{keyword}{typename} FlatBasis::GridView;}
\DoxyCodeLine{48     \textcolor{keyword}{using }\mbox{\hyperlink{a01309}{Traits}}                            = \mbox{\hyperlink{a01309}{TraitsFromLocalView<LocalView, useEigenRef>}};}
\DoxyCodeLine{49     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01265_a22273fa4834535f534e9dfab377aec83}{myDim}}              = \mbox{\hyperlink{a01309_ab29f61e7d71697962fe41642d683f9f5}{Traits::mydim}};}
\DoxyCodeLine{50     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}}           = \mbox{\hyperlink{a01309_a47ccda97cc8e04f87be6d2c3a165ba98}{Traits::worlddim}};}
\DoxyCodeLine{51     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01265_a28615c16c3294908775337438007dbff}{membraneStrainSize}} = 3;}
\DoxyCodeLine{52     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01265_aff4ce56707d43655851a80dc37f3f19b}{bendingStrainSize}}  = 3;}
\DoxyCodeLine{53 }
\DoxyCodeLine{63     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{64     \textcolor{keyword}{struct }\mbox{\hyperlink{a01269}{KinematicVariables}} \{}
\DoxyCodeLine{65       Eigen::Matrix<double, 3, 3> \mbox{\hyperlink{a01269_ad316c22f4d476201d66dd916ce51579a}{C}};      }
\DoxyCodeLine{66       Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01269_adb0ea578820d6324bd697abf0103ceaf}{epsV}};    }
\DoxyCodeLine{67       Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01269_a385e50cb48b7f29f352913ef01e857ff}{kappaV}};  }
\DoxyCodeLine{68       Eigen::Matrix<ScalarType, 2, 3> \mbox{\hyperlink{a01269_a448b848a807d314c3d9b1a07bea0cc9e}{j}};  }
\DoxyCodeLine{69       Eigen::Matrix<double, 2, 3> \mbox{\hyperlink{a01269_a0ab087b4fe7a12f7cad0a0f2f1ab6bd3}{J}};      }
\DoxyCodeLine{70       Eigen::Matrix3<ScalarType> \mbox{\hyperlink{a01269_a5afc75ec69c2154ac00733db1fe5ea6f}{h}};       }
\DoxyCodeLine{71       Eigen::Matrix3<double> \mbox{\hyperlink{a01269_ad8bae2aebefb88c7d7888b14a58e0c22}{H}};           }
\DoxyCodeLine{72       Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01269_acd947bf70bae3f7ec5f58e679b19619e}{a3N}};     }
\DoxyCodeLine{73       Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01269_a333dd0e23eb3fe1606a281a4f4620b05}{a3}};      }
\DoxyCodeLine{74     \};}
\DoxyCodeLine{75 }
\DoxyCodeLine{92     \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{93     \mbox{\hyperlink{a01265_ae749b820da13eb29aafad5f0b704ea39}{KirchhoffLoveShell}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_aff08f23fc6273613460eb026e8600b55}{Basis}}\& globalBasis, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keywordtype}{double} emod, \textcolor{keywordtype}{double} nu,}
\DoxyCodeLine{94                        \textcolor{keywordtype}{double} thickness, VolumeLoad p\_volumeLoad = \{\},}
\DoxyCodeLine{95                        \textcolor{keyword}{const} BoundaryPatch<GridView>* p\_neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{96                        NeumannBoundaryLoad p\_neumannBoundaryLoad        = \{\})}
\DoxyCodeLine{97         : \mbox{\hyperlink{a01265_aeaf83b598c252b329eca52e852768e0c}{BasePowerFE}}(globalBasis.flat(), element),}
\DoxyCodeLine{98           \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}\{p\_neumannBoundary\},}
\DoxyCodeLine{99           \mbox{\hyperlink{a01265_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}}\{emod\},}
\DoxyCodeLine{100           \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}}\{nu\},}
\DoxyCodeLine{101           \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}}\{thickness\} \{}
\DoxyCodeLine{102       this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().bind(element);}
\DoxyCodeLine{103       \textcolor{keyword}{auto}\& first\_child = this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(0);}
\DoxyCodeLine{104       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe    = first\_child.finiteElement();}
\DoxyCodeLine{105       \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}     = fe.size();}
\DoxyCodeLine{106       \mbox{\hyperlink{a01265_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}}.resize(fe.size());}
\DoxyCodeLine{107       \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}      = 2 * (fe.localBasis().order());}
\DoxyCodeLine{108       \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}} = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{109       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().getQuadratureRule(\mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}); \})}
\DoxyCodeLine{110         \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{111           \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(this-\/>localView().element().impl().getQuadratureRule(\mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}), Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{112         \textcolor{keywordflow}{else}}
\DoxyCodeLine{113           \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}),}
\DoxyCodeLine{114                           Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{115       \textcolor{keywordflow}{else}}
\DoxyCodeLine{116         \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}),}
\DoxyCodeLine{117                         Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{118 }
\DoxyCodeLine{119       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!std::is\_same\_v<VolumeLoad, utils::LoadDefault>) \mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}} = p\_volumeLoad;}
\DoxyCodeLine{120       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!std::is\_same\_v<NeumannBoundaryLoad, utils::LoadDefault>)}
\DoxyCodeLine{121         \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}} = p\_neumannBoundaryLoad;}
\DoxyCodeLine{122 }
\DoxyCodeLine{123       assert(((not p\_neumannBoundary and not \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}) or (p\_neumannBoundary and \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}))}
\DoxyCodeLine{124              \&\& \textcolor{stringliteral}{"{}If you pass a Neumann boundary you should also pass the function for the Neumann load!"{}});}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127   \textcolor{keyword}{public}:}
\DoxyCodeLine{138     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{139     \textcolor{keyword}{auto} \mbox{\hyperlink{a01265_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par,}
\DoxyCodeLine{140                                  \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{141       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00285_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{FESolutions::displacement}});}
\DoxyCodeLine{142       \textcolor{keyword}{auto} geo      = std::make\_shared<const typename GridView::GridView::template Codim<0>::Entity::Geometry>(}
\DoxyCodeLine{143           this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry());}
\DoxyCodeLine{144       Dune::BlockVector<Dune::RealTuple<ScalarType, Traits::worlddim>> disp(\mbox{\hyperlink{a01265_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}}.size());}
\DoxyCodeLine{145 }
\DoxyCodeLine{146       \textcolor{keywordflow}{if} (dx)}
\DoxyCodeLine{147         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < disp.size(); ++i)}
\DoxyCodeLine{148           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < \mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}}; ++k2)}
\DoxyCodeLine{149             disp[i][k2] = dx.value()[i * \mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} + k2]}
\DoxyCodeLine{150                           + d[this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().index(this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{151       \textcolor{keywordflow}{else}}
\DoxyCodeLine{152         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < disp.size(); ++i)}
\DoxyCodeLine{153           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < \mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}}; ++k2)}
\DoxyCodeLine{154             disp[i][k2] = d[this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().index(this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{155 }
\DoxyCodeLine{156       Dune::StandardLocalFunction uFunction(\mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, disp, geo);}
\DoxyCodeLine{157 }
\DoxyCodeLine{158       \textcolor{keywordflow}{return} uFunction;}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{169     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01265_adc4d072b60d55436de62651fb8af784d}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& req)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(req); \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{178     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01265_a1ff594b2a01b8f20a2ff9f7dfa77a763}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{179       calculateVectorImpl<double>(req, force);}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{188     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01265_abfce8179210ee09d9b86c6444adf7f62}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{189       calculateMatrixImpl<double>(req, K);}
\DoxyCodeLine{190     \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{202     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01265_aadd4c3a051e2c530a9fa5ebb86417141}{calculateAt}}([[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01233}{ResultRequirementsType}}\& req,}
\DoxyCodeLine{203                      [[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{204                      [[maybe\_unused]] \mbox{\hyperlink{a01229}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{205       DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}No results are implemented"{}});}
\DoxyCodeLine{206     \}}
\DoxyCodeLine{207 }
\DoxyCodeLine{208     Dune::CachedLocalBasis<}
\DoxyCodeLine{209         std::remove\_cvref\_t<decltype(std::declval<LocalView>().tree().child(0).finiteElement().localBasis())>>}
\DoxyCodeLine{210         \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}};}
\DoxyCodeLine{211     std::function<Eigen::Vector<double, Traits::worlddim>(\textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Dune::FieldVector<double, Traits::worlddim>}}\&,}
\DoxyCodeLine{212                                                           \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>}
\DoxyCodeLine{213         \mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}};}
\DoxyCodeLine{214     std::function<Eigen::Vector<double, Traits::worlddim>(\textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Dune::FieldVector<double, Traits::worlddim>}}\&,}
\DoxyCodeLine{215                                                           \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>}
\DoxyCodeLine{216         \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}};}
\DoxyCodeLine{217     \textcolor{keyword}{const} BoundaryPatch<GridView>* \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}};}
\DoxyCodeLine{218     \textcolor{keyword}{mutable} Dune::BlockVector<Dune::RealTuple<double, Traits::dimension>> \mbox{\hyperlink{a01265_a4a66b053a96b697a9f11efaf1376b0e7}{dispAtNodes}};}
\DoxyCodeLine{219     \mbox{\hyperlink{a01301}{DefaultMembraneStrain}} \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}};}
\DoxyCodeLine{220     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01265_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}};}
\DoxyCodeLine{221     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}};}
\DoxyCodeLine{222     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}};}
\DoxyCodeLine{223     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}\{0\};}
\DoxyCodeLine{224     \textcolor{keywordtype}{int} \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}}\{\};}
\DoxyCodeLine{225 }
\DoxyCodeLine{226   \textcolor{keyword}{protected}:}
\DoxyCodeLine{246     \textcolor{keyword}{auto} \mbox{\hyperlink{a01265_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Dune::FieldVector<double, 2>}}\& gpPos, \textcolor{keywordtype}{int} gpIndex, \textcolor{keyword}{const} \mbox{\hyperlink{a01265_a53ff5e7dfc6018836c490d40160fa901}{Geometry}}\& geo,}
\DoxyCodeLine{247                                    \textcolor{keyword}{const} \textcolor{keyword}{auto}\& uFunction)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{248       \textcolor{keyword}{using }ScalarType = \textcolor{keyword}{typename} std::remove\_cvref\_t<\textcolor{keyword}{decltype}(uFunction)>::ctype;}
\DoxyCodeLine{249 }
\DoxyCodeLine{250       \mbox{\hyperlink{a01269}{KinematicVariables<ScalarType>}} kin;}
\DoxyCodeLine{251       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00302}{Dune}};}
\DoxyCodeLine{252       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{253       \textcolor{keyword}{const} \textcolor{keyword}{auto} [X, Jd, Hd]              = geo.impl().zeroFirstAndSecondDerivativeOfPosition(gpPos);}
\DoxyCodeLine{254       kin.J                               = toEigen(Jd);}
\DoxyCodeLine{255       kin.H                               = toEigen(Hd);}
\DoxyCodeLine{256       \textcolor{keyword}{const} Eigen::Matrix<double, 2, 2> A = kin.J * kin.J.transpose();}
\DoxyCodeLine{257       Eigen::Matrix<double, 3, 3> G       = Eigen::Matrix<double, 3, 3>::Zero();}
\DoxyCodeLine{258 }
\DoxyCodeLine{259       G.block<2, 2>(0, 0)                    = A;}
\DoxyCodeLine{260       G(2, 2)                                = 1;}
\DoxyCodeLine{261       \textcolor{keyword}{const} Eigen::Matrix<double, 3, 3> GInv = G.inverse();}
\DoxyCodeLine{262       kin.C                                  = \mbox{\hyperlink{a01265_aa135b5062856432512c7d29f1ff675b0}{materialTangent}}(GInv);}
\DoxyCodeLine{263 }
\DoxyCodeLine{264       kin.epsV = \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}}.\mbox{\hyperlink{a01301_acfe8c5424970d44c34005e13e851494a}{value}}(gpPos, geo, uFunction);}
\DoxyCodeLine{265 }
\DoxyCodeLine{266       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd                             = \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{267       \textcolor{keyword}{const} \textcolor{keyword}{auto} uasMatrix                        = \mbox{\hyperlink{a00293_gaf9d7cf401f9f03ce1aae728c646ce178}{Dune::viewAsEigenMatrixAsDynFixed}}(uFunction.coefficientsRef());}
\DoxyCodeLine{268       \textcolor{keyword}{const} \textcolor{keyword}{auto} hessianu                         = Ndd.transpose().template cast<ScalarType>() * uasMatrix;}
\DoxyCodeLine{269       kin.h                                       = kin.H + hessianu;}
\DoxyCodeLine{270       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 2> gradu = toEigen(uFunction.evaluateDerivative(}
\DoxyCodeLine{271           gpIndex, Dune::wrt(spatialAll), Dune::on(Dune::DerivativeDirections::referenceElement)));}
\DoxyCodeLine{272       kin.j                                       = kin.J + gradu.transpose();}
\DoxyCodeLine{273       kin.a3N                                     = (kin.j.row(0).cross(kin.j.row(1)));}
\DoxyCodeLine{274       kin.a3                                      = kin.a3N.normalized();}
\DoxyCodeLine{275       Eigen::Vector<ScalarType, 3> bV             = kin.h * kin.a3;}
\DoxyCodeLine{276       bV(2) *= 2;  \textcolor{comment}{// Voigt notation requires the two here}}
\DoxyCodeLine{277       \textcolor{keyword}{const} \textcolor{keyword}{auto} BV = \mbox{\hyperlink{a00294_ga4304655095296ce9283e012587817a51}{toVoigt}}(toEigen(geo.impl().secondFundamentalForm(gpPos)));}
\DoxyCodeLine{278       kin.kappaV    = BV -\/ bV;}
\DoxyCodeLine{279       \textcolor{keywordflow}{return} kin;}
\DoxyCodeLine{280     \}}
\DoxyCodeLine{281 }
\DoxyCodeLine{282     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{283     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01265_aab5382fc4bf1bac0f78dbd306a6ba010}{calculateMatrixImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<ScalarType> K,}
\DoxyCodeLine{284                              \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{285       K.setZero();}
\DoxyCodeLine{286       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{287       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00302}{Dune}};}
\DoxyCodeLine{288       \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01265_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(par, dx);}
\DoxyCodeLine{289       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00285_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{FEParameter::loadfactor}});}
\DoxyCodeLine{290       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo       = this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry();}
\DoxyCodeLine{291 }
\DoxyCodeLine{292       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{293         \textcolor{keyword}{const} \textcolor{keyword}{auto} intElement = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{294         \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, jE, J, h, H, a3N, a3]}
\DoxyCodeLine{295             = \mbox{\hyperlink{a01265_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, geo, uFunction);}
\DoxyCodeLine{296         \textcolor{keyword}{const} Eigen::Vector<ScalarType, membraneStrainSize> membraneForces = \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}} * C * epsV;}
\DoxyCodeLine{297         \textcolor{keyword}{const} Eigen::Vector<ScalarType, bendingStrainSize> moments = Dune::power(\mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}}, 3) / 12.0 * C * kappaV;}
\DoxyCodeLine{298 }
\DoxyCodeLine{299         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Nd  = \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateJacobian(gpIndex);}
\DoxyCodeLine{300         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd = \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{301         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}; ++i) \{}
\DoxyCodeLine{302           Eigen::Matrix<ScalarType, membraneStrainSize, worlddim> bopIMembrane}
\DoxyCodeLine{303               = \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}}.\mbox{\hyperlink{a01301_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, geo, uFunction, \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, i);}
\DoxyCodeLine{304 }
\DoxyCodeLine{305           Eigen::Matrix<ScalarType, bendingStrainSize, worlddim> bopIBending = \mbox{\hyperlink{a01265_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, i, a3N, a3);}
\DoxyCodeLine{306           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = i; j < \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}; ++j) \{}
\DoxyCodeLine{307             \textcolor{keyword}{auto} KBlock = K.template block<worlddim, worlddim>(\mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} * i, \mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} * j);}
\DoxyCodeLine{308             Eigen::Matrix<ScalarType, membraneStrainSize, worlddim> bopJMembrane}
\DoxyCodeLine{309                 = \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}}.\mbox{\hyperlink{a01301_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, geo, uFunction, \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, j);}
\DoxyCodeLine{310             Eigen::Matrix<ScalarType, bendingStrainSize, worlddim> bopJBending = \mbox{\hyperlink{a01265_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, j, a3N, a3);}
\DoxyCodeLine{311             KBlock += \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}} * bopIMembrane.transpose() * C * bopJMembrane * intElement;}
\DoxyCodeLine{312             KBlock += Dune::power(\mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}}, 3) / 12.0 * bopIBending.transpose() * C * bopJBending * intElement;}
\DoxyCodeLine{313 }
\DoxyCodeLine{314             Eigen::Matrix<ScalarType, worlddim, worlddim> kgMembraneIJ}
\DoxyCodeLine{315                 = \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}}.\mbox{\hyperlink{a01301_a95cb97998e73fcf05fb7d9df0249b2e9}{secondDerivative}}(gp.position(), Nd, geo, uFunction, \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, membraneForces, i, j);}
\DoxyCodeLine{316             Eigen::Matrix<ScalarType, worlddim, worlddim> kgBendingIJ}
\DoxyCodeLine{317                 = \mbox{\hyperlink{a01265_a1acdd9123a1e1268a5f990b5655a737c}{kgBending}}(jE, h, Nd, Ndd, a3N, a3, moments, i, j);}
\DoxyCodeLine{318             KBlock += kgMembraneIJ * intElement;}
\DoxyCodeLine{319             KBlock += kgBendingIJ * intElement;}
\DoxyCodeLine{320           \}}
\DoxyCodeLine{321         \}}
\DoxyCodeLine{322       \}}
\DoxyCodeLine{323       K.template triangularView<Eigen::StrictlyLower>() = K.transpose();}
\DoxyCodeLine{324     \}}
\DoxyCodeLine{325 }
\DoxyCodeLine{326     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{327     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01265_a41a0a9873dd4107fd444250de72e99bc}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{328                              \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{329       force.setZero();}
\DoxyCodeLine{330       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{331       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00302}{Dune}};}
\DoxyCodeLine{332       \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01265_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(par, dx);}
\DoxyCodeLine{333       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00285_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{FEParameter::loadfactor}});}
\DoxyCodeLine{334       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo       = this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry();}
\DoxyCodeLine{335 }
\DoxyCodeLine{336       \textcolor{comment}{// Internal forces}}
\DoxyCodeLine{337       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{338         \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, jE, J, h, H, a3N, a3]}
\DoxyCodeLine{339             = \mbox{\hyperlink{a01265_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, geo, uFunction);}
\DoxyCodeLine{340         \textcolor{keyword}{const} Eigen::Vector<ScalarType, 3> membraneForces = \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}} * C * epsV;}
\DoxyCodeLine{341         \textcolor{keyword}{const} Eigen::Vector<ScalarType, 3> moments        = Dune::power(\mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}}, 3) / 12.0 * C * kappaV;}
\DoxyCodeLine{342 }
\DoxyCodeLine{343         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Nd  = \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateJacobian(gpIndex);}
\DoxyCodeLine{344         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd = \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{345         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}; ++i) \{}
\DoxyCodeLine{346           Eigen::Matrix<ScalarType, 3, 3> bopIMembrane}
\DoxyCodeLine{347               = \mbox{\hyperlink{a01265_afb9f4a8b2231fb00b6cb8d4426d7482b}{membraneStrain}}.\mbox{\hyperlink{a01301_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, geo, uFunction, \mbox{\hyperlink{a01265_a9bb0dc0af5e814b54f98b1ae39c31332}{localBasis}}, i);}
\DoxyCodeLine{348           Eigen::Matrix<ScalarType, 3, 3> bopIBending = \mbox{\hyperlink{a01265_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, i, a3N, a3);}
\DoxyCodeLine{349           force.template segment<3>(3 * i)}
\DoxyCodeLine{350               += bopIMembrane.transpose() * membraneForces * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{351           force.template segment<3>(3 * i)}
\DoxyCodeLine{352               += bopIBending.transpose() * moments * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{353         \}}
\DoxyCodeLine{354       \}}
\DoxyCodeLine{355 }
\DoxyCodeLine{356       \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{357       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}}) \{}
\DoxyCodeLine{358         \textcolor{keyword}{const} \textcolor{keyword}{auto} u = \mbox{\hyperlink{a01265_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(par, dx);}
\DoxyCodeLine{359         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{360           Eigen::Vector<double, Traits::worlddim> fext = \mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}}(geo.global(gp.position()), lambda);}
\DoxyCodeLine{361           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}; ++i) \{}
\DoxyCodeLine{362             \textcolor{keyword}{const} \textcolor{keyword}{auto} udCi = uFunction.evaluateDerivative(gpIndex, wrt(coeff(i)));}
\DoxyCodeLine{363             force.template segment<worlddim>(\mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} * i)}
\DoxyCodeLine{364                 -\/= udCi * fext * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{365           \}}
\DoxyCodeLine{366         \}}
\DoxyCodeLine{367       \}}
\DoxyCodeLine{368 }
\DoxyCodeLine{369       \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} and not \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{370 }
\DoxyCodeLine{371       \textcolor{comment}{// External forces, boundary forces, i.e. at the Neumann boundary}}
\DoxyCodeLine{372       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& intersection : intersections(\mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>gridView(), this-\/>localView().element())) \{}
\DoxyCodeLine{373         \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} or not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>contains(intersection)) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{374 }
\DoxyCodeLine{375         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& quadLine = QuadratureRules<double, Element::mydimension -\/ 1>::rule(intersection.type(), \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}});}
\DoxyCodeLine{376 }
\DoxyCodeLine{377         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& curQuad : quadLine) \{}
\DoxyCodeLine{378           \textcolor{comment}{// Local position of the quadrature point}}
\DoxyCodeLine{379           \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{FieldVector<double, Element::mydimension>}}\& quadPos}
\DoxyCodeLine{380               = intersection.geometryInInside().global(curQuad.position());}
\DoxyCodeLine{381 }
\DoxyCodeLine{382           \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = intersection.geometry().integrationElement(curQuad.position()) * curQuad.weight();}
\DoxyCodeLine{383           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{a01265_a56e9fd510e99e289f2adb7ed355533f4}{numberOfNodes}}; ++i) \{}
\DoxyCodeLine{384             \textcolor{keyword}{const} \textcolor{keyword}{auto} udCi = uFunction.evaluateDerivative(quadPos, wrt(coeff(i)));}
\DoxyCodeLine{385 }
\DoxyCodeLine{386             \textcolor{comment}{// Value of the Neumann data at the current position}}
\DoxyCodeLine{387             \textcolor{keyword}{auto} neumannValue = \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}(intersection.geometry().global(curQuad.position()), lambda);}
\DoxyCodeLine{388             force.template segment<worlddim>(\mbox{\hyperlink{a01265_a72ab40a0cd36ae7aed708f82780c20b0}{worlddim}} * i) -\/= udCi * neumannValue * intElement;}
\DoxyCodeLine{389           \}}
\DoxyCodeLine{390         \}}
\DoxyCodeLine{391       \}}
\DoxyCodeLine{392     \}}
\DoxyCodeLine{393 }
\DoxyCodeLine{394     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{395     \textcolor{keyword}{auto} \mbox{\hyperlink{a01265_a83c5d12a0591fce31bc29ea903156863}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01265_ada03913c70f89a6feab860e6871b1a58}{FERequirementType}}\& par, \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx}
\DoxyCodeLine{396                                                            = std::nullopt) \textcolor{keyword}{const} -\/> ScalarType \{}
\DoxyCodeLine{397       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{398       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00302}{Dune}};}
\DoxyCodeLine{399       \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01265_a7e42edf0686f54efc607942eb1f9be44}{getDisplacementFunction}}(par, dx);}
\DoxyCodeLine{400       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00285_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{FEParameter::loadfactor}});}
\DoxyCodeLine{401       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo       = this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().geometry();}
\DoxyCodeLine{402       ScalarType energy    = 0.0;}
\DoxyCodeLine{403 }
\DoxyCodeLine{404       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{405         \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, j, J, h, H, a3N, a3]}
\DoxyCodeLine{406             = \mbox{\hyperlink{a01265_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, geo, uFunction);}
\DoxyCodeLine{407 }
\DoxyCodeLine{408         \textcolor{keyword}{const} ScalarType membraneEnergy = 0.5 * \mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}} * epsV.dot(C * epsV);}
\DoxyCodeLine{409         \textcolor{keyword}{const} ScalarType bendingEnergy  = 0.5 * Dune::power(\mbox{\hyperlink{a01265_aa055b97524c73a6917b026571f3de686}{thickness\_}}, 3) / 12.0 * kappaV.dot(C * kappaV);}
\DoxyCodeLine{410         energy += (membraneEnergy + bendingEnergy) * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{411       \}}
\DoxyCodeLine{412 }
\DoxyCodeLine{413       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}}) \{}
\DoxyCodeLine{414         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{415           \textcolor{keyword}{const} \textcolor{keyword}{auto} u                                       = uFunction.evaluate(gpIndex);}
\DoxyCodeLine{416           \textcolor{keyword}{const} Eigen::Vector<double, Traits::worlddim> fExt = \mbox{\hyperlink{a01265_a48296d1b90c462c24b85472103261e72}{volumeLoad}}(geo.global(gp.position()), lambda);}
\DoxyCodeLine{417           energy -\/= u.dot(fExt) * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{418         \}}
\DoxyCodeLine{419       \}}
\DoxyCodeLine{420 }
\DoxyCodeLine{421       \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} and not \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}) \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{422 }
\DoxyCodeLine{423       \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{424       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& element = this-\/>\mbox{\hyperlink{a01197_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element();}
\DoxyCodeLine{425       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& intersection : intersections(\mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>gridView(), element)) \{}
\DoxyCodeLine{426         \textcolor{keywordflow}{if} (not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}} or not \mbox{\hyperlink{a01265_a06d85364de82f545719a105ecd6d9629}{neumannBoundary}}-\/>contains(intersection)) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{427 }
\DoxyCodeLine{428         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& quadLine = QuadratureRules<double, Traits::mydim -\/ 1>::rule(intersection.type(), \mbox{\hyperlink{a01265_a63b27f61b7f57f12671618edf3ef99ef}{order}});}
\DoxyCodeLine{429 }
\DoxyCodeLine{430         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& curQuad : quadLine) \{}
\DoxyCodeLine{431           \textcolor{comment}{// Local position of the quadrature point}}
\DoxyCodeLine{432           \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{FieldVector<double, Traits::mydim>}}\& quadPos}
\DoxyCodeLine{433               = intersection.geometryInInside().global(curQuad.position());}
\DoxyCodeLine{434 }
\DoxyCodeLine{435           \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = intersection.geometry().integrationElement(curQuad.position());}
\DoxyCodeLine{436 }
\DoxyCodeLine{437           \textcolor{comment}{// The value of the local function}}
\DoxyCodeLine{438           \textcolor{keyword}{const} \textcolor{keyword}{auto} u = uFunction.evaluate(quadPos);}
\DoxyCodeLine{439 }
\DoxyCodeLine{440           \textcolor{comment}{// Value of the Neumann data at the current position}}
\DoxyCodeLine{441           \textcolor{keyword}{const} \textcolor{keyword}{auto} neumannValue = \mbox{\hyperlink{a01265_a3f955c9f6dfc845cd44a5a75aad79e38}{neumannBoundaryLoad}}(intersection.geometry().global(curQuad.position()), lambda);}
\DoxyCodeLine{442           energy -\/= neumannValue.dot(u) * curQuad.weight() * intElement;}
\DoxyCodeLine{443         \}}
\DoxyCodeLine{444       \}}
\DoxyCodeLine{445       \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{446     \}}
\DoxyCodeLine{447 }
\DoxyCodeLine{448     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{449     Eigen::Matrix<ScalarType, 3, 3> \mbox{\hyperlink{a01265_a1acdd9123a1e1268a5f990b5655a737c}{kgBending}}(\textcolor{keyword}{const} Eigen::Matrix<ScalarType, 2, 3>\& jcur,}
\DoxyCodeLine{450                                               \textcolor{keyword}{const} Eigen::Matrix3<ScalarType>\& h, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddN,}
\DoxyCodeLine{451                                               \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3N,}
\DoxyCodeLine{452                                               \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3, \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& S,}
\DoxyCodeLine{453                                               \textcolor{keywordtype}{int} I, \textcolor{keywordtype}{int} J)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{454       Eigen::Matrix<ScalarType, 3, 3> kg;}
\DoxyCodeLine{455       kg.setZero();}
\DoxyCodeLine{456 }
\DoxyCodeLine{457       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN1i = dN(I, 0);}
\DoxyCodeLine{458       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN1j = dN(J, 0);}
\DoxyCodeLine{459       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN2i = dN(I, 1);}
\DoxyCodeLine{460       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN2j = dN(J, 1);}
\DoxyCodeLine{461 }
\DoxyCodeLine{462       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> P}
\DoxyCodeLine{463           = 1.0 / a3N.norm() * (Eigen::Matrix<double, 3, 3>::Identity() -\/ a3 * a3.transpose());}
\DoxyCodeLine{464 }
\DoxyCodeLine{465       \textcolor{keyword}{const} \textcolor{keyword}{auto} a1dxI = Eigen::Matrix<double, 3, 3>::Identity()}
\DoxyCodeLine{466                          * dN1i;  \textcolor{comment}{// the auto here allows the exploitation of the identity matrices,}}
\DoxyCodeLine{467       \textcolor{comment}{// due to Eigen's expression templates}}
\DoxyCodeLine{468       \textcolor{keyword}{const} \textcolor{keyword}{auto} a2dxI                            = Eigen::Matrix<double, 3, 3>::Identity() * dN2i;}
\DoxyCodeLine{469       \textcolor{keyword}{const} \textcolor{keyword}{auto} a1dxJ                            = Eigen::Matrix<double, 3, 3>::Identity() * dN1j;}
\DoxyCodeLine{470       \textcolor{keyword}{const} \textcolor{keyword}{auto} a2dxJ                            = Eigen::Matrix<double, 3, 3>::Identity() * dN2j;}
\DoxyCodeLine{471       \textcolor{keyword}{const} \textcolor{keyword}{auto} a1                               = jcur.row(0);}
\DoxyCodeLine{472       \textcolor{keyword}{const} \textcolor{keyword}{auto} a2                               = jcur.row(1);}
\DoxyCodeLine{473       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdI = a1dxI.colwise().cross(a2) -\/ a2dxI.colwise().cross(a1);}
\DoxyCodeLine{474       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdJ = a1dxJ.colwise().cross(a2) -\/ a2dxJ.colwise().cross(a1);}
\DoxyCodeLine{475       Eigen::Matrix<ScalarType, 3, 3> a3dI        = P * a3NdI;}
\DoxyCodeLine{476       Eigen::Matrix<ScalarType, 3, 3> a3dJ        = P * a3NdJ;}
\DoxyCodeLine{477       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{}
\DoxyCodeLine{478         \textcolor{keyword}{const} \textcolor{keyword}{auto} a\_albe               = h.row(i).transpose();}
\DoxyCodeLine{479         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddNI                = ddN(I, i);}
\DoxyCodeLine{480         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddNJ                = ddN(J, i);}
\DoxyCodeLine{481         Eigen::Vector3<ScalarType> vecd = P * a\_albe;}
\DoxyCodeLine{482 }
\DoxyCodeLine{483         Eigen::Matrix<ScalarType, 3, 3> a3Ndd}
\DoxyCodeLine{484             = 1.0 / a3N.squaredNorm()}
\DoxyCodeLine{485               * ((3 * a3 * a3.transpose() -\/ Eigen::Matrix<double, 3, 3>::Identity()) * (a3.dot(a\_albe))}
\DoxyCodeLine{486                  -\/ a\_albe * a3.transpose() -\/ a3 * a\_albe.transpose());}
\DoxyCodeLine{487 }
\DoxyCodeLine{488         Eigen::Matrix<ScalarType, 3, 3> secondDerivativeDirectorIJ = \mbox{\hyperlink{a00293_ga1496a9776a583f8b09c4244a68453394}{skew}}(((dN2i * dN1j -\/ dN1i * dN2j) * vecd).eval());}
\DoxyCodeLine{489         kg -\/= (a3NdI.transpose() * a3Ndd * a3NdJ + secondDerivativeDirectorIJ + (ddNI * a3dJ + ddNJ * a3dI.transpose()))}
\DoxyCodeLine{490               * S[i] * (i == 2 ? 2 : 1);}
\DoxyCodeLine{491       \}}
\DoxyCodeLine{492 }
\DoxyCodeLine{493       \textcolor{keywordflow}{return} kg;}
\DoxyCodeLine{494     \}}
\DoxyCodeLine{495 }
\DoxyCodeLine{496     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{497     Eigen::Matrix<ScalarType, 3, 3> \mbox{\hyperlink{a01265_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(\textcolor{keyword}{const} Eigen::Matrix<ScalarType, 2, 3>\& jcur,}
\DoxyCodeLine{498                                                \textcolor{keyword}{const} Eigen::Matrix3<ScalarType>\& h, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddN,}
\DoxyCodeLine{499                                                \textcolor{keyword}{const} \textcolor{keywordtype}{int} node, \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3N,}
\DoxyCodeLine{500                                                \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{501       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a1dxI}
\DoxyCodeLine{502           = Eigen::Matrix<double, 3, 3>::Identity() * dN(node, 0);  \textcolor{comment}{// this should be double}}
\DoxyCodeLine{503       \textcolor{comment}{// but the cross-\/product below complains otherwise}}
\DoxyCodeLine{504       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a2dxI = Eigen::Matrix<double, 3, 3>::Identity() * dN(node, 1);}
\DoxyCodeLine{505       \textcolor{keyword}{const} \textcolor{keyword}{auto} a1                               = jcur.row(0);}
\DoxyCodeLine{506       \textcolor{keyword}{const} \textcolor{keyword}{auto} a2                               = jcur.row(1);}
\DoxyCodeLine{507       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdI}
\DoxyCodeLine{508           = a1dxI.colwise().cross(a2) -\/ a2dxI.colwise().cross(a1);  \textcolor{comment}{// minus needed since order has}}
\DoxyCodeLine{509       \textcolor{comment}{// to be swapped to get column-\/wise cross product working}}
\DoxyCodeLine{510       \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3d1}
\DoxyCodeLine{511           = 1.0 / a3N.norm() * (Eigen::Matrix<double, 3, 3>::Identity() -\/ a3 * a3.transpose()) * a3NdI;}
\DoxyCodeLine{512 }
\DoxyCodeLine{513       Eigen::Matrix<ScalarType, 3, 3> bop = -\/(h * a3d1 + (a3 * ddN.row(node)).\mbox{\hyperlink{a00298_ac2c6469be19ce4ef2e630bfa1c5a5e24}{transpose}}());}
\DoxyCodeLine{514       bop.row(2) *= 2;}
\DoxyCodeLine{515 }
\DoxyCodeLine{516       \textcolor{keywordflow}{return} bop;}
\DoxyCodeLine{517     \}}
\DoxyCodeLine{518 }
\DoxyCodeLine{519     Eigen::Matrix<double, 3, 3> \mbox{\hyperlink{a01265_aa135b5062856432512c7d29f1ff675b0}{materialTangent}}(\textcolor{keyword}{const} Eigen::Matrix<double, 3, 3>\& Aconv)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{520       \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambda   = \mbox{\hyperlink{a01265_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}} * \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}} / ((1.0 + \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}}) * (1.0 -\/ 2.0 * \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}}));}
\DoxyCodeLine{521       \textcolor{keyword}{const} \textcolor{keywordtype}{double} mu       = \mbox{\hyperlink{a01265_a4b65a8b484bd3c7fb306557dc8e63848}{emod\_}} / (2.0 * (1.0 + \mbox{\hyperlink{a01265_a2cabafb4cfd93e8dd230d6ebb79bf529}{nu\_}}));}
\DoxyCodeLine{522       \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambdbar = 2.0 * lambda * mu / (lambda + 2.0 * mu);}
\DoxyCodeLine{523       Eigen::TensorFixedSize<double, Eigen::Sizes<3, 3, 3, 3>> moduli;}
\DoxyCodeLine{524       \textcolor{keyword}{const} \textcolor{keyword}{auto} AconvT = \mbox{\hyperlink{a00294_ga5cfd9d098384fb067d897b3c0499b447}{tensorView}}(Aconv, std::array<Eigen::Index, 2>(\{3, 3\}));}
\DoxyCodeLine{525       moduli = lambdbar * \mbox{\hyperlink{a00294_gab2cea9ac847cc3635812467c9d96ceb4}{dyadic}}(AconvT, AconvT).eval() + 2.0 * mu * symmetricFourthOrder<double>(Aconv, Aconv);}
\DoxyCodeLine{526 }
\DoxyCodeLine{527       \textcolor{keyword}{auto} C                          = \mbox{\hyperlink{a00294_ga4304655095296ce9283e012587817a51}{toVoigt}}(moduli);}
\DoxyCodeLine{528       Eigen::Matrix<double, 3, 3> C33 = C(\{0, 1, 5\}, \{0, 1, 5\});}
\DoxyCodeLine{529       \textcolor{keywordflow}{return} C33;}
\DoxyCodeLine{530     \}}
\DoxyCodeLine{531   \};}
\DoxyCodeLine{532 \}  \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
