\hypertarget{a00140_source}{}\doxysection{volume.\+hh}
\label{a00140_source}\index{volume.hh@{volume.hh}}
\mbox{\hyperlink{a00140}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00131}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00029}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00316}{Ikarus}} \{}
\DoxyCodeLine{10 }
\DoxyCodeLine{19 \textcolor{keyword}{template} <\textcolor{keyword}{typename} DisplacementBasedElement, \textcolor{keyword}{typename} Traits>}
\DoxyCodeLine{20 \textcolor{keyword}{class }\mbox{\hyperlink{a01300}{Volume}}}
\DoxyCodeLine{21 \{}
\DoxyCodeLine{22 \textcolor{keyword}{public}:}
\DoxyCodeLine{23   \textcolor{keyword}{using }\mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}       = \textcolor{keyword}{typename} Traits::FERequirementType;}
\DoxyCodeLine{24   \textcolor{keyword}{using }\mbox{\hyperlink{a01300_a18c85727e45cd4b1889acb15d6e5c562}{LocalView}}               = \textcolor{keyword}{typename} Traits::LocalView;}
\DoxyCodeLine{25   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01300_aa57591d28c62806bfac624043d2e0258}{worldDim}} = Traits::worlddim;}
\DoxyCodeLine{26 }
\DoxyCodeLine{34   \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad>}
\DoxyCodeLine{35   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01300_a4b5995b4de476887526d16c90600b634}{Volume}}(VolumeLoad p\_volumeLoad = \{\}) \{}
\DoxyCodeLine{36     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!std::is\_same\_v<VolumeLoad, utils::LoadDefault>)}
\DoxyCodeLine{37       volumeLoad = p\_volumeLoad;}
\DoxyCodeLine{38   \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{48   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01300_a33edddd4d3ef260d45b1c029efd9046d}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& req)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(req); \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{57   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01300_ad2cf691094d779dd4681c79a1d768aae}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{58     calculateVectorImpl<double>(req, force);}
\DoxyCodeLine{59   \}}
\DoxyCodeLine{67   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01300_ab34ccd72bb7397283f7c2dcbf595841e}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{68     calculateMatrixImpl<double>(req, K);}
\DoxyCodeLine{69   \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{keyword}{protected}:}
\DoxyCodeLine{72   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{73   \textcolor{keyword}{auto} \mbox{\hyperlink{a01300_a38b6d9f88ad5734093413497e3ac7b29}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& par,}
\DoxyCodeLine{74                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt) \textcolor{keyword}{const}}
\DoxyCodeLine{75       -\/> ScalarType \{}
\DoxyCodeLine{76     \textcolor{keywordflow}{if} (not volumeLoad)}
\DoxyCodeLine{77       \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{78     ScalarType energy    = 0.0;}
\DoxyCodeLine{79     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = dbElement().displacementFunction(par, dx);}
\DoxyCodeLine{80     \textcolor{keyword}{const} \textcolor{keyword}{auto} geo       = dbElement().geometry();}
\DoxyCodeLine{81     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{84       \textcolor{keyword}{const} \textcolor{keyword}{auto} uVal                      = uFunction.evaluate(gpIndex);}
\DoxyCodeLine{85       Eigen::Vector<double, worldDim> fext = volumeLoad(geo.global(gp.position()), lambda);}
\DoxyCodeLine{86       energy -\/= uVal.dot(fext) * geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{89   \}}
\DoxyCodeLine{90 }
\DoxyCodeLine{91   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{92   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01300_af2fc872a641d42398fc9d8bd60aa973c}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{93                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{94     \textcolor{keywordflow}{if} (not volumeLoad)}
\DoxyCodeLine{95       \textcolor{keywordflow}{return};}
\DoxyCodeLine{96     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{97     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{98     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = dbElement().displacementFunction(par, dx);}
\DoxyCodeLine{99     \textcolor{keyword}{const} \textcolor{keyword}{auto} geo       = dbElement().geometry();}
\DoxyCodeLine{100     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{103       \textcolor{keyword}{const} Eigen::Vector<double, worldDim> fext = volumeLoad(geo.global(gp.position()), lambda);}
\DoxyCodeLine{104       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement                    = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{105       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < dbElement().numberOfNodes(); ++i) \{}
\DoxyCodeLine{106         \textcolor{keyword}{const} \textcolor{keyword}{auto} udCi = uFunction.evaluateDerivative(gpIndex, wrt(coeff(i)));}
\DoxyCodeLine{107         force.template segment<worldDim>(\mbox{\hyperlink{a01300_aa57591d28c62806bfac624043d2e0258}{worldDim}} * i) -\/= udCi * fext * intElement;}
\DoxyCodeLine{108       \}}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110   \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{113   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01300_a6903f5e92a06b8066ef67b6a1f22e142}{calculateMatrixImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01300_a01685c2dca7f8f6d5e03c3b79202af65}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K,}
\DoxyCodeLine{114                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{\}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{keyword}{private}:}
\DoxyCodeLine{117   std::function<Eigen::Vector<double, worldDim>(\textcolor{keyword}{const} \mbox{\hyperlink{a01368}{Dune::FieldVector<double, worldDim>}}\&, \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)> volumeLoad;}
\DoxyCodeLine{118 }
\DoxyCodeLine{124   \textcolor{keyword}{constexpr} \textcolor{keyword}{const} DisplacementBasedElement\& dbElement()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{125     \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }DisplacementBasedElement\&\textcolor{keyword}{>}(*this);}
\DoxyCodeLine{126   \}}
\DoxyCodeLine{127 \};}
\DoxyCodeLine{128 \} \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
