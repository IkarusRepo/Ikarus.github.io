\hypertarget{a00131_source}{}\doxysection{observer.\+hh}
\label{a00131_source}\index{observer.hh@{observer.hh}}
\mbox{\hyperlink{a00131}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <Eigen/Core>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00092}{ikarus/utils/makeenum.hh}}>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{13 \textcolor{keyword}{class }\mbox{\hyperlink{a01409}{IObserver}} \{}
\DoxyCodeLine{14 \textcolor{keyword}{public}:}
\DoxyCodeLine{15   \textcolor{keyword}{virtual} \mbox{\hyperlink{a01409_a06d29abd8a33c41df2a6be73f04e8e12}{\string~IObserver}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{16 }
\DoxyCodeLine{17   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a6dd574999a4ed16c6b2552634a3ba843}{update}}(MessageType message) \{}
\DoxyCodeLine{18     checkMessageType(message);}
\DoxyCodeLine{19     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message);}
\DoxyCodeLine{20   \}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_ab310853f3a37debf0f75698058f1ad05}{update}}(MessageType message, \textcolor{keywordtype}{double} val) \{}
\DoxyCodeLine{23     checkMessageType(message);}
\DoxyCodeLine{24     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, val);}
\DoxyCodeLine{25   \}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_ad02f19017df61eb1336bd6e8795bbdd9}{update}}(MessageType message, \textcolor{keywordtype}{int} val) \{}
\DoxyCodeLine{28     checkMessageType(message);}
\DoxyCodeLine{29     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, val);}
\DoxyCodeLine{30   \};}
\DoxyCodeLine{31 }
\DoxyCodeLine{32   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_afd44e2c321f482c928f28cfc88ae69b7}{update}}(MessageType message, \textcolor{keyword}{const} std::string\& val) \{}
\DoxyCodeLine{33     checkMessageType(message);}
\DoxyCodeLine{34     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, val);}
\DoxyCodeLine{35   \};}
\DoxyCodeLine{36 }
\DoxyCodeLine{37   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_afbfeac9bc0114189435004716ece4eb0}{update}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keywordtype}{double} val2) \{}
\DoxyCodeLine{38     checkMessageType(message);}
\DoxyCodeLine{39     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, val1, val2);}
\DoxyCodeLine{40   \};}
\DoxyCodeLine{41 }
\DoxyCodeLine{42   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a0084fe0709c399962cf356f7e25261e9}{update}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keyword}{const} std::string\& val2) \{}
\DoxyCodeLine{43     checkMessageType(message);}
\DoxyCodeLine{44     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, val1, val2);}
\DoxyCodeLine{45   \};}
\DoxyCodeLine{46 }
\DoxyCodeLine{47   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a821866903f9289af1676488bfb3eda2f}{update}}(MessageType message, \textcolor{keyword}{const} Eigen::VectorXd\& vec) \{}
\DoxyCodeLine{48     checkMessageType(message);}
\DoxyCodeLine{49     \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}(message, vec);}
\DoxyCodeLine{50   \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{keyword}{protected}:}
\DoxyCodeLine{53   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_ad9d94f81f16c816d41c6347dec10ec30}{updateImpl}}([[maybe\_unused]] MessageType message)\{\};}
\DoxyCodeLine{54   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_ab2d8b9b4021e539ee364669275e71a81}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keywordtype}{double} val)\{\};}
\DoxyCodeLine{55   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a1cf1227eba8a4618de3abbd1f0212e54}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keywordtype}{int} val)\{\};}
\DoxyCodeLine{56   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a6e024032bd581010d3b620d21e2fc20e}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keyword}{const} std::string\& val)\{\};}
\DoxyCodeLine{57   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_afe9e2900ee9d19ccdf5d925e1f192c30}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keywordtype}{int} val1, \textcolor{keyword}{const} std::string\& val2)\{\};}
\DoxyCodeLine{58   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a49b561ac00eca725b345625dca0842e4}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keywordtype}{int} val1, \textcolor{keywordtype}{double} val2)\{\};}
\DoxyCodeLine{59   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01409_a677bb40c340376225e092cfed7404fcf}{updateImpl}}([[maybe\_unused]] MessageType message, [[maybe\_unused]] \textcolor{keyword}{const} Eigen::VectorXd\& vec) \{\}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{private}:}
\DoxyCodeLine{62   \textcolor{keywordtype}{void} checkMessageType(MessageType message) \{}
\DoxyCodeLine{63     \textcolor{keywordflow}{if} (MessageType::END == message) DUNE\_THROW(Dune::InvalidStateException, \textcolor{stringliteral}{"{}The END enum type should not be used"{}});}
\DoxyCodeLine{64     \textcolor{keywordflow}{if} (MessageType::BEGIN == message)}
\DoxyCodeLine{65       DUNE\_THROW(Dune::InvalidStateException, \textcolor{stringliteral}{"{}The BEGIN enum type should not be used"{}});}
\DoxyCodeLine{66   \}}
\DoxyCodeLine{67 \};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{70 \textcolor{keyword}{class }\mbox{\hyperlink{a01413}{IObservable}} \{}
\DoxyCodeLine{71 \textcolor{keyword}{public}:}
\DoxyCodeLine{72   \mbox{\hyperlink{a01413_a9aafe435540e6e189f02cdf2156063fc}{IObservable}}() \{}
\DoxyCodeLine{73     \textcolor{keywordflow}{for} (MessageType msg = MessageType::BEGIN; msg != MessageType::END; \mbox{\hyperlink{a00219_a5db6e8f04892e85e6b17e276cdbd0e54}{Ikarus::increment}}(msg))}
\DoxyCodeLine{74       messages\_.push\_back(msg);}
\DoxyCodeLine{75   \}}
\DoxyCodeLine{76   \textcolor{keyword}{virtual} \mbox{\hyperlink{a01413_ae5717e23ba80e0081db869c6da4dee8c}{\string~IObservable}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{77   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_af3553b1f0693d383b926a7d41ef9cfba}{subscribe}}(MessageType message, std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer);}
\DoxyCodeLine{78   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a273c05e01be307f0b68c7324a3e5b5fc}{subscribeAll}}(std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer);}
\DoxyCodeLine{79   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_aabc096399b6dfc39c2679847e70479d8}{subscribeAll}}(std::initializer\_list<std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}>> observers);}
\DoxyCodeLine{80   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a49fbae522276e31eaf42576b529d7c39}{unSubscribe}}(MessageType message, std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer);}
\DoxyCodeLine{81   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_aa0aaa380ab52aa54956ab79146ea1ee8}{unSubscribeAll}}(std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer);}
\DoxyCodeLine{82   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{notify}}(MessageType message);}
\DoxyCodeLine{83   \textcolor{keyword}{template} <std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int} ScalarType>}
\DoxyCodeLine{84   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a7ad4e1f78c9d499c16d1b3a89afbbd85}{notify}}(MessageType message, ScalarType val);}
\DoxyCodeLine{85   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_abdcf57d5950f29e3cf60bc4399852c3d}{notify}}(MessageType message, \textcolor{keywordtype}{int} val);}
\DoxyCodeLine{86   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a40bde4b27ca546193ed27bf903637977}{notify}}(MessageType message, \textcolor{keyword}{const} std::string\& val);}
\DoxyCodeLine{87   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a685615e97a234484882f1fbf5ce2a0ff}{notify}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keywordtype}{double} val2);}
\DoxyCodeLine{88   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_aa8af861cb51e8dd7902d74087b446b36}{notify}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keyword}{const} std::string\& val2);}
\DoxyCodeLine{89   \textcolor{keyword}{template} <std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int} ScalarType>}
\DoxyCodeLine{90   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a473491f00b2c473d24193c2c48983058}{notify}}(MessageType message, Eigen::VectorX<ScalarType> vec);}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{keyword}{private}:}
\DoxyCodeLine{93   \textcolor{keyword}{using }ObserverVector = std::vector<std::shared\_ptr<IObserver<MessageType>>>;}
\DoxyCodeLine{94   \textcolor{keyword}{using }ObserverMap    = std::map<MessageType, ObserverVector>;}
\DoxyCodeLine{95   ObserverMap observers\_;}
\DoxyCodeLine{96   std::vector<MessageType> messages\_;}
\DoxyCodeLine{97 \};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{100 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_af3553b1f0693d383b926a7d41ef9cfba}{IObservable<MessageType>::subscribe}}(MessageType message, std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer) \{}
\DoxyCodeLine{101   observers\_[message];}
\DoxyCodeLine{102   \textcolor{keyword}{auto}\&\& vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{103   vectorOfObserversOfASpecificMessage.push\_back(observer);}
\DoxyCodeLine{104 \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{107 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a273c05e01be307f0b68c7324a3e5b5fc}{IObservable<MessageType>::subscribeAll}}(std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer) \{}
\DoxyCodeLine{108   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& msg : messages\_)}
\DoxyCodeLine{109     subscribe(msg, observer);}
\DoxyCodeLine{110 \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{113 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a273c05e01be307f0b68c7324a3e5b5fc}{IObservable<MessageType>::subscribeAll}}(std::initializer\_list<std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}>> observers) \{}
\DoxyCodeLine{114   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& observer : observers)}
\DoxyCodeLine{115     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& msg : messages\_)}
\DoxyCodeLine{116       subscribe(msg, observer);}
\DoxyCodeLine{117 \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{120 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a49fbae522276e31eaf42576b529d7c39}{IObservable<MessageType>::unSubscribe}}(MessageType message, std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer) \{}
\DoxyCodeLine{121   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{122   std::ranges::remove\_if(vectorOfObserversOfASpecificMessage, [\&observer](\textcolor{keyword}{auto}\&\& obs) \{ \textcolor{keywordflow}{return} obs == observer; \});}
\DoxyCodeLine{123 \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{126 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_aa0aaa380ab52aa54956ab79146ea1ee8}{IObservable<MessageType>::unSubscribeAll}}(std::shared\_ptr<\mbox{\hyperlink{a01409}{IObserver<MessageType>}}> observer) \{}
\DoxyCodeLine{127   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& msg : messages\_)}
\DoxyCodeLine{128     unSubscribe(msg, observer);}
\DoxyCodeLine{129 \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{132 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message) \{}
\DoxyCodeLine{133   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{134   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{135     obs-\/>update(message);}
\DoxyCodeLine{136 \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{139 \textcolor{keyword}{template} <std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int} ScalarType>}
\DoxyCodeLine{140 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, ScalarType val) \{}
\DoxyCodeLine{141   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{142   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{143     obs-\/>update(message, val);}
\DoxyCodeLine{144 \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{147 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, \textcolor{keywordtype}{int} val) \{}
\DoxyCodeLine{148   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{149   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{150     obs-\/>update(message, val);}
\DoxyCodeLine{151 \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{154 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, \textcolor{keyword}{const} std::string\& val) \{}
\DoxyCodeLine{155   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{156   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{157     obs-\/>update(message, val);}
\DoxyCodeLine{158 \}}
\DoxyCodeLine{159 }
\DoxyCodeLine{160 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{161 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keywordtype}{double} val2) \{}
\DoxyCodeLine{162   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{163   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{164     obs-\/>update(message, val1, val2);}
\DoxyCodeLine{165 \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{168 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, \textcolor{keywordtype}{int} val1, \textcolor{keyword}{const} std::string\& val2) \{}
\DoxyCodeLine{169   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{170   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{171     obs-\/>update(message, val1, val2);}
\DoxyCodeLine{172 \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageType>}
\DoxyCodeLine{175 \textcolor{keyword}{template} <std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int} ScalarType>}
\DoxyCodeLine{176 \textcolor{keywordtype}{void} \mbox{\hyperlink{a01413_a55986002430ae0b5d9e12803e28f31d7}{IObservable<MessageType>::notify}}(MessageType message, Eigen::VectorX<ScalarType> vec) \{}
\DoxyCodeLine{177   \textcolor{keyword}{auto} vectorOfObserversOfASpecificMessage = observers\_[message];}
\DoxyCodeLine{178   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& obs : vectorOfObserversOfASpecificMessage)}
\DoxyCodeLine{179     obs-\/>update(message, vec);}
\DoxyCodeLine{180 \}}

\end{DoxyCode}
