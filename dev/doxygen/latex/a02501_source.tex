\hypertarget{a02501_source}{}\doxysection{finiteelements/mechanics/linearelastic.hh}
\label{a02501_source}\index{linearelastic.hh@{linearelastic.hh}}
\mbox{\hyperlink{a02501}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{  \#include <iosfwd>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{  \#include <optional>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{  \#include <type\_traits>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{  \#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{  \#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{  \#include <dune/localfefunctions/expressions/linearStrainsExpr.hh>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{  \#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{  \#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00179}{ikarus/finiteelements/febases/powerbasisfe.hh}}>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00170}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00227}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00185}{ikarus/finiteelements/fetraits.hh}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00224}{ikarus/finiteelements/mechanics/loads.hh}}>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00194}{ikarus/finiteelements/mechanics/materials.hh}}>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00173}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{31 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00056}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00017}{ikarus/utils/linearalgebrahelper.hh}}>}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00316}{Ikarus}} \{}
\DoxyCodeLine{35 }
\DoxyCodeLine{45 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Basis\_, \textcolor{keyword}{typename} FERequirements\_ = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false>}
\DoxyCodeLine{46 \textcolor{keyword}{class }\mbox{\hyperlink{a01292}{LinearElastic}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01216}{PowerBasisFE}}<Basis\_>,}
\DoxyCodeLine{47                       \textcolor{keyword}{public} \mbox{\hyperlink{a01300}{Volume}}<LinearElastic<Basis\_, FERequirements\_, useEigenRef>,}
\DoxyCodeLine{48                                     FETraits<Basis\_, FERequirements\_, useEigenRef>>,}
\DoxyCodeLine{49                       \textcolor{keyword}{public} \mbox{\hyperlink{a01296}{Traction}}<LinearElastic<Basis\_, FERequirements\_, useEigenRef>,}
\DoxyCodeLine{50                                       FETraits<Basis\_, FERequirements\_, useEigenRef>>}
\DoxyCodeLine{51 \{}
\DoxyCodeLine{52 \textcolor{keyword}{public}:}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01256}{Traits}}                 = \mbox{\hyperlink{a01256}{FETraits<Basis\_, FERequirements\_, useEigenRef>}};}
\DoxyCodeLine{54   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_ac67d77bbb42299a97ba00a00265a2a98}{Basis}}                  = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_a60167d06e28805974dec7b7bfda0b8fe}{Traits::Basis}};}
\DoxyCodeLine{55   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_aaf49fc71022971578d72cce0ae28aa55}{FlatBasis}}              = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_aa32f74d438637b2a1e3862b20b010823}{Traits::FlatBasis}};}
\DoxyCodeLine{56   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}      = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_ac302107e3a891954c504b6cc9b739f32}{Traits::FERequirementType}};}
\DoxyCodeLine{57   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_a630a04c604ae2e56673604452e3fd39a}{LocalView}}              = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_aaff1416c2f755aa06e3f85dbf46c2bcb}{Traits::LocalView}};}
\DoxyCodeLine{58   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_a199e66dea3f46b43e92443e427335c20}{Geometry}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_a4fd6cbc70d8a5bd3af746776aec58338}{Traits::Geometry}};}
\DoxyCodeLine{59   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_a32bea39022e61c6978c29f0b75847e44}{GridView}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_ab7206c907598ab750532f44d70c58ae0}{Traits::GridView}};}
\DoxyCodeLine{60   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_af40ba2ffc4ec6ba9e438a1a5a066a1bf}{Element}}                = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_a17b758b602def406352e9dd72a136288}{Traits::Element}};}
\DoxyCodeLine{61   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_aab04fec155c76056c0c302352686787a}{ResultRequirementsType}} = \textcolor{keyword}{typename} \mbox{\hyperlink{a01256_abf9ab205bcb00a7479b363a7011e93da}{Traits::ResultRequirementsType}};}
\DoxyCodeLine{62   \textcolor{keyword}{using }\mbox{\hyperlink{a01216}{BaseDisp}}               = \mbox{\hyperlink{a01216}{PowerBasisFE<Basis>}}; \textcolor{comment}{// Handles globalIndices function}}
\DoxyCodeLine{63   \textcolor{keyword}{using }\mbox{\hyperlink{a01300}{VolumeType}}             = \mbox{\hyperlink{a01300}{Volume<LinearElastic<Basis\_, FERequirements\_, useEigenRef>}}, \mbox{\hyperlink{a01256}{Traits}}>;}
\DoxyCodeLine{64   \textcolor{keyword}{using }\mbox{\hyperlink{a01296}{TractionType}}           = \mbox{\hyperlink{a01296}{Traction<LinearElastic<Basis\_, FERequirements\_, useEigenRef>}}, \mbox{\hyperlink{a01256}{Traits}}>;}
\DoxyCodeLine{65   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}}   = \mbox{\hyperlink{a01256_a43fba779ca28962b6c1ae5a78a6fa890}{Traits::mydim}};}
\DoxyCodeLine{66   \textcolor{keyword}{using }\mbox{\hyperlink{a01292_a1d9cc0964e73991e6a06ad38e7bfb78a}{LocalBasisType}}         = \textcolor{keyword}{decltype}(std::declval<LocalView>().tree().child(0).finiteElement().localBasis());}
\DoxyCodeLine{67 }
\DoxyCodeLine{81   \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{82   \mbox{\hyperlink{a01292_a99c658e2b0aa008672bfbc67e11c56db}{LinearElastic}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_ac67d77bbb42299a97ba00a00265a2a98}{Basis}}\& globalBasis, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keywordtype}{double} emod, \textcolor{keywordtype}{double} nu,}
\DoxyCodeLine{83                 VolumeLoad p\_volumeLoad = \{\}, \textcolor{keyword}{const} BoundaryPatch<GridView>* p\_neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{84                 NeumannBoundaryLoad p\_neumannBoundaryLoad = \{\})}
\DoxyCodeLine{85       : \mbox{\hyperlink{a01292_a18f201870e665245470e44ab1f677662}{BaseDisp}}(globalBasis, element),}
\DoxyCodeLine{86         \mbox{\hyperlink{a01292_afb5b60dfe956fa4b70195462b2e4ac0e}{VolumeType}}(p\_volumeLoad),}
\DoxyCodeLine{87         \mbox{\hyperlink{a01292_a68d172e1b8834272956a8fa7e138072e}{TractionType}}(p\_neumannBoundary, p\_neumannBoundaryLoad),}
\DoxyCodeLine{88         emod\_\{emod\},}
\DoxyCodeLine{89         nu\_\{nu\} \{}
\DoxyCodeLine{90     this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().bind(element);}
\DoxyCodeLine{91     \textcolor{keyword}{auto}\& first\_child = this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(0);}
\DoxyCodeLine{92     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe    = first\_child.finiteElement();}
\DoxyCodeLine{93     geo\_              = std::make\_shared<const Geometry>(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().\mbox{\hyperlink{a01292_a9d79259ab8e7093c190171a8b4ddff13}{geometry}}());}
\DoxyCodeLine{94     numberOfNodes\_    = fe.size();}
\DoxyCodeLine{95     order\_            = 2 * (fe.localBasis().order());}
\DoxyCodeLine{96     localBasis        = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{97     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().getQuadratureRule(order\_); \})}
\DoxyCodeLine{98       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{99         localBasis.bind(this-\/>localView().element().impl().getQuadratureRule(order\_), Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{100       \textcolor{keywordflow}{else}}
\DoxyCodeLine{101         localBasis.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), order\_),}
\DoxyCodeLine{102                         Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{103     \textcolor{keywordflow}{else}}
\DoxyCodeLine{104       localBasis.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), order\_),}
\DoxyCodeLine{105                       Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{106   \}}
\DoxyCodeLine{115   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{116   \textcolor{keyword}{auto} \mbox{\hyperlink{a01292_a80bcd6e7b26b4529df93d12314d92117}{displacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par,}
\DoxyCodeLine{117                             \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{118     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00303_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{119     \textcolor{keyword}{auto} disp     = Ikarus::FEHelper::localSolutionBlockVector<Traits>(d, this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}(), dx);}
\DoxyCodeLine{120     Dune::StandardLocalFunction uFunction(localBasis, disp, geo\_);}
\DoxyCodeLine{121     \textcolor{keywordflow}{return} uFunction;}
\DoxyCodeLine{122   \}}
\DoxyCodeLine{131   \textcolor{keyword}{template} <\textcolor{keyword}{class} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{132   \textcolor{keyword}{auto} \mbox{\hyperlink{a01292_a8622364f84baada158d636021dc3d3d4}{strainFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par,}
\DoxyCodeLine{133                       \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{134     \textcolor{keywordflow}{return} Dune::linearStrains(\mbox{\hyperlink{a01292_a80bcd6e7b26b4529df93d12314d92117}{displacementFunction}}(par, dx));}
\DoxyCodeLine{135   \}}
\DoxyCodeLine{136 }
\DoxyCodeLine{142   \textcolor{keyword}{auto} \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{143     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}} == 2)}
\DoxyCodeLine{144       \textcolor{keywordflow}{return} \mbox{\hyperlink{a00316_a90678a80e6b2b4849072623df02dae58}{planeStressLinearElasticMaterialTangent}}(emod\_, nu\_);}
\DoxyCodeLine{145     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}} == 3)}
\DoxyCodeLine{146       \textcolor{keywordflow}{return} \mbox{\hyperlink{a00316_afc9c57d60ca4a8c1075c44d926e497a8}{linearElasticMaterialTangent3D}}(emod\_, nu\_);}
\DoxyCodeLine{147   \}}
\DoxyCodeLine{148 }
\DoxyCodeLine{155   \textcolor{keyword}{auto} \mbox{\hyperlink{a01292_a23a003fe0c49bfc18714da0889b00c65}{materialTangentFunction}}([[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{156     \textcolor{keywordflow}{return} [\&]([[maybe\_unused]] \textcolor{keyword}{auto} gp) \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}(); \};}
\DoxyCodeLine{157   \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159   \textcolor{keyword}{const} \mbox{\hyperlink{a01292_a199e66dea3f46b43e92443e427335c20}{Geometry}}\& \mbox{\hyperlink{a01292_a9d79259ab8e7093c190171a8b4ddff13}{geometry}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} *geo\_; \}}
\DoxyCodeLine{160   [[nodiscard]] \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01292_ab6ce7edbeb15b437c5977d4f8962d03d}{numberOfNodes}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} numberOfNodes\_; \}}
\DoxyCodeLine{161   [[nodiscard]] \textcolor{keywordtype}{int} \mbox{\hyperlink{a01292_a2bf5dffeeb22108cae5126814dd98163}{order}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} order\_; \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{169   \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{a01292_afa5f1b3ac1cb7ccfa05d396377f8ac9c}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(par); \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{177   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01292_a35aa251bcd641913a8448b9502030349}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{178     calculateVectorImpl<double>(par, force);}
\DoxyCodeLine{179   \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{187   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01292_a9d491b6c69f9f28b2a838075526fa705}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{188     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01292_a8622364f84baada158d636021dc3d3d4}{strainFunction}}(par);}
\DoxyCodeLine{189     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{190     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}();}
\DoxyCodeLine{193     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{194       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{195       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{196         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}));}
\DoxyCodeLine{197         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < numberOfNodes\_; ++j) \{}
\DoxyCodeLine{198           \textcolor{keyword}{const} \textcolor{keyword}{auto} bopJ = eps.evaluateDerivative(gpIndex, wrt(coeff(j)), on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}));}
\DoxyCodeLine{199           K.template block<myDim, myDim>(i * \mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}}, j * \mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}}) += bopI.transpose() * C * bopJ * intElement;}
\DoxyCodeLine{200         \}}
\DoxyCodeLine{201       \}}
\DoxyCodeLine{202     \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{204     \textcolor{comment}{// Update due to displacement-\/dependent external loads, e.g., follower loads}}
\DoxyCodeLine{205     \mbox{\hyperlink{a01300_ab34ccd72bb7397283f7c2dcbf595841e}{VolumeType::calculateMatrix}}(par, K);}
\DoxyCodeLine{206     \mbox{\hyperlink{a01296_ad5b9f64124013ab2e98b6494e9b511b3}{TractionType::calculateMatrix}}(par, K);}
\DoxyCodeLine{207   \}}
\DoxyCodeLine{208 }
\DoxyCodeLine{216   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01292_a51a4d30fb9b0ee5c2bf7683b69f0eda9}{calculateAt}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_aab04fec155c76056c0c302352686787a}{ResultRequirementsType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{217                    \mbox{\hyperlink{a01248}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{218     \textcolor{keyword}{using namespace }Dune::Indices;}
\DoxyCodeLine{219     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{220     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{221 }
\DoxyCodeLine{222     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01292_a8622364f84baada158d636021dc3d3d4}{strainFunction}}(req.getFERequirements());}
\DoxyCodeLine{223     \textcolor{keyword}{const} \textcolor{keyword}{auto} C   = \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}();}
\DoxyCodeLine{224     \textcolor{keyword}{auto} epsVoigt  = eps.evaluate(local, on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}));}
\DoxyCodeLine{225 }
\DoxyCodeLine{226     \textcolor{keyword}{auto} \mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{linearStress}} = (C * epsVoigt).eval();}
\DoxyCodeLine{227 }
\DoxyCodeLine{228     \textcolor{keywordflow}{if} (req.isResultRequested(\mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}))}
\DoxyCodeLine{229       result.\mbox{\hyperlink{a01248_aa399a96000daf40950e388eb0b23a7c0}{insertOrAssignResult}}(\mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}, \mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{linearStress}});}
\DoxyCodeLine{230     \textcolor{keywordflow}{else}}
\DoxyCodeLine{231       DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The requested result type is NOT implemented."{}});}
\DoxyCodeLine{232   \}}
\DoxyCodeLine{233 }
\DoxyCodeLine{234 \textcolor{keyword}{private}:}
\DoxyCodeLine{235   std::shared\_ptr<const Geometry> geo\_;}
\DoxyCodeLine{236   Dune::CachedLocalBasis<std::remove\_cvref\_t<LocalBasisType>> localBasis;}
\DoxyCodeLine{237   \textcolor{keywordtype}{double} emod\_;}
\DoxyCodeLine{238   \textcolor{keywordtype}{double} nu\_;}
\DoxyCodeLine{239   \textcolor{keywordtype}{size\_t} numberOfNodes\_\{0\};}
\DoxyCodeLine{240   \textcolor{keywordtype}{int} order\_\{\};}
\DoxyCodeLine{241 }
\DoxyCodeLine{242 \textcolor{keyword}{protected}:}
\DoxyCodeLine{243   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{244   \textcolor{keyword}{auto} \mbox{\hyperlink{a01292_a2f4e42b682af401fcfaada66e5a05d53}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par,}
\DoxyCodeLine{245                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt) \textcolor{keyword}{const}}
\DoxyCodeLine{246       -\/> ScalarType \{}
\DoxyCodeLine{247     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01292_a80bcd6e7b26b4529df93d12314d92117}{displacementFunction}}(par, dx);}
\DoxyCodeLine{248     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps       = \mbox{\hyperlink{a01292_a8622364f84baada158d636021dc3d3d4}{strainFunction}}(par, dx);}
\DoxyCodeLine{249     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{250     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{251     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{252 }
\DoxyCodeLine{253     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}();}
\DoxyCodeLine{254 }
\DoxyCodeLine{255     ScalarType energy = 0.0;}
\DoxyCodeLine{256     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{257       \textcolor{keyword}{const} \textcolor{keyword}{auto} EVoigt = eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}));}
\DoxyCodeLine{258       energy += (0.5 * EVoigt.dot(C * EVoigt)) * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{259     \}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{262     energy += \mbox{\hyperlink{a01300_a38b6d9f88ad5734093413497e3ac7b29}{VolumeType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{263 }
\DoxyCodeLine{264     \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{265     energy += \mbox{\hyperlink{a01296_a3b3de553171d016228f21cbac1e7f47d}{TractionType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{266     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{267   \}}
\DoxyCodeLine{268 }
\DoxyCodeLine{269   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{270   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01292_a3cb0f7f1a2745097f3e91b9c0928722f}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01292_a50164592b0aa80d9027a707436cfc50c}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{271                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{272     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01292_a8622364f84baada158d636021dc3d3d4}{strainFunction}}(par, dx);}
\DoxyCodeLine{273     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{274     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{275 }
\DoxyCodeLine{276     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01292_ae9391f3895e965ecc5dfea1af1ac62f7}{materialTangent}}();}
\DoxyCodeLine{277 }
\DoxyCodeLine{278     \textcolor{comment}{// Internal forces}}
\DoxyCodeLine{279     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{280       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{281       \textcolor{keyword}{auto} stresses           = (C * eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}))).eval();}
\DoxyCodeLine{282       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{283         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01216_a0fe5d4e10f331905629351786c72ce6a}{gridElement}}));}
\DoxyCodeLine{284         force.template segment<myDim>(\mbox{\hyperlink{a01292_a2279ac283b972f47d58c51730ca47d6b}{myDim}} * i) += bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{285       \}}
\DoxyCodeLine{286     \}}
\DoxyCodeLine{287 }
\DoxyCodeLine{288     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{289     \mbox{\hyperlink{a01300_af2fc872a641d42398fc9d8bd60aa973c}{VolumeType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{290 }
\DoxyCodeLine{291     \textcolor{comment}{// External forces, boundary forces, i.e., at the Neumann boundary}}
\DoxyCodeLine{292     \mbox{\hyperlink{a01296_a0cac2c7cc2a06ae38bc83f97664e4d8c}{TractionType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{293   \}}
\DoxyCodeLine{294 \};}
\DoxyCodeLine{295 \} \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{296 }
\DoxyCodeLine{297 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{298 \textcolor{preprocessor}{  \#error LinearElastic depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{299 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
