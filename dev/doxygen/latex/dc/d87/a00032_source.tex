\hypertarget{a00032_source}{}\doxysection{vanishingstress.\+hh}
\label{a00032_source}\index{vanishingstress.hh@{vanishingstress.hh}}
\mbox{\hyperlink{a00032}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00038}{ikarus/finiteelements/mechanics/materials/interface.hh}}>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00068}{ikarus/linearalgebra/nonlinearoperator.hh}}>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00170}{ikarus/solver/nonlinearsolver/newtonraphson.hh}}>}}
\DoxyCodeLine{9 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00219}{Ikarus}} \{}
\DoxyCodeLine{10 }
\DoxyCodeLine{11   \textcolor{keyword}{namespace }Impl \{}
\DoxyCodeLine{12     \textcolor{keyword}{struct }StressIndexPair \{}
\DoxyCodeLine{13       Eigen::Index row;}
\DoxyCodeLine{14       Eigen::Index col;}
\DoxyCodeLine{15     \};}
\DoxyCodeLine{16 }
\DoxyCodeLine{17     \textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} size>}
\DoxyCodeLine{18     \textcolor{keyword}{consteval} \textcolor{keyword}{auto} createfreeVoigtIndices(\textcolor{keyword}{const} std::array<StressIndexPair, size> \&fixed) \{}
\DoxyCodeLine{19       std::array<size\_t, 6 -\/ size> res\{\};}
\DoxyCodeLine{20       std::array<size\_t, size> voigtFixedIndices;}
\DoxyCodeLine{21       std::ranges::transform(fixed, voigtFixedIndices.begin(), [](\textcolor{keyword}{auto} pair) \{ return toVoigt(pair.row, pair.col); \});}
\DoxyCodeLine{22       std::ranges::sort(voigtFixedIndices);}
\DoxyCodeLine{23       std::ranges::set\_difference(std::ranges::iota\_view(\textcolor{keywordtype}{size\_t}(0), \textcolor{keywordtype}{size\_t}(6)), voigtFixedIndices, res.begin());}
\DoxyCodeLine{24       std::ranges::sort(res);}
\DoxyCodeLine{25       \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{26     \}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28     \textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} size>}
\DoxyCodeLine{29     \textcolor{keyword}{consteval} \textcolor{keyword}{auto} createFixedVoigtIndices(\textcolor{keyword}{const} std::array<StressIndexPair, size> \&fixed) \{}
\DoxyCodeLine{30       std::array<size\_t, size> fixedIndices;}
\DoxyCodeLine{31       std::ranges::transform(fixed, fixedIndices.begin(), [](\textcolor{keyword}{auto} pair) \{ return toVoigt(pair.row, pair.col); \});}
\DoxyCodeLine{32       std::ranges::sort(fixedIndices);}
\DoxyCodeLine{33       \textcolor{keywordflow}{return} fixedIndices;}
\DoxyCodeLine{34     \}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} size>}
\DoxyCodeLine{37     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} countDiagonalIndices(\textcolor{keyword}{const} std::array<StressIndexPair, size> \&fixed) \{}
\DoxyCodeLine{38       \textcolor{keywordtype}{size\_t} count = 0;}
\DoxyCodeLine{39       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} v : fixed) \{}
\DoxyCodeLine{40         \textcolor{keywordflow}{if} (v.col == v.row) ++count;}
\DoxyCodeLine{41       \}}
\DoxyCodeLine{42       \textcolor{keywordflow}{return} count;}
\DoxyCodeLine{43     \}}
\DoxyCodeLine{44   \}  \textcolor{comment}{// namespace Impl}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46   \textcolor{keyword}{template} <auto stressIndexPair, \textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{47   \textcolor{keyword}{struct }\mbox{\hyperlink{a01165}{VanishingStress}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01161}{Material}}<VanishingStress<stressIndexPair, MaterialImpl>> \{}
\DoxyCodeLine{48     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01165_a9a6d28f0977eda48a8a2d5f8e0aac8f6}{VanishingStress}}(\mbox{\hyperlink{a01165}{MaterialImpl}} mat, \textcolor{keyword}{typename} \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{MaterialImpl::ScalarType}} p\_tol = 1e-\/12)}
\DoxyCodeLine{49         : matImpl\{mat\}, tol\{p\_tol\} \{\}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{keyword}{using }\mbox{\hyperlink{a01165}{Underlying}} = \mbox{\hyperlink{a01161_a2625db92f4b2b2026b959dfffa95344f}{MaterialImpl}};}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}                    = stressIndexPair;}
\DoxyCodeLine{54     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a2d54836e17bf2fe768337d0c3044189e}{freeVoigtIndices}}              = createfreeVoigtIndices(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}});}
\DoxyCodeLine{55     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a22cf6e6afdbdf2c3442f353df4df43c3}{fixedVoigtIndices}}             = createFixedVoigtIndices(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}});}
\DoxyCodeLine{56     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a3b415fdc6e7ec6c5f0dfb896fbb157c5}{fixedDiagonalVoigtIndicesSize}} = countDiagonalIndices(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}});}
\DoxyCodeLine{57     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a335c313f483cd9b6c9aae7a8939e012e}{freeStrains}}                   = \mbox{\hyperlink{a01165_a2d54836e17bf2fe768337d0c3044189e}{freeVoigtIndices}}.size();}
\DoxyCodeLine{58     \textcolor{keyword}{using }\mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}}                                    = \textcolor{keyword}{typename} \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{MaterialImpl::ScalarType}};}
\DoxyCodeLine{59     \textcolor{comment}{// https://godbolt.org/z/hcs7j5rq7}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     [[nodiscard]] \textcolor{keyword}{constexpr} std::string \mbox{\hyperlink{a01165_a30f66cb6f5ccb30e08e152b0ce9e5878}{nameImpl}}() const noexcept \{}
\DoxyCodeLine{62       \textcolor{keyword}{auto} matName = matImpl.\mbox{\hyperlink{a01161_a817f370a63450c90d263d29e82bb4fe9}{name}}() + \textcolor{stringliteral}{"{}\_Vanishing("{}};}
\DoxyCodeLine{63       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} p : \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}})}
\DoxyCodeLine{64         matName += \textcolor{stringliteral}{"{}("{}} + std::to\_string(p.row) + std::to\_string(p.col) + \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{65       matName += \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{66       \textcolor{keywordflow}{return} matName;}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a1b26c785517e451f78bebea9138468ab}{strainTag}}          = \mbox{\hyperlink{a01165_a1b26c785517e451f78bebea9138468ab}{MaterialImpl::strainTag}};}
\DoxyCodeLine{70     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a28b62b4e231713db324d97f0a86f4370}{stressTag}}          = \mbox{\hyperlink{a01165_a28b62b4e231713db324d97f0a86f4370}{MaterialImpl::stressTag}};}
\DoxyCodeLine{71     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_ac14957720de3575a99423a33ec38e4a4}{tangentModuliTag}}   = \mbox{\hyperlink{a01165_ac14957720de3575a99423a33ec38e4a4}{MaterialImpl::tangentModuliTag}};}
\DoxyCodeLine{72     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01165_a6c66547d214dc1e4dd54c0002de1eaf2}{energyAcceptsVoigt}} = \mbox{\hyperlink{a01165_a6c66547d214dc1e4dd54c0002de1eaf2}{MaterialImpl::energyAcceptsVoigt}};}
\DoxyCodeLine{73     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01165_a2c6607a26a8c24687cf88efc041a434c}{stressToVoigt}}      = \textcolor{keyword}{true};}
\DoxyCodeLine{74     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01165_ac209ebf251b62ac6f4184fb9f42ce718}{stressAcceptsVoigt}} = \textcolor{keyword}{true};}
\DoxyCodeLine{75     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01165_aac703706261e71517a62cc02e6681dce}{moduliToVoigt}}      = \textcolor{keyword}{true};}
\DoxyCodeLine{76     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01165_a55c0c5ea836671191ea21dba48168a95}{moduliAcceptsVoigt}} = \textcolor{keyword}{true};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{79     \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}} \mbox{\hyperlink{a01165_aa27b5462fbbb965c8cb5689834c755c3}{storedEnergyImpl}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived> \&E)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{80       \textcolor{keyword}{const} \textcolor{keyword}{auto} [nonOp, Esol] = reduceStress(E);}
\DoxyCodeLine{81       \textcolor{keywordflow}{return} matImpl.\mbox{\hyperlink{a01165_aa27b5462fbbb965c8cb5689834c755c3}{storedEnergyImpl}}(Esol);}
\DoxyCodeLine{82     \}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{keyword}{template} <\textcolor{keywordtype}{bool} voigt, \textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{85     \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a09ee586572c98a89b4b63e4952687ad4}{stressesImpl}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived> \&E)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{86       \textcolor{keyword}{const} \textcolor{keyword}{auto} [nonOp, Esol] = reduceStress(E);}
\DoxyCodeLine{87       \textcolor{keyword}{auto} stressesRed         = matImpl.template stresses<MaterialImpl::strainTag, true>(Esol);}
\DoxyCodeLine{88 }
\DoxyCodeLine{89       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (voigt) \{}
\DoxyCodeLine{90         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a2f675229501979101656ec4dee7764d5}{removeCol}}(stressesRed, \mbox{\hyperlink{a01165_a22cf6e6afdbdf2c3442f353df4df43c3}{fixedVoigtIndices}});}
\DoxyCodeLine{91       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{92         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(stressesRed, \textcolor{keyword}{false});}
\DoxyCodeLine{93     \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \textcolor{keyword}{template} <\textcolor{keywordtype}{bool} voigt, \textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{96     \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_a3fb115007e1e4323b8f3d46f2b681ff0}{tangentModuliImpl}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived> \&E)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{97       \textcolor{keyword}{const} \textcolor{keyword}{auto} [nonOp, Esol] = reduceStress(E);}
\DoxyCodeLine{98       \textcolor{keyword}{auto} C                   = matImpl.template tangentModuli<MaterialImpl::strainTag, true>(Esol);}
\DoxyCodeLine{99       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (voigt)}
\DoxyCodeLine{100         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a19d425a4fbc72c2ef7a97d71de9329a4}{staticCondensation}}(C, \mbox{\hyperlink{a01165_a22cf6e6afdbdf2c3442f353df4df43c3}{fixedVoigtIndices}});}
\DoxyCodeLine{101       \textcolor{keywordflow}{else}}
\DoxyCodeLine{102         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(C);}
\DoxyCodeLine{103     \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarTypeOther>}
\DoxyCodeLine{106     \textcolor{keyword}{auto} \mbox{\hyperlink{a01165_abe41f8e6a9be4ed8c7a5bf54f0774c9d}{rebind}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{107       \textcolor{keyword}{auto} reboundMatImpl = matImpl.template rebind<ScalarTypeOther>();}
\DoxyCodeLine{108       \textcolor{keywordflow}{return} \mbox{\hyperlink{a01165}{VanishingStress<stressIndexPair, decltype(reboundMatImpl)>}}(reboundMatImpl, tol);}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111   \textcolor{keyword}{private}:}
\DoxyCodeLine{112     \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{113     \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) maybeFromVoigt(\textcolor{keyword}{const} Eigen::MatrixBase<Derived> \&E) \textcolor{keyword}{const} \{}
\DoxyCodeLine{114       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01581}{Concepts::EigenVector<Derived>}}) \{  \textcolor{comment}{// receiving vector means Voigt notation}}
\DoxyCodeLine{115         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(E.derived(), \textcolor{keyword}{true});}
\DoxyCodeLine{116       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{117         \textcolor{keywordflow}{return} E.derived();}
\DoxyCodeLine{118     \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{121     \textcolor{keywordtype}{void} initUnknownStrains(Eigen::MatrixBase<Derived> \&E)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{122       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}.size(); ++i) \{}
\DoxyCodeLine{123         \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}} initialVal = E(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].row, \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].col);}
\DoxyCodeLine{124         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01165_a1b26c785517e451f78bebea9138468ab}{strainTag}} == StrainTags::deformationGradient or \mbox{\hyperlink{a01165_a1b26c785517e451f78bebea9138468ab}{strainTag}} == StrainTags::rightCauchyGreenTensor) \{}
\DoxyCodeLine{125           \textcolor{keywordflow}{if} (Dune::FloatCmp::eq(initialVal, \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}}(0.0)) and (\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].row == \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].col))}
\DoxyCodeLine{126             initialVal = \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}}(1.0);}
\DoxyCodeLine{127         \}}
\DoxyCodeLine{128         \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].row != \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].col) initialVal = \mbox{\hyperlink{a01165_a01a5f04bd4cf950907221fd2fe65c8da}{ScalarType}}(0.0);}
\DoxyCodeLine{129         E(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].row, \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].col) = E(\mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].col, \mbox{\hyperlink{a01165_a783fd98a63a76e58e40dbd15eaad23be}{fixedPairs}}[i].row) = initialVal;}
\DoxyCodeLine{130       \}}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{134     \textcolor{keyword}{auto} reduceStress(\textcolor{keyword}{const} Eigen::MatrixBase<Derived> \&p\_Eraw)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{135       \textcolor{keyword}{auto} E = maybeFromVoigt(p\_Eraw);}
\DoxyCodeLine{136       initUnknownStrains(E);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138       std::array<size\_t, fixedDiagonalVoigtIndicesSize> fixedDiagonalVoigtIndices;}
\DoxyCodeLine{139       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} ri = 0; \textcolor{keyword}{auto} i : \mbox{\hyperlink{a01165_a22cf6e6afdbdf2c3442f353df4df43c3}{fixedVoigtIndices}}) \{}
\DoxyCodeLine{140         \textcolor{keyword}{auto} indexPair = \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(i);}
\DoxyCodeLine{141         \textcolor{keywordflow}{if} (indexPair[0] == indexPair[1]) fixedDiagonalVoigtIndices[ri++] = i;}
\DoxyCodeLine{142       \}}
\DoxyCodeLine{143       \textcolor{keyword}{auto} f = [\&](\textcolor{keyword}{auto} \&) \{}
\DoxyCodeLine{144         \textcolor{keyword}{auto} S = matImpl.template stresses<MaterialImpl::strainTag, true>(E);}
\DoxyCodeLine{145         \textcolor{keywordflow}{return} S(fixedDiagonalVoigtIndices).eval();}
\DoxyCodeLine{146       \};}
\DoxyCodeLine{147       \textcolor{keyword}{auto} df = [\&](\textcolor{keyword}{auto} \&) \{}
\DoxyCodeLine{148         \textcolor{keyword}{auto} moduli = (matImpl.template tangentModuli<MaterialImpl::strainTag, true>(E)).\mbox{\hyperlink{a00219_a746ffb7ea71ab7ea16727793ff59c3c7}{eval}}();}
\DoxyCodeLine{149         \textcolor{keywordflow}{return} (moduli(fixedDiagonalVoigtIndices, fixedDiagonalVoigtIndices) / MaterialImpl::derivativeFactor).\mbox{\hyperlink{a00219_a746ffb7ea71ab7ea16727793ff59c3c7}{eval}}();}
\DoxyCodeLine{150       \};}
\DoxyCodeLine{151 }
\DoxyCodeLine{152       \textcolor{keyword}{auto} Er    = E(fixedDiagonalVoigtIndices, fixedDiagonalVoigtIndices).eval().template cast<ScalarType>();}
\DoxyCodeLine{153       \textcolor{keyword}{auto} nonOp = \mbox{\hyperlink{a01253}{Ikarus::NonLinearOperator}}(\mbox{\hyperlink{a00219_ab787b670f0d338c870988f417cf85f76}{functions}}(f, df), \mbox{\hyperlink{a00219_ac00abda505aa8ccc73ce59afd165ce49}{parameter}}(Er));}
\DoxyCodeLine{154       \textcolor{keyword}{auto} nr    = \mbox{\hyperlink{a00219_a2079d0f7ad48c1f17d114e6f62f4d80d}{Ikarus::makeNewtonRaphson}}(}
\DoxyCodeLine{155              nonOp, [\&](\textcolor{keyword}{auto} \&r, \textcolor{keyword}{auto} \&A) \{ \textcolor{keywordflow}{return} (A.inverse() * r).eval(); \},}
\DoxyCodeLine{156              [\&](\textcolor{keyword}{auto}    \&\textcolor{comment}{/* Ex33 */}, \textcolor{keyword}{auto} \&Ecomps) \{}
\DoxyCodeLine{157             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ri = 0; \textcolor{keyword}{auto} i : fixedDiagonalVoigtIndices) \{}
\DoxyCodeLine{158               \textcolor{keyword}{auto} indexPair = \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(i);}
\DoxyCodeLine{159               E(indexPair[0], indexPair[1]) += Ecomps(ri++);}
\DoxyCodeLine{160             \}}
\DoxyCodeLine{161              \});}
\DoxyCodeLine{162       nr-\/>setup(\{.tol = tol, .maxIter = 100\});}
\DoxyCodeLine{163       \textcolor{keywordflow}{if} (!\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{bool}\textcolor{keyword}{>}(nr-\/>solve()))}
\DoxyCodeLine{164         DUNE\_THROW(Dune::MathError, \textcolor{stringliteral}{"{}The stress reduction of material "{}} << \mbox{\hyperlink{a01165_a30f66cb6f5ccb30e08e152b0ce9e5878}{nameImpl}}() << \textcolor{stringliteral}{"{} was unsuccessful\(\backslash\)n"{}}}
\DoxyCodeLine{165                                                                         << \textcolor{stringliteral}{"{}The strains are\(\backslash\)n"{}}}
\DoxyCodeLine{166                                                                         << E << \textcolor{stringliteral}{"{}\(\backslash\)n The stresses are\(\backslash\)n"{}}}
\DoxyCodeLine{167                                                                         << f(Er));}
\DoxyCodeLine{168       \textcolor{keywordflow}{return} std::make\_pair(nonOp, E);}
\DoxyCodeLine{169     \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171     \mbox{\hyperlink{a01161_a2625db92f4b2b2026b959dfffa95344f}{MaterialImpl}} matImpl;}
\DoxyCodeLine{172     \textcolor{keywordtype}{double} tol\{\};}
\DoxyCodeLine{173   \};}
\DoxyCodeLine{174 }
\DoxyCodeLine{175   \textcolor{keyword}{template} <Impl::StressIndexPair... stressIndexPair, \textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{176   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a317c0a50c0a7d482e2a20d8146e08df8}{makeVanishingStress}}(MaterialImpl mat, \textcolor{keyword}{typename} MaterialImpl::ScalarType p\_tol = 1e-\/12) \{}
\DoxyCodeLine{177     \textcolor{keywordflow}{return} \mbox{\hyperlink{a01165}{VanishingStress}}<std::to\_array(\{stressIndexPair...\}), MaterialImpl>(mat, p\_tol);}
\DoxyCodeLine{178   \}}
\DoxyCodeLine{179 }
\DoxyCodeLine{180   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{181   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a9b0fa242d65e9b14680cedcbaeed3301}{planeStress}}(\textcolor{keyword}{const} MaterialImpl \&mat, \textcolor{keyword}{typename} MaterialImpl::ScalarType p\_tol = 1e-\/8) \{}
\DoxyCodeLine{182     \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a317c0a50c0a7d482e2a20d8146e08df8}{makeVanishingStress}}<Impl::StressIndexPair\{2, 1\}, Impl::StressIndexPair\{2, 0\}, Impl::StressIndexPair\{2, 2\}>(}
\DoxyCodeLine{183         mat, p\_tol);}
\DoxyCodeLine{184   \}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{187   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a97580749c5279282142d9e17d612b77e}{shellMaterial}}(\textcolor{keyword}{const} MaterialImpl \&mat, \textcolor{keyword}{typename} MaterialImpl::ScalarType p\_tol = 1e-\/8) \{}
\DoxyCodeLine{188     \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a317c0a50c0a7d482e2a20d8146e08df8}{makeVanishingStress}}<Impl::StressIndexPair\{2, 2\}>(mat, p\_tol);}
\DoxyCodeLine{189   \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   \textcolor{keyword}{template} <\textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{192   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a9bf89561a3cb74c038a5e137608ee22d}{beamMaterial}}(\textcolor{keyword}{const} MaterialImpl \&mat, \textcolor{keyword}{typename} MaterialImpl::ScalarType p\_tol = 1e-\/8) \{}
\DoxyCodeLine{193     \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a317c0a50c0a7d482e2a20d8146e08df8}{makeVanishingStress}}<Impl::StressIndexPair\{1, 1\}, Impl::StressIndexPair\{2, 2\}>(mat, p\_tol);}
\DoxyCodeLine{194   \}}
\DoxyCodeLine{195 \}  \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
