\hypertarget{a00197_source}{}\doxysection{enhancedassumedstrains.\+hh}
\label{a00197_source}\index{enhancedassumedstrains.hh@{enhancedassumedstrains.hh}}
\mbox{\hyperlink{a00197}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{12 \textcolor{preprocessor}{  \#include <dune/localfefunctions/derivativetransformators.hh>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{  \#include <dune/localfefunctions/linearAlgebraHelper.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{  \#include <dune/localfefunctions/meta.hh>}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00170}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00227}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00026}{ikarus/utils/eigendunetransformations.hh}}>}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00316}{Ikarus}} \{}
\DoxyCodeLine{21 }
\DoxyCodeLine{31 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{32 Eigen::Matrix3d \mbox{\hyperlink{a00316_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(\textcolor{keyword}{const} Geometry\& geometry) \{}
\DoxyCodeLine{33   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& referenceElement = Dune::ReferenceElements<double, 2>::general(geometry.type());}
\DoxyCodeLine{34   \textcolor{keyword}{const} \textcolor{keyword}{auto} quadPos0          = referenceElement.position(0, 0);}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{keyword}{const} \textcolor{keyword}{auto} jacobianinvT0 = toEigen(geometry.jacobianInverseTransposed(quadPos0));}
\DoxyCodeLine{37   \textcolor{keyword}{const} \textcolor{keyword}{auto} detJ0         = geometry.integrationElement(quadPos0);}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \textcolor{keyword}{auto} jaco = (jacobianinvT0).inverse().eval();}
\DoxyCodeLine{40   \textcolor{keyword}{auto} J11  = jaco(0, 0);}
\DoxyCodeLine{41   \textcolor{keyword}{auto} J12  = jaco(0, 1);}
\DoxyCodeLine{42   \textcolor{keyword}{auto} J21  = jaco(1, 0);}
\DoxyCodeLine{43   \textcolor{keyword}{auto} J22  = jaco(1, 1);}
\DoxyCodeLine{44 }
\DoxyCodeLine{45   Eigen::Matrix3d T0;}
\DoxyCodeLine{46   \textcolor{comment}{// clang-\/format off}}
\DoxyCodeLine{47     T0 <<      J11 * J11, J12 * J12,                   J11 * J12,}
\DoxyCodeLine{48                J21 * J21, J22 * J22,                   J21 * J22,}
\DoxyCodeLine{49          2.0 * J11 * J21, 2.0 * J12 * J22, J21 * J12 + J11 * J22;}
\DoxyCodeLine{50   \textcolor{comment}{// clang-\/format on}}
\DoxyCodeLine{51   \textcolor{keywordflow}{return} T0.inverse() * detJ0;}
\DoxyCodeLine{52 \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{63 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{64 Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a00316_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(\textcolor{keyword}{const} Geometry\& geometry) \{}
\DoxyCodeLine{65   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& referenceElement = Dune::ReferenceElements<double, 3>::general(geometry.type());}
\DoxyCodeLine{66   \textcolor{keyword}{const} \textcolor{keyword}{auto} quadPos0          = referenceElement.position(0, 0);}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{keyword}{const} \textcolor{keyword}{auto} jacobianinvT0 = toEigen(geometry.jacobianInverseTransposed(quadPos0));}
\DoxyCodeLine{69   \textcolor{keyword}{const} \textcolor{keyword}{auto} detJ0         = geometry.integrationElement(quadPos0);}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   \textcolor{keyword}{auto} jaco = (jacobianinvT0).inverse().eval();}
\DoxyCodeLine{72   \textcolor{keyword}{auto} J11  = jaco(0, 0);}
\DoxyCodeLine{73   \textcolor{keyword}{auto} J12  = jaco(0, 1);}
\DoxyCodeLine{74   \textcolor{keyword}{auto} J13  = jaco(0, 2);}
\DoxyCodeLine{75   \textcolor{keyword}{auto} J21  = jaco(1, 0);}
\DoxyCodeLine{76   \textcolor{keyword}{auto} J22  = jaco(1, 1);}
\DoxyCodeLine{77   \textcolor{keyword}{auto} J23  = jaco(1, 2);}
\DoxyCodeLine{78   \textcolor{keyword}{auto} J31  = jaco(2, 0);}
\DoxyCodeLine{79   \textcolor{keyword}{auto} J32  = jaco(2, 1);}
\DoxyCodeLine{80   \textcolor{keyword}{auto} J33  = jaco(2, 2);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   Eigen::Matrix<double, 6, 6> T0;}
\DoxyCodeLine{83   \textcolor{comment}{// clang-\/format off}}
\DoxyCodeLine{84     T0 <<      J11 * J11,       J12 * J12,       J13 * J13,             J11 * J12,             J11 * J13,             J12 * J13,}
\DoxyCodeLine{85                J21 * J21,       J22 * J22,       J23 * J23,             J21 * J22,             J21 * J23,             J22 * J23,}
\DoxyCodeLine{86                J31 * J31,       J32 * J32,       J33 * J33,             J31 * J32,             J31 * J33,             J32 * J33,}
\DoxyCodeLine{87          2.0 * J11 * J21, 2.0 * J12 * J22, 2.0 * J13 * J23, J11 * J22 + J21 * J12, J11 * J23 + J21 * J13, J12 * J23 + J22 * J13,}
\DoxyCodeLine{88          2.0 * J11 * J31, 2.0 * J12 * J32, 2.0 * J13 * J33, J11 * J32 + J31 * J12, J11 * J33 + J31 * J13, J12 * J33 + J32 * J13,}
\DoxyCodeLine{89          2.0 * J31 * J21, 2.0 * J32 * J22, 2.0 * J33 * J23, J31 * J22 + J21 * J32, J31 * J23 + J21 * J33, J32 * J23 + J22 * J33;}
\DoxyCodeLine{90   \textcolor{comment}{// clang-\/format on}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{keywordflow}{return} T0.inverse() * detJ0;}
\DoxyCodeLine{93 \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{104 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{105 \textcolor{keyword}{struct }\mbox{\hyperlink{a01260}{EASQ1E4}}}
\DoxyCodeLine{106 \{}
\DoxyCodeLine{107   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01260_a091b2d7ab16564e0355e5078fae6eabd}{strainSize}}         = 3;}
\DoxyCodeLine{108   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01260_ad14763e1531d0b04751e51cc1ca0f23f}{enhancedStrainSize}} = 4;}
\DoxyCodeLine{109   \textcolor{keyword}{using }\mbox{\hyperlink{a01260_aa88f171600c9a12e1e56f0eac6184b20}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{110 }
\DoxyCodeLine{111   \mbox{\hyperlink{a01260_ac30d67e782b291e459cad4eacdf16cf2}{EASQ1E4}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{112   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01260_a322fdf68966e7fb0ee8165f0c966cc40}{EASQ1E4}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{113       : \mbox{\hyperlink{a01260_a98834915295f56b2eb15eae744202339}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{114         \mbox{\hyperlink{a01260_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}}\{\mbox{\hyperlink{a00316_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116   \textcolor{keyword}{auto} \mbox{\hyperlink{a01260_a69fd71138345d01372e9434a1fa904fe}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{117     \mbox{\hyperlink{a01260_aa88f171600c9a12e1e56f0eac6184b20}{MType}} M;}
\DoxyCodeLine{118     M.setZero(\mbox{\hyperlink{a01260_a091b2d7ab16564e0355e5078fae6eabd}{strainSize}}, \mbox{\hyperlink{a01260_ad14763e1531d0b04751e51cc1ca0f23f}{enhancedStrainSize}});}
\DoxyCodeLine{119     \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{120     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{121     M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{122     M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{123     M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{124     M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{125     \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01260_a98834915295f56b2eb15eae744202339}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{126     M                 = \mbox{\hyperlink{a01260_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{127     \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{128   \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   std::shared\_ptr<Geometry> \mbox{\hyperlink{a01260_a98834915295f56b2eb15eae744202339}{geometry}};}
\DoxyCodeLine{131   Eigen::Matrix3d \mbox{\hyperlink{a01260_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}};}
\DoxyCodeLine{132 \};}
\DoxyCodeLine{133 }
\DoxyCodeLine{141 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{142 \textcolor{keyword}{struct }\mbox{\hyperlink{a01264}{EASQ1E5}}}
\DoxyCodeLine{143 \{}
\DoxyCodeLine{144   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01264_ac0cb21ead6bd716ddee697328ba429f7}{strainSize}}         = 3;}
\DoxyCodeLine{145   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01264_a295cad836cda5a090316e80d37107d97}{enhancedStrainSize}} = 5;}
\DoxyCodeLine{146   \textcolor{keyword}{using }\mbox{\hyperlink{a01264_a00ce3ccf82b2acbae524f52ea42de95a}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{147 }
\DoxyCodeLine{148   \mbox{\hyperlink{a01264_a4f508bc3cac3ed9504183f1768eca6a1}{EASQ1E5}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{149   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01264_a56469a9df101001a6aad3aab9e51b568}{EASQ1E5}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{150       : \mbox{\hyperlink{a01264_a933c1aed3dbfda6e87955129651ca3e2}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{151         \mbox{\hyperlink{a01264_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}}\{\mbox{\hyperlink{a00316_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   \textcolor{keyword}{auto} \mbox{\hyperlink{a01264_a624d83c80aa923e821696c9cc2deef85}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{154     \mbox{\hyperlink{a01264_a00ce3ccf82b2acbae524f52ea42de95a}{MType}} M;}
\DoxyCodeLine{155     M.setZero();}
\DoxyCodeLine{156     \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{157     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{158     M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{159     M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{160     M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{161     M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{162     M(2, 4)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{163     \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01264_a933c1aed3dbfda6e87955129651ca3e2}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{164     M                 = \mbox{\hyperlink{a01264_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{165     \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{166   \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168   std::shared\_ptr<Geometry> \mbox{\hyperlink{a01264_a933c1aed3dbfda6e87955129651ca3e2}{geometry}};}
\DoxyCodeLine{169   Eigen::Matrix3d \mbox{\hyperlink{a01264_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}};}
\DoxyCodeLine{170 \};}
\DoxyCodeLine{171 }
\DoxyCodeLine{179 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{180 \textcolor{keyword}{struct }\mbox{\hyperlink{a01268}{EASQ1E7}}}
\DoxyCodeLine{181 \{}
\DoxyCodeLine{182   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01268_a7b988c0a64a63311a1c6861a4a45ed4f}{strainSize}}         = 3;}
\DoxyCodeLine{183   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01268_ad0b8cacc2ddc15f583977858ee760077}{enhancedStrainSize}} = 7;}
\DoxyCodeLine{184   \textcolor{keyword}{using }\mbox{\hyperlink{a01268_a38aee3dda331f7f4071c6348ea511cca}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \mbox{\hyperlink{a01268_a59966ec62660dc7eeb1f12400b3ad672}{EASQ1E7}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{187   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01268_a8ac7ec46a513c44a892e48e297324abf}{EASQ1E7}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{188       : \mbox{\hyperlink{a01268_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{189         \mbox{\hyperlink{a01268_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}}\{\mbox{\hyperlink{a00316_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   \textcolor{keyword}{auto} \mbox{\hyperlink{a01268_a984954a677451b2f71a968c8e30d5658}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{192     \mbox{\hyperlink{a01268_a38aee3dda331f7f4071c6348ea511cca}{MType}} M;}
\DoxyCodeLine{193     M.setZero();}
\DoxyCodeLine{194     \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{195     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{196     M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{197     M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{198     M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{199     M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{200     M(0, 4)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{201     M(1, 5)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{202     M(2, 6)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{203     \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01268_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{204     M                 = \mbox{\hyperlink{a01268_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{205     \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{206   \}}
\DoxyCodeLine{207 }
\DoxyCodeLine{208   std::shared\_ptr<Geometry> \mbox{\hyperlink{a01268_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}};}
\DoxyCodeLine{209   Eigen::Matrix3d \mbox{\hyperlink{a01268_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}};}
\DoxyCodeLine{210 \};}
\DoxyCodeLine{211 }
\DoxyCodeLine{219 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{220 \textcolor{keyword}{struct }\mbox{\hyperlink{a01272}{EASH1E9}}}
\DoxyCodeLine{221 \{}
\DoxyCodeLine{222   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01272_a3a3b04261ab9c37d87211f79317b6c72}{strainSize}}         = 6;}
\DoxyCodeLine{223   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01272_acece1d0df4ecbe282f035d1961f632d8}{enhancedStrainSize}} = 9;}
\DoxyCodeLine{224   \textcolor{keyword}{using }\mbox{\hyperlink{a01272_a7212ed3754aa79af50a76848d95eb4d5}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{225 }
\DoxyCodeLine{226   \mbox{\hyperlink{a01272_a5d74fc8ebfb04e85b70d8bd252624552}{EASH1E9}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{227   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01272_a32418ed3d63b290057d27523e468873f}{EASH1E9}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{228       : \mbox{\hyperlink{a01272_a9348ce08ebf36d33aebade14c436a313}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{229         \mbox{\hyperlink{a01272_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}}\{\mbox{\hyperlink{a00316_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(geometry\_)\} \{\}}
\DoxyCodeLine{230 }
\DoxyCodeLine{231   \textcolor{keyword}{auto} \mbox{\hyperlink{a01272_a00fa6978f126c09a3961b18e460155e7}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, 3>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{232     \mbox{\hyperlink{a01272_a7212ed3754aa79af50a76848d95eb4d5}{MType}} M;}
\DoxyCodeLine{233     M.setZero();}
\DoxyCodeLine{234     \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{235     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{236     \textcolor{keyword}{const} \textcolor{keywordtype}{double} zeta = quadPos[2];}
\DoxyCodeLine{237     M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{238     M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{239     M(2, 2)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{240     M(3, 3)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{241     M(3, 4)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{242     M(4, 5)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{243     M(4, 6)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{244     M(5, 7)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{245     M(5, 8)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{246     \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01272_a9348ce08ebf36d33aebade14c436a313}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{247     M                 = \mbox{\hyperlink{a01272_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{248     \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{249   \}}
\DoxyCodeLine{250   std::shared\_ptr<Geometry> \mbox{\hyperlink{a01272_a9348ce08ebf36d33aebade14c436a313}{geometry}};}
\DoxyCodeLine{251   Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a01272_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}};}
\DoxyCodeLine{252 \};}
\DoxyCodeLine{253 }
\DoxyCodeLine{261 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{262 \textcolor{keyword}{struct }\mbox{\hyperlink{a01276}{EASH1E21}}}
\DoxyCodeLine{263 \{}
\DoxyCodeLine{264   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01276_add6a1247960eb038a2cc4d129b0b79e5}{strainSize}}         = 6;}
\DoxyCodeLine{265   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01276_af2217d81619792495bb7ee6ea40205bd}{enhancedStrainSize}} = 21;}
\DoxyCodeLine{266   \textcolor{keyword}{using }\mbox{\hyperlink{a01276_ae4d88268d8bbccfa19801db35b60564f}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{267 }
\DoxyCodeLine{268   \mbox{\hyperlink{a01276_a8c5b5847f3fec76168c02e05114b1df5}{EASH1E21}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{269   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01276_a72cdd4c83d4373c7623f9a397eb6d520}{EASH1E21}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{270       : \mbox{\hyperlink{a01276_adde8fea3f6eb6e806044c5131a7bc919}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{271         \mbox{\hyperlink{a01276_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}}\{\mbox{\hyperlink{a00316_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(geometry\_)\} \{\}}
\DoxyCodeLine{272 }
\DoxyCodeLine{273   \textcolor{keyword}{auto} \mbox{\hyperlink{a01276_a58741a35769a0b13c530e47ffd8dffcd}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, 3>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{274     \mbox{\hyperlink{a01276_ae4d88268d8bbccfa19801db35b60564f}{MType}} M;}
\DoxyCodeLine{275     M.setZero();}
\DoxyCodeLine{276     \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{277     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{278     \textcolor{keyword}{const} \textcolor{keywordtype}{double} zeta = quadPos[2];}
\DoxyCodeLine{279     M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{280     M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{281     M(2, 2)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{282     M(3, 3)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{283     M(3, 4)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{284     M(4, 5)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{285     M(4, 6)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{286     M(5, 7)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{287     M(5, 8)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{288 }
\DoxyCodeLine{289     M(3, 9)  = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{290     M(3, 10) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{291     M(4, 11) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{292     M(4, 12) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{293     M(5, 13) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{294     M(5, 14) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{295 }
\DoxyCodeLine{296     M(0, 15) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{297     M(0, 16) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{298     M(1, 17) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{299     M(1, 18) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{300     M(2, 19) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{301     M(2, 20) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{302 }
\DoxyCodeLine{303     \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01276_adde8fea3f6eb6e806044c5131a7bc919}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{304     M                 = \mbox{\hyperlink{a01276_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{305     \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{306   \}}
\DoxyCodeLine{307 }
\DoxyCodeLine{308   std::shared\_ptr<Geometry> \mbox{\hyperlink{a01276_adde8fea3f6eb6e806044c5131a7bc919}{geometry}};}
\DoxyCodeLine{309   Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a01276_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}};}
\DoxyCodeLine{310 \};}
\DoxyCodeLine{311 }
\DoxyCodeLine{319 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{320 \textcolor{keyword}{using }\mbox{\hyperlink{a00316_a87e3feaaba5839ab7b515df24438c07f}{EAS2DVariant}} = std::variant<std::monostate, EASQ1E4<Geometry>, \mbox{\hyperlink{a01264}{EASQ1E5<Geometry>}}, \mbox{\hyperlink{a01268}{EASQ1E7<Geometry>}}>;}
\DoxyCodeLine{321 }
\DoxyCodeLine{329 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{330 \textcolor{keyword}{using }\mbox{\hyperlink{a00316_a4e486ca9fc463568d5018e15b3d68b0d}{EAS3DVariant}} = std::variant<std::monostate, EASH1E9<Geometry>, \mbox{\hyperlink{a01276}{EASH1E21<Geometry>}}>;}
\DoxyCodeLine{331 }
\DoxyCodeLine{341 \textcolor{keyword}{template} <\textcolor{keyword}{typename} DisplacementBasedElement>}
\DoxyCodeLine{342 \textcolor{keyword}{class }\mbox{\hyperlink{a01280}{EnhancedAssumedStrains}} : \textcolor{keyword}{public} DisplacementBasedElement}
\DoxyCodeLine{343 \{}
\DoxyCodeLine{344 \textcolor{keyword}{public}:}
\DoxyCodeLine{345   \textcolor{keyword}{using }\mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}      = \textcolor{keyword}{typename} DisplacementBasedElement::FERequirementType;}
\DoxyCodeLine{346   \textcolor{keyword}{using }\mbox{\hyperlink{a01280_a5ed0cee3df4cbf8a9aed6a705dd8642e}{ResultRequirementsType}} = \textcolor{keyword}{typename} DisplacementBasedElement::ResultRequirementsType;}
\DoxyCodeLine{347   \textcolor{keyword}{using }\mbox{\hyperlink{a01280_a5699ce520159375f9737ec518130e50e}{LocalView}}              = \textcolor{keyword}{typename} DisplacementBasedElement::LocalView;}
\DoxyCodeLine{348   \textcolor{keyword}{using }\mbox{\hyperlink{a01280_aee26978267fb07c5c013a33bbc85f380}{GridView}}               = \textcolor{keyword}{typename} DisplacementBasedElement::GridView;}
\DoxyCodeLine{349   \textcolor{keyword}{using }\mbox{\hyperlink{a01280_a550c9fb8dcd8c64d21c9adaf4749c866}{Traits}}                 = \textcolor{keyword}{typename} DisplacementBasedElement::Traits;}
\DoxyCodeLine{350   \textcolor{keyword}{using }DisplacementBasedElement::localView;}
\DoxyCodeLine{351 }
\DoxyCodeLine{360   \textcolor{keyword}{template} <\textcolor{keyword}{typename}... Args>}
\DoxyCodeLine{361   \textcolor{keyword}{requires}(}
\DoxyCodeLine{362       not std::is\_same\_v<std::remove\_cvref\_t<std::tuple\_element\_t<0, std::tuple<Args...>>>, \mbox{\hyperlink{a01280}{EnhancedAssumedStrains}}>)}
\DoxyCodeLine{363   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01280_a1405d5a39d16aaed2a794b4bbbc75039}{EnhancedAssumedStrains}}(Args\&\&... args)}
\DoxyCodeLine{364       : DisplacementBasedElement(std::forward<Args>(args)...) \{\}}
\DoxyCodeLine{365 }
\DoxyCodeLine{374   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01280_aa455935bfd539dbd145450c9e8732bdc}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{375     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}())}
\DoxyCodeLine{376       \textcolor{keywordflow}{return} DisplacementBasedElement::calculateScalar(par);}
\DoxyCodeLine{377     DUNE\_THROW(Dune::NotImplemented,}
\DoxyCodeLine{378                \textcolor{stringliteral}{"{}EAS element do not support any scalar calculations, i.e. they are not derivable from a potential"{}});}
\DoxyCodeLine{379   \}}
\DoxyCodeLine{380 }
\DoxyCodeLine{386   \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} std::holds\_alternative<std::monostate>(easVariant\_); \}}
\DoxyCodeLine{387 }
\DoxyCodeLine{396   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01280_a3a92d4669635a5ab22a10bc353111d95}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{397     calculateVectorImpl<double>(par, force);}
\DoxyCodeLine{398   \}}
\DoxyCodeLine{399 }
\DoxyCodeLine{405   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& \mbox{\hyperlink{a01280_ab8c3ff043b0808de14656d79ec56de5f}{easVariant}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} easVariant\_; \}}
\DoxyCodeLine{406 }
\DoxyCodeLine{412   \textcolor{keyword}{auto} \mbox{\hyperlink{a01280_aa75e2ef6c92f084608e36d5aa6a1122e}{getNumberOfEASParameters}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{413     \textcolor{keywordflow}{return} std::visit(}
\DoxyCodeLine{414         [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\&) \{}
\DoxyCodeLine{415           \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<std::monostate, EAST>)}
\DoxyCodeLine{416             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{417           \textcolor{keywordflow}{else}}
\DoxyCodeLine{418             \textcolor{keywordflow}{return} EAST::enhancedStrainSize;}
\DoxyCodeLine{419         \},}
\DoxyCodeLine{420         easVariant\_);}
\DoxyCodeLine{421   \}}
\DoxyCodeLine{422 }
\DoxyCodeLine{431   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01280_a7f2216c3b8f6b94145ae586324018376}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{432     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{433     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{434 }
\DoxyCodeLine{438     DisplacementBasedElement::calculateMatrix(par, K);}
\DoxyCodeLine{439 }
\DoxyCodeLine{440     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}())}
\DoxyCodeLine{441       \textcolor{keywordflow}{return};}
\DoxyCodeLine{442 }
\DoxyCodeLine{443     std::visit(}
\DoxyCodeLine{444         [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{445           \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{446             \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{447             Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{448             calculateDAndLMatrix(easFunction, par, D, L);}
\DoxyCodeLine{449 }
\DoxyCodeLine{450             K.template triangularView<Eigen::Upper>() -\/= L.transpose() * D.inverse() * L;}
\DoxyCodeLine{451             K.template triangularView<Eigen::StrictlyLower>() = K.transpose();}
\DoxyCodeLine{452           \}}
\DoxyCodeLine{453         \},}
\DoxyCodeLine{454         easVariant\_);}
\DoxyCodeLine{455   \}}
\DoxyCodeLine{456 }
\DoxyCodeLine{471   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01280_a22e25753bb3cf0c5b296c3af10c443b6}{calculateAt}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5ed0cee3df4cbf8a9aed6a705dd8642e}{ResultRequirementsType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01364}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{472                    \mbox{\hyperlink{a01248}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{473     \textcolor{keyword}{using namespace }Dune::Indices;}
\DoxyCodeLine{474     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{475     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{476 }
\DoxyCodeLine{477     DisplacementBasedElement::calculateAt(req, local, result);}
\DoxyCodeLine{478 }
\DoxyCodeLine{479     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}())}
\DoxyCodeLine{480       \textcolor{keywordflow}{return};}
\DoxyCodeLine{481 }
\DoxyCodeLine{482     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& par           = req.getFERequirements();}
\DoxyCodeLine{483     \textcolor{keyword}{const} \textcolor{keyword}{auto} C              = DisplacementBasedElement::materialTangentFunction(req.getFERequirements());}
\DoxyCodeLine{484     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numberOfNodes = DisplacementBasedElement::numberOfNodes();}
\DoxyCodeLine{485     \textcolor{keyword}{auto} uFunction            = DisplacementBasedElement::displacementFunction(par);}
\DoxyCodeLine{486     \textcolor{keyword}{const} \textcolor{keyword}{auto} disp           = \mbox{\hyperlink{a00311_ga545d74839895f4576a3b8c97d72abefd}{Dune::viewAsFlatEigenVector}}(uFunction.coefficientsRef());}
\DoxyCodeLine{487 }
\DoxyCodeLine{488     std::visit(}
\DoxyCodeLine{489         [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{490           \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{491             \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{492             Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{493             calculateDAndLMatrix(easFunction, req.getFERequirements(), D, L);}
\DoxyCodeLine{494             \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L * disp).eval();}
\DoxyCodeLine{495             \textcolor{keyword}{const} \textcolor{keyword}{auto} M     = easFunction.calcM(local);}
\DoxyCodeLine{496             \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval = C(local);}
\DoxyCodeLine{497             \textcolor{keyword}{auto} easStress   = (CEval * M * alpha).eval();}
\DoxyCodeLine{498             \textcolor{keyword}{typename} \mbox{\hyperlink{a01248_a72132ad19ec7049750ba2c4f60cde93f}{ResultTypeMap<double>::ResultArray}} resultVector;}
\DoxyCodeLine{499             \textcolor{keywordflow}{if} (req.isResultRequested(\mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}})) \{}
\DoxyCodeLine{500               resultVector.resize(3, 1);}
\DoxyCodeLine{501               resultVector = result.\mbox{\hyperlink{a01248_a7f9a61700e42a5507d7dfcfd059a4067}{getResult}}(\mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}) + easStress;}
\DoxyCodeLine{502               result.\mbox{\hyperlink{a01248_aa399a96000daf40950e388eb0b23a7c0}{insertOrAssignResult}}(\mbox{\hyperlink{a00303_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}, resultVector);}
\DoxyCodeLine{503             \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{504               DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The requested result type is NOT implemented."{}});}
\DoxyCodeLine{505           \}}
\DoxyCodeLine{506         \},}
\DoxyCodeLine{507         easVariant\_);}
\DoxyCodeLine{508   \}}
\DoxyCodeLine{509 }
\DoxyCodeLine{515   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01280_a3990ba9792f807ae9d0c2f5fd7fb7e85}{setEASType}}(\textcolor{keywordtype}{int} numberOfEASParameters\_) \{}
\DoxyCodeLine{516     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numberOfNodes = DisplacementBasedElement::numberOfNodes();}
\DoxyCodeLine{517     \textcolor{keywordflow}{if} (not((numberOfNodes == 4 and Traits::mydim == 2) or (numberOfNodes == 8 and Traits::mydim == 3)) and}
\DoxyCodeLine{518         (not \mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()))}
\DoxyCodeLine{519       DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}EAS only supported for Q1 or H1 elements"{}});}
\DoxyCodeLine{520 }
\DoxyCodeLine{521     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (Traits::mydim == 2) \{}
\DoxyCodeLine{522       \textcolor{keywordflow}{switch} (numberOfEASParameters\_) \{}
\DoxyCodeLine{523         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{524           easVariant\_ = std::monostate();}
\DoxyCodeLine{525           \textcolor{keywordflow}{break};}
\DoxyCodeLine{526         \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{527           easVariant\_ = \mbox{\hyperlink{a01260}{EASQ1E4}}(localView().element().geometry());}
\DoxyCodeLine{528           \textcolor{keywordflow}{break};}
\DoxyCodeLine{529         \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{530           easVariant\_ = \mbox{\hyperlink{a01264}{EASQ1E5}}(localView().element().geometry());}
\DoxyCodeLine{531           \textcolor{keywordflow}{break};}
\DoxyCodeLine{532         \textcolor{keywordflow}{case} 7:}
\DoxyCodeLine{533           easVariant\_ = \mbox{\hyperlink{a01268}{EASQ1E7}}(localView().element().geometry());}
\DoxyCodeLine{534           \textcolor{keywordflow}{break};}
\DoxyCodeLine{535         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{536           DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The given EAS parameters are not available for the 2D case."{}});}
\DoxyCodeLine{537           \textcolor{keywordflow}{break};}
\DoxyCodeLine{538       \}}
\DoxyCodeLine{539     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (Traits::mydim == 3) \{}
\DoxyCodeLine{540       \textcolor{keywordflow}{switch} (numberOfEASParameters\_) \{}
\DoxyCodeLine{541         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{542           easVariant\_ = std::monostate();}
\DoxyCodeLine{543           \textcolor{keywordflow}{break};}
\DoxyCodeLine{544         \textcolor{keywordflow}{case} 9:}
\DoxyCodeLine{545           easVariant\_ = \mbox{\hyperlink{a01272}{EASH1E9}}(localView().element().geometry());}
\DoxyCodeLine{546           \textcolor{keywordflow}{break};}
\DoxyCodeLine{547         \textcolor{keywordflow}{case} 21:}
\DoxyCodeLine{548           easVariant\_ = \mbox{\hyperlink{a01276}{EASH1E21}}(localView().element().geometry());}
\DoxyCodeLine{549           \textcolor{keywordflow}{break};}
\DoxyCodeLine{550         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{551           DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The given EAS parameters are not available for the 3D case."{}});}
\DoxyCodeLine{552           \textcolor{keywordflow}{break};}
\DoxyCodeLine{553       \}}
\DoxyCodeLine{554     \}}
\DoxyCodeLine{555   \}}
\DoxyCodeLine{556 }
\DoxyCodeLine{557 \textcolor{keyword}{protected}:}
\DoxyCodeLine{558   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{559   \textcolor{keyword}{inline} ScalarType \mbox{\hyperlink{a01280_afc5adc55bc187c5d033a90cbae91ae44}{calculateScalarImpl}}(}
\DoxyCodeLine{560       \textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{561     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}())}
\DoxyCodeLine{562       \textcolor{keywordflow}{return} DisplacementBasedElement::template calculateScalarImpl<ScalarType>(par, dx);}
\DoxyCodeLine{563     DUNE\_THROW(Dune::NotImplemented,}
\DoxyCodeLine{564                \textcolor{stringliteral}{"{}EAS element do not support any scalar calculations, i.e. they are not derivable from a potential"{}});}
\DoxyCodeLine{565   \}}
\DoxyCodeLine{566 }
\DoxyCodeLine{567   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{568   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01280_afa32c429e6121e0573a0fedbe43d2f45}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01280_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{569                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{570     DisplacementBasedElement::calculateVectorImpl(par, force, dx);}
\DoxyCodeLine{571     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01280_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}())}
\DoxyCodeLine{572       \textcolor{keywordflow}{return};}
\DoxyCodeLine{573     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{574     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction      = DisplacementBasedElement::displacementFunction(par, dx);}
\DoxyCodeLine{575     \textcolor{keyword}{auto} strainFunction       = DisplacementBasedElement::strainFunction(par, dx);}
\DoxyCodeLine{576     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numberOfNodes = DisplacementBasedElement::numberOfNodes();}
\DoxyCodeLine{577     \textcolor{keyword}{const} \textcolor{keyword}{auto} disp           = \mbox{\hyperlink{a00311_ga545d74839895f4576a3b8c97d72abefd}{Dune::viewAsFlatEigenVector}}(uFunction.coefficientsRef());}
\DoxyCodeLine{578 }
\DoxyCodeLine{579     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{580 }
\DoxyCodeLine{581     \textcolor{keyword}{auto} C         = DisplacementBasedElement::materialTangentFunction(par);}
\DoxyCodeLine{582     \textcolor{keyword}{const} \textcolor{keyword}{auto} geo = localView().element().geometry();}
\DoxyCodeLine{583 }
\DoxyCodeLine{584     \textcolor{comment}{// Internal forces from enhanced strains}}
\DoxyCodeLine{585     std::visit(}
\DoxyCodeLine{586         [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{587           \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{588             \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{589             Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{590             calculateDAndLMatrix(easFunction, par, D, L);}
\DoxyCodeLine{591 }
\DoxyCodeLine{592             \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L * disp).eval();}
\DoxyCodeLine{593 }
\DoxyCodeLine{594             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{595               \textcolor{keyword}{const} \textcolor{keyword}{auto} M            = easFunction.calcM(gp.position());}
\DoxyCodeLine{596               \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{597               \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval        = C(gpIndex);}
\DoxyCodeLine{598               \textcolor{keyword}{auto} stresses           = (CEval * M * alpha).eval();}
\DoxyCodeLine{599               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes; ++i) \{}
\DoxyCodeLine{600                 \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{601                 force.template segment<Traits::worlddim>(Traits::worlddim * i) +=}
\DoxyCodeLine{602                     bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{603               \}}
\DoxyCodeLine{604             \}}
\DoxyCodeLine{605           \}}
\DoxyCodeLine{606         \},}
\DoxyCodeLine{607         easVariant\_);}
\DoxyCodeLine{608   \}}
\DoxyCodeLine{609 }
\DoxyCodeLine{610 \textcolor{keyword}{private}:}
\DoxyCodeLine{611   \textcolor{keyword}{using }EAS2DVariantImpl = \mbox{\hyperlink{a00316_a87e3feaaba5839ab7b515df24438c07f}{EAS2DVariant<typename LocalView::Element::Geometry>}};}
\DoxyCodeLine{612   \textcolor{keyword}{using }EAS3DVariantImpl = \mbox{\hyperlink{a00316_a4e486ca9fc463568d5018e15b3d68b0d}{EAS3DVariant<typename LocalView::Element::Geometry>}};}
\DoxyCodeLine{613   std::conditional\_t<Traits::mydim == 2, EAS2DVariantImpl, EAS3DVariantImpl> easVariant\_;}
\DoxyCodeLine{614   \textcolor{keyword}{mutable} Eigen::MatrixXd L;}
\DoxyCodeLine{615   \textcolor{keyword}{template} <\textcolor{keywordtype}{int} enhancedStrainSize>}
\DoxyCodeLine{616   \textcolor{keywordtype}{void} calculateDAndLMatrix(\textcolor{keyword}{const} \textcolor{keyword}{auto}\& easFunction, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& par,}
\DoxyCodeLine{617                             Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize>\& DMat,}
\DoxyCodeLine{618                             Eigen::MatrixXd\& LMat)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{619     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{620     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{621 }
\DoxyCodeLine{622     \textcolor{keyword}{auto} strainFunction      = DisplacementBasedElement::strainFunction(par);}
\DoxyCodeLine{623     \textcolor{keyword}{const} \textcolor{keyword}{auto} C             = DisplacementBasedElement::materialTangentFunction(par);}
\DoxyCodeLine{624     \textcolor{keyword}{const} \textcolor{keyword}{auto} geo           = localView().element().geometry();}
\DoxyCodeLine{625     \textcolor{keyword}{const} \textcolor{keyword}{auto} numberOfNodes = DisplacementBasedElement::numberOfNodes();}
\DoxyCodeLine{626     DMat.setZero();}
\DoxyCodeLine{627     LMat.setZero(enhancedStrainSize, localView().size());}
\DoxyCodeLine{628     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{629       \textcolor{keyword}{const} \textcolor{keyword}{auto} M      = easFunction.calcM(gp.position());}
\DoxyCodeLine{630       \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval  = C(gpIndex);}
\DoxyCodeLine{631       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = geo.integrationElement(gp.position());}
\DoxyCodeLine{632       DMat += M.transpose() * CEval * M * detJ * gp.weight();}
\DoxyCodeLine{633       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0U; i < numberOfNodes; ++i) \{}
\DoxyCodeLine{634         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} I = Traits::worlddim * i;}
\DoxyCodeLine{635         \textcolor{keyword}{const} \textcolor{keyword}{auto} Bi  = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{636         LMat.template block<enhancedStrainSize, Traits::worlddim>(0, I) +=}
\DoxyCodeLine{637             M.transpose() * CEval * Bi * detJ * gp.weight();}
\DoxyCodeLine{638       \}}
\DoxyCodeLine{639     \}}
\DoxyCodeLine{640   \}}
\DoxyCodeLine{641 \};}
\DoxyCodeLine{642 \} \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{643 }
\DoxyCodeLine{644 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{645 \textcolor{preprocessor}{  \#error EnhancedAssumedStrains depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{646 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
