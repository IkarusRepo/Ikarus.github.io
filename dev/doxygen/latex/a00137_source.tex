\hypertarget{a00137_source}{}\doxysection{pathfollowingfunctions.\+hh}
\label{a00137_source}\index{pathfollowingfunctions.hh@{pathfollowingfunctions.hh}}
\mbox{\hyperlink{a00137}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <optional>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <dune/common/exceptions.hh>}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <Eigen/Core>}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00230}{ikarus/solver/linearsolver/linearsolver.hh}}>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00050}{ikarus/utils/concepts.hh}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00056}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00038}{ikarus/utils/traits.hh}}>}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00316}{Ikarus}} \{}
\DoxyCodeLine{38 \textcolor{keyword}{struct }\mbox{\hyperlink{a01196}{SubsidiaryArgs}}}
\DoxyCodeLine{39 \{}
\DoxyCodeLine{40   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};              }
\DoxyCodeLine{41   Eigen::VectorX<double> \mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}};    }
\DoxyCodeLine{42   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}};               }
\DoxyCodeLine{43   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01196_a628b23aa9e90c0e0ba1461ad2241645a}{f}};                     }
\DoxyCodeLine{44   Eigen::VectorX<double> \mbox{\hyperlink{a01196_aa1bc7c1fc866571e3b6b22e14ed9afcf}{dfdDD}}; }
\DoxyCodeLine{45   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01196_a198c4e48b353f1ebe5c5922bf51e34e5}{dfdDlambda}};            }
\DoxyCodeLine{46   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01196_a217c729e1ae8b05a98c852f19b0d6ae5}{currentStep}};              }
\DoxyCodeLine{47 \};}
\DoxyCodeLine{48 }
\DoxyCodeLine{66 \textcolor{keyword}{struct }\mbox{\hyperlink{a01200}{ArcLength}}}
\DoxyCodeLine{67 \{}
\DoxyCodeLine{76   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01200_a2fabf5f8515ac122ecf588f1d8c860bf}{operator()}}(\mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{77     \textcolor{keywordflow}{if} (psi) \{}
\DoxyCodeLine{78       \textcolor{keyword}{const} \textcolor{keyword}{auto} root = sqrt(args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}.squaredNorm() + psi.value() * psi.value() * args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}} * args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}});}
\DoxyCodeLine{79       args.\mbox{\hyperlink{a01196_a628b23aa9e90c0e0ba1461ad2241645a}{f}}          = root -\/ args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};}
\DoxyCodeLine{80       args.\mbox{\hyperlink{a01196_aa1bc7c1fc866571e3b6b22e14ed9afcf}{dfdDD}}      = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}} / root;}
\DoxyCodeLine{81       args.\mbox{\hyperlink{a01196_a198c4e48b353f1ebe5c5922bf51e34e5}{dfdDlambda}} = (psi.value() * psi.value() * args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}}) / root;}
\DoxyCodeLine{82     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{83       DUNE\_THROW(Dune::InvalidStateException, \textcolor{stringliteral}{"{}You have to call initialPrediction first. Otherwise psi is not defined"{}});}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85   \}}
\DoxyCodeLine{86 }
\DoxyCodeLine{98   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{99   \textcolor{keywordtype}{void} \mbox{\hyperlink{a00299_gaede73886a736a968e9783df389df245f}{initialPrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{100     \mbox{\hyperlink{a00316_a731a9ee6621f91193c15f31b9a399906}{SolverTypeTag}} solverTag;}
\DoxyCodeLine{101     \textcolor{keyword}{using }JacobianType = std::remove\_cvref\_t<typename NonLinearOperator::DerivativeType>;}
\DoxyCodeLine{102     \textcolor{keyword}{static\_assert}((traits::isSpecializationTypeAndNonTypes<Eigen::Matrix, JacobianType>::value) or}
\DoxyCodeLine{103                       (traits::isSpecializationTypeNonTypeAndType<Eigen::SparseMatrix, JacobianType>::value),}
\DoxyCodeLine{104                   \textcolor{stringliteral}{"{}Linear solver not implemented for the chosen derivative type of the non-\/linear operator"{}});}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (traits::isSpecializationTypeAndNonTypes<Eigen::Matrix, JacobianType>::value)}
\DoxyCodeLine{107       solverTag = \mbox{\hyperlink{a00316_a731a9ee6621f91193c15f31b9a399906ad495de2cc8831501954c24afe8688190}{SolverTypeTag::d\_LDLT}};}
\DoxyCodeLine{108     \textcolor{keywordflow}{else}}
\DoxyCodeLine{109       solverTag = \mbox{\hyperlink{a00316_a731a9ee6621f91193c15f31b9a399906af493d8a2d2d89f06181e77bc79cabf1c}{SolverTypeTag::sd\_SimplicialLDLT}};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111     nonLinearOperator.lastParameter() = 1.0; \textcolor{comment}{// lambda =1.0}}
\DoxyCodeLine{112     nonLinearOperator.template update<0>();}
\DoxyCodeLine{113     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& R = nonLinearOperator.value();}
\DoxyCodeLine{114     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& K = nonLinearOperator.derivative();}
\DoxyCodeLine{115 }
\DoxyCodeLine{116     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} isLinearSolver =}
\DoxyCodeLine{117         \mbox{\hyperlink{a01629}{Ikarus::Concepts::LinearSolverCheck}}<\textcolor{keyword}{decltype}(\mbox{\hyperlink{a00316_ae747d502e8f67af4c5412d8a6febeb4c}{LinearSolver}}(solverTag)),}
\DoxyCodeLine{118                                             \textcolor{keyword}{typename} NonLinearOperator::DerivativeType,}
\DoxyCodeLine{119                                             \textcolor{keyword}{typename} NonLinearOperator::ValueType>;}
\DoxyCodeLine{120     \textcolor{keyword}{static\_assert}(isLinearSolver,}
\DoxyCodeLine{121                   \textcolor{stringliteral}{"{}Initial predictor step in the standard arc-\/length method doesn't have a linear solver"{}});}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{keyword}{auto} linearSolver = \mbox{\hyperlink{a00316_ae747d502e8f67af4c5412d8a6febeb4c}{LinearSolver}}(solverTag); \textcolor{comment}{// for the linear predictor step}}
\DoxyCodeLine{124     linearSolver.analyzePattern(K);}
\DoxyCodeLine{125     linearSolver.factorize(K);}
\DoxyCodeLine{126     linearSolver.solve(args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}, -\/R);}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{keyword}{const} \textcolor{keyword}{auto} DD2 = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}.squaredNorm();}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     psi    = sqrt(DD2);}
\DoxyCodeLine{131     \textcolor{keyword}{auto} s = sqrt(psi.value() * psi.value() + DD2);}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}      = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}} * args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}} / s;}
\DoxyCodeLine{134     args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}} = args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}} / s;}
\DoxyCodeLine{135 }
\DoxyCodeLine{136     nonLinearOperator.firstParameter() = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}};}
\DoxyCodeLine{137     nonLinearOperator.lastParameter()  = args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}};}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{149   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{150   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01200_a693ad9054ad2b8f41da254028a33ec6a}{intermediatePrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{151     nonLinearOperator.firstParameter() += args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}};}
\DoxyCodeLine{152     nonLinearOperator.lastParameter() += args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}};}
\DoxyCodeLine{153   \}}
\DoxyCodeLine{154 }
\DoxyCodeLine{156   \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01200_afa77b974566da3b74cb5b35693540c16}{name}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} std::string(\textcolor{stringliteral}{"{}Arc length"{}}); \}}
\DoxyCodeLine{157 }
\DoxyCodeLine{158 \textcolor{keyword}{private}:}
\DoxyCodeLine{159   std::optional<double> psi;}
\DoxyCodeLine{160 \};}
\DoxyCodeLine{161 }
\DoxyCodeLine{174 \textcolor{keyword}{struct }\mbox{\hyperlink{a01204}{LoadControlSubsidiaryFunction}}}
\DoxyCodeLine{175 \{}
\DoxyCodeLine{183   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01204_aea5de41cde5e7506712e8bdd84be6ffa}{operator()}}(\mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{184     args.\mbox{\hyperlink{a01196_a628b23aa9e90c0e0ba1461ad2241645a}{f}} = args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}} -\/ args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};}
\DoxyCodeLine{185     args.\mbox{\hyperlink{a01196_aa1bc7c1fc866571e3b6b22e14ed9afcf}{dfdDD}}.setZero();}
\DoxyCodeLine{186     args.\mbox{\hyperlink{a01196_a198c4e48b353f1ebe5c5922bf51e34e5}{dfdDlambda}} = 1.0;}
\DoxyCodeLine{187   \}}
\DoxyCodeLine{188 }
\DoxyCodeLine{198   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{199   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01204_a3c180ee35066bbb51af604b2d6482a0c}{initialPrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{200     args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}}                      = args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};}
\DoxyCodeLine{201     nonLinearOperator.lastParameter() = args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}};}
\DoxyCodeLine{202   \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{213   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{214   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01204_a5e378c06d11bfe70acb5b9b3ac40f9f0}{intermediatePrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{215     nonLinearOperator.lastParameter() += args.\mbox{\hyperlink{a01196_a0cd5cc302f164ea614b9edfadd7c82c9}{Dlambda}};}
\DoxyCodeLine{216   \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{219   \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01204_a6e2ee6e5a234c1b14ce197f4a1460ed3}{name}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} std::string(\textcolor{stringliteral}{"{}Load Control"{}}); \}}
\DoxyCodeLine{220 \};}
\DoxyCodeLine{221 }
\DoxyCodeLine{234 \textcolor{keyword}{struct }\mbox{\hyperlink{a01208}{DisplacementControl}}}
\DoxyCodeLine{235 \{}
\DoxyCodeLine{241   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01208_aa15060bf256c9786fe44096fad899733}{DisplacementControl}}(std::vector<int> p\_controlledIndices)}
\DoxyCodeLine{242       : controlledIndices\{std::move(p\_controlledIndices)\} \{\}}
\DoxyCodeLine{243 }
\DoxyCodeLine{251   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01208_a980d44ede46996fd077ffa1bbda66952}{operator()}}(\mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{252     \textcolor{keyword}{const} \textcolor{keyword}{auto} controlledDOFsNorm = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}(controlledIndices).norm();}
\DoxyCodeLine{253     args.\mbox{\hyperlink{a01196_a628b23aa9e90c0e0ba1461ad2241645a}{f}}                        = controlledDOFsNorm -\/ args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};}
\DoxyCodeLine{254     args.\mbox{\hyperlink{a01196_a198c4e48b353f1ebe5c5922bf51e34e5}{dfdDlambda}}               = 0.0;}
\DoxyCodeLine{255     args.\mbox{\hyperlink{a01196_aa1bc7c1fc866571e3b6b22e14ed9afcf}{dfdDD}}.setZero();}
\DoxyCodeLine{256     args.\mbox{\hyperlink{a01196_aa1bc7c1fc866571e3b6b22e14ed9afcf}{dfdDD}}(controlledIndices) = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}(controlledIndices) / controlledDOFsNorm;}
\DoxyCodeLine{257   \}}
\DoxyCodeLine{258 }
\DoxyCodeLine{268   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{269   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01208_a745ce332f4df7c4483d2d86e06013f24}{initialPrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{270     args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}(controlledIndices).array() = args.\mbox{\hyperlink{a01196_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}};}
\DoxyCodeLine{271     nonLinearOperator.firstParameter() = args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}};}
\DoxyCodeLine{272   \}}
\DoxyCodeLine{273 }
\DoxyCodeLine{283   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearOperator>}
\DoxyCodeLine{284   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01208_a11625614df35e7e3c627e7d87a1670fe}{intermediatePrediction}}(\mbox{\hyperlink{a01540}{NonLinearOperator}}\& nonLinearOperator, \mbox{\hyperlink{a01196}{SubsidiaryArgs}}\& args) \{}
\DoxyCodeLine{285     nonLinearOperator.firstParameter() += args.\mbox{\hyperlink{a01196_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}};}
\DoxyCodeLine{286   \}}
\DoxyCodeLine{287 }
\DoxyCodeLine{289   \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01208_a16cd9773e9704597d967f144d674bcd4}{name}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} std::string(\textcolor{stringliteral}{"{}Displacement Control"{}}); \}}
\DoxyCodeLine{290 }
\DoxyCodeLine{291 \textcolor{keyword}{private}:}
\DoxyCodeLine{292   std::vector<int> controlledIndices; }
\DoxyCodeLine{293 \};}
\DoxyCodeLine{294 \} \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
