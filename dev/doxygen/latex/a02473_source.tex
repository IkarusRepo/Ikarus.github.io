\hypertarget{a02473_source}{}\doxysection{python/finiteelements/nonlinearelastic.hh}
\label{a02473_source}\index{nonlinearelastic.hh@{nonlinearelastic.hh}}
\mbox{\hyperlink{a02473}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <dune/functions/functionspacebases/lagrangebasis.hh>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <dune/functions/functionspacebases/powerbasis.hh>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <dune/grid/yaspgrid.hh>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <dune/python/common/typeregistry.hh>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/python/functions/globalbasis.hh>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <dune/python/pybind11/eigen.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/python/pybind11/functional.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <dune/python/pybind11/pybind11.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <dune/python/pybind11/stl.h>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00254}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a02470}{ikarus/finiteelements/mechanics/nonlinearelastic.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a02479}{ikarus/utils/basis.hh}}>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00336}{Ikarus::Python}} \{}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{template} <\textcolor{keyword}{class }\mbox{\hyperlink{a00349_a6114e5fee4b037e1baa43925a79eee38}{NonLinearElastic}}, \textcolor{keyword}{class}... options>}
\DoxyCodeLine{24 \textcolor{keywordtype}{void} \mbox{\hyperlink{a00336_a4124469fcacfc527cb971b40fe86e244}{registerNonLinearElastic}}(pybind11::handle scope, pybind11::class\_<NonLinearElastic, options...> cls) \{}
\DoxyCodeLine{25   \textcolor{keyword}{using }pybind11::operator\textcolor{stringliteral}{"{}"{}}\_a;}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   \textcolor{keyword}{using }GlobalBasis    = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_ac05c4360f5191ebb97b85998db6199f2}{NonLinearElastic::BasisHandler}};}
\DoxyCodeLine{28   \textcolor{keyword}{using }FlatBasis      = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_a382567a9fe4fac11bbdd1f12063a14d9}{NonLinearElastic::FlatBasis}};}
\DoxyCodeLine{29   \textcolor{keyword}{using }GridView       = \textcolor{keyword}{typename} GlobalBasis::GridView;}
\DoxyCodeLine{30   \textcolor{keyword}{using }Element        = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_aa63c4e031affd156566457d226a4a083}{NonLinearElastic::Element}};}
\DoxyCodeLine{31   \textcolor{keyword}{using }Traits         = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_a293a865db44f89553252be2da32c9991}{NonLinearElastic::Traits}};}
\DoxyCodeLine{32   \textcolor{keyword}{using }\mbox{\hyperlink{a01248}{FERequirements}} = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_a80b1ba5b790fd0a38cccd20439124d76}{NonLinearElastic::FERequirementType}};}
\DoxyCodeLine{33   \textcolor{keyword}{using }\mbox{\hyperlink{a01316}{Material}}       = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_a55d99c371dc949e4c00324bcd5ddecfd}{NonLinearElastic::Material}};}
\DoxyCodeLine{34   \textcolor{keyword}{using }\mbox{\hyperlink{a01248}{FERequirements}} = \textcolor{keyword}{typename} \mbox{\hyperlink{a01344_a80b1ba5b790fd0a38cccd20439124d76}{NonLinearElastic::FERequirementType}};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   cls.def(\mbox{\hyperlink{a00325_ac8243891c1b961e50a066140ab79a142}{pybind11::init}}([](\textcolor{keyword}{const} GlobalBasis\& \mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, \textcolor{keyword}{const} Element\& element, \textcolor{keyword}{const} \mbox{\hyperlink{a01316}{Material}}\& mat) \{}
\DoxyCodeLine{37             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{a00349_a6114e5fee4b037e1baa43925a79eee38}{NonLinearElastic}}(\mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, element, mat);}
\DoxyCodeLine{38           \}),}
\DoxyCodeLine{39           pybind11::keep\_alive<1, 2>(), pybind11::keep\_alive<1, 3>());}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{keyword}{using }LoadFunction = std::function<Eigen::Vector<double, Traits::worlddim>(}
\DoxyCodeLine{42       \mbox{\hyperlink{a01496}{Dune::FieldVector<double, Traits::worlddim>}}, \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>;}
\DoxyCodeLine{43 }
\DoxyCodeLine{44   cls.def(\mbox{\hyperlink{a00325_ac8243891c1b961e50a066140ab79a142}{pybind11::init}}(}
\DoxyCodeLine{45               [](\textcolor{keyword}{const} GlobalBasis\& \mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, \textcolor{keyword}{const} Element\& element, \textcolor{keyword}{const} \mbox{\hyperlink{a01316}{Material}}\& mat, \textcolor{keyword}{const} LoadFunction volumeLoad) \{}
\DoxyCodeLine{46                 \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{a00349_a6114e5fee4b037e1baa43925a79eee38}{NonLinearElastic}}(\mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, element, mat, volumeLoad);}
\DoxyCodeLine{47               \}),}
\DoxyCodeLine{48           pybind11::keep\_alive<1, 2>(), pybind11::keep\_alive<1, 3>());}
\DoxyCodeLine{49 }
\DoxyCodeLine{50   cls.def(\mbox{\hyperlink{a00325_ac8243891c1b961e50a066140ab79a142}{pybind11::init}}([](\textcolor{keyword}{const} GlobalBasis\& \mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, \textcolor{keyword}{const} Element\& element, \textcolor{keyword}{const} \mbox{\hyperlink{a01316}{Material}}\& mat,}
\DoxyCodeLine{51                             \textcolor{keyword}{const} LoadFunction volumeLoad, \textcolor{keyword}{const} BoundaryPatch<GridView>\& bp,}
\DoxyCodeLine{52                             \textcolor{keyword}{const} LoadFunction neumannBoundaryLoad) \{}
\DoxyCodeLine{53             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{a00349_a6114e5fee4b037e1baa43925a79eee38}{NonLinearElastic}}(\mbox{\hyperlink{a00347_a0f9f04fa9d98e890cb6d4fe62ff889a4}{basis}}, element, mat, volumeLoad, \&bp, neumannBoundaryLoad);}
\DoxyCodeLine{54           \}),}
\DoxyCodeLine{55           pybind11::keep\_alive<1, 2>(), pybind11::keep\_alive<1, 3>(), pybind11::keep\_alive<1, 7>());}
\DoxyCodeLine{56 }
\DoxyCodeLine{57   pybind11::module scopedf = pybind11::module::import(\textcolor{stringliteral}{"{}dune.functions"{}});}
\DoxyCodeLine{58 }
\DoxyCodeLine{59   \textcolor{keyword}{typedef} Dune::Python::LocalViewWrapper<FlatBasis> LocalViewWrapper;}
\DoxyCodeLine{60   \textcolor{keyword}{auto} includes = Dune::Python::IncludeFiles\{\textcolor{stringliteral}{"{}dune/python/functions/globalbasis.hh"{}}\};}
\DoxyCodeLine{61   \textcolor{keyword}{auto} lv       = Dune::Python::insertClass<LocalViewWrapper>(}
\DoxyCodeLine{62                 scopedf, \textcolor{stringliteral}{"{}LocalViewWrapper"{}},}
\DoxyCodeLine{63                 Dune::Python::GenerateTypeName(\textcolor{stringliteral}{"{}Dune::Python::LocalViewWrapperWrapper"{}}, Dune::MetaType<FlatBasis>()),}
\DoxyCodeLine{64                 includes)}
\DoxyCodeLine{65                 .first;}
\DoxyCodeLine{66   lv.def(\textcolor{stringliteral}{"{}bind"{}}, \&LocalViewWrapper::bind);}
\DoxyCodeLine{67   lv.def(\textcolor{stringliteral}{"{}unbind"{}}, \&LocalViewWrapper::unbind);}
\DoxyCodeLine{68   lv.def(\textcolor{stringliteral}{"{}index"{}}, [](\textcolor{keyword}{const} LocalViewWrapper\& localView, \textcolor{keywordtype}{int} index) \{ \textcolor{keywordflow}{return} localView.index(index); \});}
\DoxyCodeLine{69   lv.def(\textcolor{stringliteral}{"{}\_\_len\_\_"{}}, [](LocalViewWrapper\& self) -\/> \textcolor{keywordtype}{int} \{ \textcolor{keywordflow}{return} self.size(); \});}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   Dune::Python::Functions::registerTree<typename LocalViewWrapper::Tree>(lv);}
\DoxyCodeLine{72   lv.def(\textcolor{stringliteral}{"{}tree"{}}, [](\textcolor{keyword}{const} LocalViewWrapper\& view) \{ \textcolor{keywordflow}{return} view.tree(); \});}
\DoxyCodeLine{73 }
\DoxyCodeLine{74   \textcolor{keyword}{auto} basisName = Dune::className<FlatBasis>();}
\DoxyCodeLine{75   \textcolor{keyword}{auto} entry     = Dune::Python::insertClass<FlatBasis>(scopedf, \textcolor{stringliteral}{"{}DefaultGlobalBasis"{}}, pybind11::buffer\_protocol(),}
\DoxyCodeLine{76                                                     Dune::Python::GenerateTypeName(basisName),}
\DoxyCodeLine{77                                                     Dune::Python::IncludeFiles\{\textcolor{stringliteral}{"{}dune/python/functions/globalbasis.hh"{}}\});}
\DoxyCodeLine{78   \textcolor{keywordflow}{if} (entry.second)}
\DoxyCodeLine{79     Dune::Python::registerGlobalBasis(scopedf, entry.first);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81   cls.def(}
\DoxyCodeLine{82       \textcolor{stringliteral}{"{}localView"{}},}
\DoxyCodeLine{83       [](\mbox{\hyperlink{a01344}{NonLinearElastic}}\& self) -\/> LocalViewWrapper \{}
\DoxyCodeLine{84         \textcolor{keyword}{auto} lvWrapped = LocalViewWrapper(self.localView().globalBasis());}
\DoxyCodeLine{85         \textcolor{comment}{// this can be simplified when https://gitlab.dune-\/project.org/staging/dune-\/functions/-\//merge\_requests/418}}
\DoxyCodeLine{86         \textcolor{comment}{// becomes available}}
\DoxyCodeLine{87         pybind11::object obj = pybind11::cast(self.localView().element());}
\DoxyCodeLine{88         lvWrapped.bind(obj);}
\DoxyCodeLine{89         \textcolor{keywordflow}{return} lvWrapped;}
\DoxyCodeLine{90       \},}
\DoxyCodeLine{91       pybind11::keep\_alive<0, 1>());}
\DoxyCodeLine{92   cls.def(\textcolor{stringliteral}{"{}calculateScalar"{}},}
\DoxyCodeLine{93           [](\mbox{\hyperlink{a01344}{NonLinearElastic}}\& self, \textcolor{keyword}{const} \mbox{\hyperlink{a01248}{FERequirements}}\& req) \{ \textcolor{keywordflow}{return} self.calculateScalar(req); \});}
\DoxyCodeLine{94   cls.def(\textcolor{stringliteral}{"{}calculateVector"{}}, [](\mbox{\hyperlink{a01344}{NonLinearElastic}}\& self, \textcolor{keyword}{const} \mbox{\hyperlink{a01248}{FERequirements}}\& req, Eigen::Ref<Eigen::VectorXd> vec) \{}
\DoxyCodeLine{95     \textcolor{keywordflow}{return} self.calculateVector(req, vec);}
\DoxyCodeLine{96   \});}
\DoxyCodeLine{97   cls.def(}
\DoxyCodeLine{98       \textcolor{stringliteral}{"{}calculateMatrix"{}},}
\DoxyCodeLine{99       [](\mbox{\hyperlink{a01344}{NonLinearElastic}}\& self, \textcolor{keyword}{const} \mbox{\hyperlink{a01248}{FERequirements}}\& req, Eigen::Ref<Eigen::MatrixXd> mat) \{}
\DoxyCodeLine{100         \textcolor{keywordflow}{return} self.calculateMatrix(req, mat);}
\DoxyCodeLine{101       \},}
\DoxyCodeLine{102       pybind11::arg(\textcolor{stringliteral}{"{}FERequirements"{}}), pybind11::arg(\textcolor{stringliteral}{"{}elementMatrix"{}}).noconvert());}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   cls.def(}
\DoxyCodeLine{105       \textcolor{stringliteral}{"{}calculateAt"{}},}
\DoxyCodeLine{106       [](\mbox{\hyperlink{a01344}{NonLinearElastic}}\& self, \textcolor{keyword}{const} \mbox{\hyperlink{a01248}{FERequirements}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01496}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{107          \mbox{\hyperlink{a00312_ga531be167e924b749eb8b4ccc7f1c18c9}{ResultType}} resType) \{}
\DoxyCodeLine{108         \textcolor{keywordflow}{if} (resType == \mbox{\hyperlink{a00312_gga531be167e924b749eb8b4ccc7f1c18c9afa06a140291f2b4bc25c81e5e6bac241}{ResultType::PK2Stress}})}
\DoxyCodeLine{109           \textcolor{keywordflow}{return} self.template calculateAt<ResultType::PK2Stress>(req, local);}
\DoxyCodeLine{110         \textcolor{keywordflow}{else}}
\DoxyCodeLine{111           DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}Nonlinear-\/elastic element only supports PK2 stress as result."{}});}
\DoxyCodeLine{112       \},}
\DoxyCodeLine{113       pybind11::arg(\textcolor{stringliteral}{"{}feRequirements"{}}), pybind11::arg(\textcolor{stringliteral}{"{}local"{}}), pybind11::arg(\textcolor{stringliteral}{"{}resultType"{}}));}
\DoxyCodeLine{114 \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \} \textcolor{comment}{// namespace Ikarus::Python}}

\end{DoxyCode}
