\hypertarget{a00128_source}{}\doxysection{enhancedassumedstrains.\+hh}
\label{a00128_source}\index{enhancedassumedstrains.hh@{enhancedassumedstrains.hh}}
\mbox{\hyperlink{a00128}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#  include <dune/localfefunctions/derivativetransformators.hh>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#  include <dune/localfefunctions/meta.hh>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#  include <\mbox{\hyperlink{a00122}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#  include <\mbox{\hyperlink{a00032}{ikarus/utils/eigendunetransformations.hh}}>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00292}{Ikarus}} \{}
\DoxyCodeLine{19 }
\DoxyCodeLine{29   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{30   Eigen::Matrix3d \mbox{\hyperlink{a00292_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(\textcolor{keyword}{const} Geometry\& geometry) \{}
\DoxyCodeLine{31     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& referenceElement = Dune::ReferenceElements<double, 2>::general(geometry.type());}
\DoxyCodeLine{32     \textcolor{keyword}{const} \textcolor{keyword}{auto} quadPos0          = referenceElement.position(0, 0);}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \textcolor{keyword}{const} \textcolor{keyword}{auto} jacobianinvT0 = toEigen(geometry.jacobianInverseTransposed(quadPos0));}
\DoxyCodeLine{35     \textcolor{keyword}{const} \textcolor{keyword}{auto} detJ0         = geometry.integrationElement(quadPos0);}
\DoxyCodeLine{36 }
\DoxyCodeLine{37     \textcolor{keyword}{auto} jaco = (jacobianinvT0).inverse().eval();}
\DoxyCodeLine{38     \textcolor{keyword}{auto} J11  = jaco(0, 0);}
\DoxyCodeLine{39     \textcolor{keyword}{auto} J12  = jaco(0, 1);}
\DoxyCodeLine{40     \textcolor{keyword}{auto} J21  = jaco(1, 0);}
\DoxyCodeLine{41     \textcolor{keyword}{auto} J22  = jaco(1, 1);}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     Eigen::Matrix3d T0;}
\DoxyCodeLine{44     \textcolor{comment}{// clang-\/format off}}
\DoxyCodeLine{45     T0 <<      J11 * J11, J12 * J12,                   J11 * J12,}
\DoxyCodeLine{46                J21 * J21, J22 * J22,                   J21 * J22,}
\DoxyCodeLine{47          2.0 * J11 * J21, 2.0 * J12 * J22, J21 * J12 + J11 * J22;}
\DoxyCodeLine{48     \textcolor{comment}{// clang-\/format on}}
\DoxyCodeLine{49     \textcolor{keywordflow}{return} T0.inverse() * detJ0;}
\DoxyCodeLine{50   \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{61   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{62   Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a00292_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(\textcolor{keyword}{const} Geometry\& geometry) \{}
\DoxyCodeLine{63     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& referenceElement = Dune::ReferenceElements<double, 3>::general(geometry.type());}
\DoxyCodeLine{64     \textcolor{keyword}{const} \textcolor{keyword}{auto} quadPos0          = referenceElement.position(0, 0);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{keyword}{const} \textcolor{keyword}{auto} jacobianinvT0 = toEigen(geometry.jacobianInverseTransposed(quadPos0));}
\DoxyCodeLine{67     \textcolor{keyword}{const} \textcolor{keyword}{auto} detJ0         = geometry.integrationElement(quadPos0);}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{keyword}{auto} jaco = (jacobianinvT0).inverse().eval();}
\DoxyCodeLine{70     \textcolor{keyword}{auto} J11  = jaco(0, 0);}
\DoxyCodeLine{71     \textcolor{keyword}{auto} J12  = jaco(0, 1);}
\DoxyCodeLine{72     \textcolor{keyword}{auto} J13  = jaco(0, 2);}
\DoxyCodeLine{73     \textcolor{keyword}{auto} J21  = jaco(1, 0);}
\DoxyCodeLine{74     \textcolor{keyword}{auto} J22  = jaco(1, 1);}
\DoxyCodeLine{75     \textcolor{keyword}{auto} J23  = jaco(1, 2);}
\DoxyCodeLine{76     \textcolor{keyword}{auto} J31  = jaco(2, 0);}
\DoxyCodeLine{77     \textcolor{keyword}{auto} J32  = jaco(2, 1);}
\DoxyCodeLine{78     \textcolor{keyword}{auto} J33  = jaco(2, 2);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     Eigen::Matrix<double, 6, 6> T0;}
\DoxyCodeLine{81     \textcolor{comment}{// clang-\/format off}}
\DoxyCodeLine{82     T0 <<      J11 * J11,       J12 * J12,       J13 * J13,             J11 * J12,             J11 * J13,             J12 * J13,}
\DoxyCodeLine{83                J21 * J21,       J22 * J22,       J23 * J23,             J21 * J22,             J21 * J23,             J22 * J23,}
\DoxyCodeLine{84                J31 * J31,       J32 * J32,       J33 * J33,             J31 * J32,             J31 * J33,             J32 * J33,}
\DoxyCodeLine{85          2.0 * J11 * J21, 2.0 * J12 * J22, 2.0 * J13 * J23, J11 * J22 + J21 * J12, J11 * J23 + J21 * J13, J12 * J23 + J22 * J13,}
\DoxyCodeLine{86          2.0 * J11 * J31, 2.0 * J12 * J32, 2.0 * J13 * J33, J11 * J32 + J31 * J12, J11 * J33 + J31 * J13, J12 * J33 + J32 * J13,}
\DoxyCodeLine{87          2.0 * J31 * J21, 2.0 * J32 * J22, 2.0 * J33 * J23, J31 * J22 + J21 * J32, J31 * J23 + J21 * J33, J32 * J23 + J22 * J33;}
\DoxyCodeLine{88     \textcolor{comment}{// clang-\/format on}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     \textcolor{keywordflow}{return} T0.inverse() * detJ0;}
\DoxyCodeLine{91   \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{102   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{103   \textcolor{keyword}{struct }\mbox{\hyperlink{a01231}{EASQ1E4}} \{}
\DoxyCodeLine{104     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01231_a091b2d7ab16564e0355e5078fae6eabd}{strainSize}}         = 3;}
\DoxyCodeLine{105     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01231_ad14763e1531d0b04751e51cc1ca0f23f}{enhancedStrainSize}} = 4;}
\DoxyCodeLine{106     \textcolor{keyword}{using }\mbox{\hyperlink{a01231_aa88f171600c9a12e1e56f0eac6184b20}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \mbox{\hyperlink{a01231_ac30d67e782b291e459cad4eacdf16cf2}{EASQ1E4}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{109     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01231_a322fdf68966e7fb0ee8165f0c966cc40}{EASQ1E4}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{110         : \mbox{\hyperlink{a01231_a98834915295f56b2eb15eae744202339}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{111           \mbox{\hyperlink{a01231_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}}\{\mbox{\hyperlink{a00292_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{keyword}{auto} \mbox{\hyperlink{a01231_a69fd71138345d01372e9434a1fa904fe}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{114       \mbox{\hyperlink{a01231_aa88f171600c9a12e1e56f0eac6184b20}{MType}} M;}
\DoxyCodeLine{115       M.setZero(\mbox{\hyperlink{a01231_a091b2d7ab16564e0355e5078fae6eabd}{strainSize}}, \mbox{\hyperlink{a01231_ad14763e1531d0b04751e51cc1ca0f23f}{enhancedStrainSize}});}
\DoxyCodeLine{116       \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{117       \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{118       M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{119       M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{120       M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{121       M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{122       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01231_a98834915295f56b2eb15eae744202339}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{123       M                 = \mbox{\hyperlink{a01231_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{124       \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     std::shared\_ptr<Geometry> \mbox{\hyperlink{a01231_a98834915295f56b2eb15eae744202339}{geometry}};}
\DoxyCodeLine{128     Eigen::Matrix3d \mbox{\hyperlink{a01231_a39592b62d7442344006f6c1f7254631f}{T0InverseTransformed}};}
\DoxyCodeLine{129   \};}
\DoxyCodeLine{130 }
\DoxyCodeLine{138   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{139   \textcolor{keyword}{struct }\mbox{\hyperlink{a01235}{EASQ1E5}} \{}
\DoxyCodeLine{140     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01235_ac0cb21ead6bd716ddee697328ba429f7}{strainSize}}         = 3;}
\DoxyCodeLine{141     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01235_a295cad836cda5a090316e80d37107d97}{enhancedStrainSize}} = 5;}
\DoxyCodeLine{142     \textcolor{keyword}{using }\mbox{\hyperlink{a01235_a00ce3ccf82b2acbae524f52ea42de95a}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{143 }
\DoxyCodeLine{144     \mbox{\hyperlink{a01235_a4f508bc3cac3ed9504183f1768eca6a1}{EASQ1E5}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{145     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01235_a56469a9df101001a6aad3aab9e51b568}{EASQ1E5}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{146         : \mbox{\hyperlink{a01235_a933c1aed3dbfda6e87955129651ca3e2}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{147           \mbox{\hyperlink{a01235_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}}\{\mbox{\hyperlink{a00292_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{148 }
\DoxyCodeLine{149     \textcolor{keyword}{auto} \mbox{\hyperlink{a01235_a624d83c80aa923e821696c9cc2deef85}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{150       \mbox{\hyperlink{a01235_a00ce3ccf82b2acbae524f52ea42de95a}{MType}} M;}
\DoxyCodeLine{151       M.setZero();}
\DoxyCodeLine{152       \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{153       \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{154       M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{155       M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{156       M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{157       M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{158       M(2, 4)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{159       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01235_a933c1aed3dbfda6e87955129651ca3e2}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{160       M                 = \mbox{\hyperlink{a01235_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{161       \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{162     \}}
\DoxyCodeLine{163 }
\DoxyCodeLine{164     std::shared\_ptr<Geometry> \mbox{\hyperlink{a01235_a933c1aed3dbfda6e87955129651ca3e2}{geometry}};}
\DoxyCodeLine{165     Eigen::Matrix3d \mbox{\hyperlink{a01235_abc4ffe4eb222fc40c893f69b2aa96f25}{T0InverseTransformed}};}
\DoxyCodeLine{166   \};}
\DoxyCodeLine{167 }
\DoxyCodeLine{175   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{176   \textcolor{keyword}{struct }\mbox{\hyperlink{a01239}{EASQ1E7}} \{}
\DoxyCodeLine{177     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01239_a7b988c0a64a63311a1c6861a4a45ed4f}{strainSize}}         = 3;}
\DoxyCodeLine{178     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01239_ad0b8cacc2ddc15f583977858ee760077}{enhancedStrainSize}} = 7;}
\DoxyCodeLine{179     \textcolor{keyword}{using }\mbox{\hyperlink{a01239_a38aee3dda331f7f4071c6348ea511cca}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{180 }
\DoxyCodeLine{181     \mbox{\hyperlink{a01239_a59966ec62660dc7eeb1f12400b3ad672}{EASQ1E7}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{182     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01239_a8ac7ec46a513c44a892e48e297324abf}{EASQ1E7}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{183         : \mbox{\hyperlink{a01239_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{184           \mbox{\hyperlink{a01239_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}}\{\mbox{\hyperlink{a00292_a7a5b9f5e83f6918ca1726fb4316c3b86}{calcTransformationMatrix2D}}(geometry\_)\} \{\}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186     \textcolor{keyword}{auto} \mbox{\hyperlink{a01239_a984954a677451b2f71a968c8e30d5658}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, 2>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{187       \mbox{\hyperlink{a01239_a38aee3dda331f7f4071c6348ea511cca}{MType}} M;}
\DoxyCodeLine{188       M.setZero();}
\DoxyCodeLine{189       \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{190       \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{191       M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{192       M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{193       M(2, 2)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{194       M(2, 3)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{195       M(0, 4)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{196       M(1, 5)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{197       M(2, 6)           = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{198       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01239_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{199       M                 = \mbox{\hyperlink{a01239_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{200       \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{201     \}}
\DoxyCodeLine{202 }
\DoxyCodeLine{203     std::shared\_ptr<Geometry> \mbox{\hyperlink{a01239_ac28ee04d63153dd9323a2926e2f9a8b9}{geometry}};}
\DoxyCodeLine{204     Eigen::Matrix3d \mbox{\hyperlink{a01239_acd663cb202adf116ebab1d2cfbd708ea}{T0InverseTransformed}};}
\DoxyCodeLine{205   \};}
\DoxyCodeLine{206 }
\DoxyCodeLine{214   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{215   \textcolor{keyword}{struct }\mbox{\hyperlink{a01243}{EASH1E9}} \{}
\DoxyCodeLine{216     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01243_a3a3b04261ab9c37d87211f79317b6c72}{strainSize}}         = 6;}
\DoxyCodeLine{217     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01243_acece1d0df4ecbe282f035d1961f632d8}{enhancedStrainSize}} = 9;}
\DoxyCodeLine{218     \textcolor{keyword}{using }\mbox{\hyperlink{a01243_a7212ed3754aa79af50a76848d95eb4d5}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{219 }
\DoxyCodeLine{220     \mbox{\hyperlink{a01243_a5d74fc8ebfb04e85b70d8bd252624552}{EASH1E9}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{221     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01243_a32418ed3d63b290057d27523e468873f}{EASH1E9}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{222         : \mbox{\hyperlink{a01243_a9348ce08ebf36d33aebade14c436a313}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{223           \mbox{\hyperlink{a01243_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}}\{\mbox{\hyperlink{a00292_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(geometry\_)\} \{\}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225     \textcolor{keyword}{auto} \mbox{\hyperlink{a01243_a00fa6978f126c09a3961b18e460155e7}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, 3>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{226       \mbox{\hyperlink{a01243_a7212ed3754aa79af50a76848d95eb4d5}{MType}} M;}
\DoxyCodeLine{227       M.setZero();}
\DoxyCodeLine{228       \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{229       \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{230       \textcolor{keyword}{const} \textcolor{keywordtype}{double} zeta = quadPos[2];}
\DoxyCodeLine{231       M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{232       M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{233       M(2, 2)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{234       M(3, 3)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{235       M(3, 4)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{236       M(4, 5)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{237       M(4, 6)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{238       M(5, 7)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{239       M(5, 8)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{240       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01243_a9348ce08ebf36d33aebade14c436a313}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{241       M                 = \mbox{\hyperlink{a01243_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{242       \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{243     \}}
\DoxyCodeLine{244     std::shared\_ptr<Geometry> \mbox{\hyperlink{a01243_a9348ce08ebf36d33aebade14c436a313}{geometry}};}
\DoxyCodeLine{245     Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a01243_a426a7f668cba849850916bdf61d3f72b}{T0InverseTransformed}};}
\DoxyCodeLine{246   \};}
\DoxyCodeLine{247 }
\DoxyCodeLine{255   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{256   \textcolor{keyword}{struct }\mbox{\hyperlink{a01247}{EASH1E21}} \{}
\DoxyCodeLine{257     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01247_add6a1247960eb038a2cc4d129b0b79e5}{strainSize}}         = 6;}
\DoxyCodeLine{258     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01247_af2217d81619792495bb7ee6ea40205bd}{enhancedStrainSize}} = 21;}
\DoxyCodeLine{259     \textcolor{keyword}{using }\mbox{\hyperlink{a01247_ae4d88268d8bbccfa19801db35b60564f}{MType}}                             = Eigen::Matrix<double, strainSize, enhancedStrainSize>;}
\DoxyCodeLine{260 }
\DoxyCodeLine{261     \mbox{\hyperlink{a01247_a8c5b5847f3fec76168c02e05114b1df5}{EASH1E21}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{262     \textcolor{keyword}{explicit} \mbox{\hyperlink{a01247_a72cdd4c83d4373c7623f9a397eb6d520}{EASH1E21}}(\textcolor{keyword}{const} Geometry\& geometry\_)}
\DoxyCodeLine{263         : \mbox{\hyperlink{a01247_adde8fea3f6eb6e806044c5131a7bc919}{geometry}}\{std::make\_shared<Geometry>(geometry\_)\},}
\DoxyCodeLine{264           \mbox{\hyperlink{a01247_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}}\{\mbox{\hyperlink{a00292_a95234ab8588ced83708c6e5a30e2368e}{calcTransformationMatrix3D}}(geometry\_)\} \{\}}
\DoxyCodeLine{265 }
\DoxyCodeLine{266     \textcolor{keyword}{auto} \mbox{\hyperlink{a01247_a58741a35769a0b13c530e47ffd8dffcd}{calcM}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, 3>}}\& quadPos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{267       \mbox{\hyperlink{a01247_ae4d88268d8bbccfa19801db35b60564f}{MType}} M;}
\DoxyCodeLine{268       M.setZero();}
\DoxyCodeLine{269       \textcolor{keyword}{const} \textcolor{keywordtype}{double} xi   = quadPos[0];}
\DoxyCodeLine{270       \textcolor{keyword}{const} \textcolor{keywordtype}{double} eta  = quadPos[1];}
\DoxyCodeLine{271       \textcolor{keyword}{const} \textcolor{keywordtype}{double} zeta = quadPos[2];}
\DoxyCodeLine{272       M(0, 0)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{273       M(1, 1)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{274       M(2, 2)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{275       M(3, 3)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{276       M(3, 4)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{277       M(4, 5)           = 2 * xi -\/ 1.0;}
\DoxyCodeLine{278       M(4, 6)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{279       M(5, 7)           = 2 * eta -\/ 1.0;}
\DoxyCodeLine{280       M(5, 8)           = 2 * zeta -\/ 1.0;}
\DoxyCodeLine{281 }
\DoxyCodeLine{282       M(3, 9)  = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{283       M(3, 10) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{284       M(4, 11) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{285       M(4, 12) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{286       M(5, 13) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{287       M(5, 14) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{288 }
\DoxyCodeLine{289       M(0, 15) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{290       M(0, 16) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{291       M(1, 17) = (2 * xi -\/ 1.0) * (2 * eta -\/ 1.0);}
\DoxyCodeLine{292       M(1, 18) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{293       M(2, 19) = (2 * xi -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{294       M(2, 20) = (2 * eta -\/ 1.0) * (2 * zeta -\/ 1.0);}
\DoxyCodeLine{295 }
\DoxyCodeLine{296       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = \mbox{\hyperlink{a01247_adde8fea3f6eb6e806044c5131a7bc919}{geometry}}-\/>integrationElement(quadPos);}
\DoxyCodeLine{297       M                 = \mbox{\hyperlink{a01247_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}} / detJ * M;}
\DoxyCodeLine{298       \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{299     \}}
\DoxyCodeLine{300 }
\DoxyCodeLine{301     std::shared\_ptr<Geometry> \mbox{\hyperlink{a01247_adde8fea3f6eb6e806044c5131a7bc919}{geometry}};}
\DoxyCodeLine{302     Eigen::Matrix<double, 6, 6> \mbox{\hyperlink{a01247_aff9381f83c01e85c46cce75c3bf9633b}{T0InverseTransformed}};}
\DoxyCodeLine{303   \};}
\DoxyCodeLine{304 }
\DoxyCodeLine{312   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{313   \textcolor{keyword}{using }\mbox{\hyperlink{a00292_a87e3feaaba5839ab7b515df24438c07f}{EAS2DVariant}} = std::variant<std::monostate, EASQ1E4<Geometry>, \mbox{\hyperlink{a01235}{EASQ1E5<Geometry>}}, \mbox{\hyperlink{a01239}{EASQ1E7<Geometry>}}>;}
\DoxyCodeLine{314 }
\DoxyCodeLine{322   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Geometry>}
\DoxyCodeLine{323   \textcolor{keyword}{using }\mbox{\hyperlink{a00292_a4e486ca9fc463568d5018e15b3d68b0d}{EAS3DVariant}} = std::variant<std::monostate, EASH1E9<Geometry>, \mbox{\hyperlink{a01247}{EASH1E21<Geometry>}}>;}
\DoxyCodeLine{324 }
\DoxyCodeLine{334   \textcolor{keyword}{template} <\textcolor{keyword}{typename} DisplacementBasedElement>}
\DoxyCodeLine{335   \textcolor{keyword}{class }\mbox{\hyperlink{a01251}{EnhancedAssumedStrains}} : \textcolor{keyword}{public} DisplacementBasedElement \{}
\DoxyCodeLine{336   \textcolor{keyword}{public}:}
\DoxyCodeLine{337     \textcolor{keyword}{using }\mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}      = \textcolor{keyword}{typename} DisplacementBasedElement::FERequirementType;}
\DoxyCodeLine{338     \textcolor{keyword}{using }\mbox{\hyperlink{a01251_a5ed0cee3df4cbf8a9aed6a705dd8642e}{ResultRequirementsType}} = \textcolor{keyword}{typename} DisplacementBasedElement::ResultRequirementsType;}
\DoxyCodeLine{339     \textcolor{keyword}{using }\mbox{\hyperlink{a01251_a5699ce520159375f9737ec518130e50e}{LocalView}}              = \textcolor{keyword}{typename} DisplacementBasedElement::LocalView;}
\DoxyCodeLine{340     \textcolor{keyword}{using }\mbox{\hyperlink{a01251_aee26978267fb07c5c013a33bbc85f380}{GridView}}               = \textcolor{keyword}{typename} DisplacementBasedElement::GridView;}
\DoxyCodeLine{341     \textcolor{keyword}{using }\mbox{\hyperlink{a01251_a550c9fb8dcd8c64d21c9adaf4749c866}{Traits}}                 = \textcolor{keyword}{typename} DisplacementBasedElement::Traits;}
\DoxyCodeLine{342     \textcolor{keyword}{using }DisplacementBasedElement::localView;}
\DoxyCodeLine{343 }
\DoxyCodeLine{352     \textcolor{keyword}{template} <\textcolor{keyword}{typename}... Args>}
\DoxyCodeLine{353     \textcolor{keyword}{requires}(not std::is\_same\_v<std::remove\_cvref\_t<std::tuple\_element\_t<0, std::tuple<Args...>>>,}
\DoxyCodeLine{354                                 \mbox{\hyperlink{a01251}{EnhancedAssumedStrains}}>) \textcolor{keyword}{explicit} \mbox{\hyperlink{a01251_a1f09e03a1efdba3ff76ad0f37acc0abc}{EnhancedAssumedStrains}}(Args\&\&... args)}
\DoxyCodeLine{355         : DisplacementBasedElement(std::forward<Args>(args)...) \{\}}
\DoxyCodeLine{356 }
\DoxyCodeLine{365     \textcolor{keywordtype}{double} \mbox{\hyperlink{a01251_aa455935bfd539dbd145450c9e8732bdc}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{366       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()) \textcolor{keywordflow}{return} DisplacementBasedElement::calculateScalar(par);}
\DoxyCodeLine{367       DUNE\_THROW(Dune::NotImplemented,}
\DoxyCodeLine{368                  \textcolor{stringliteral}{"{}EAS element do not support any scalar calculations, i.e. they are not derivable from a potential"{}});}
\DoxyCodeLine{369     \}}
\DoxyCodeLine{370 }
\DoxyCodeLine{376     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} std::holds\_alternative<std::monostate>(easVariant\_); \}}
\DoxyCodeLine{377 }
\DoxyCodeLine{386     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01251_a3a92d4669635a5ab22a10bc353111d95}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{387       calculateVectorImpl<double>(par, force);}
\DoxyCodeLine{388     \}}
\DoxyCodeLine{389 }
\DoxyCodeLine{395     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& \mbox{\hyperlink{a01251_ab8c3ff043b0808de14656d79ec56de5f}{easVariant}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} easVariant\_; \}}
\DoxyCodeLine{396 }
\DoxyCodeLine{402     \textcolor{keyword}{auto} \mbox{\hyperlink{a01251_aa75e2ef6c92f084608e36d5aa6a1122e}{getNumberOfEASParameters}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{403       \textcolor{keywordflow}{return} std::visit(}
\DoxyCodeLine{404           [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\&) \{}
\DoxyCodeLine{405             \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<std::monostate, EAST>)}
\DoxyCodeLine{406               \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{407             \textcolor{keywordflow}{else}}
\DoxyCodeLine{408               \textcolor{keywordflow}{return} EAST::enhancedStrainSize;}
\DoxyCodeLine{409           \},}
\DoxyCodeLine{410           easVariant\_);}
\DoxyCodeLine{411     \}}
\DoxyCodeLine{412 }
\DoxyCodeLine{421     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01251_a7f2216c3b8f6b94145ae586324018376}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{422       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{423       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00296}{Dune}};}
\DoxyCodeLine{424 }
\DoxyCodeLine{428       DisplacementBasedElement::calculateMatrix(par, K);}
\DoxyCodeLine{429 }
\DoxyCodeLine{430       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{431 }
\DoxyCodeLine{432       std::visit(}
\DoxyCodeLine{433           [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{434             \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{435               \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{436               Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{437               calculateDAndLMatrix(easFunction, par, D, L);}
\DoxyCodeLine{438 }
\DoxyCodeLine{439               K.template triangularView<Eigen::Upper>() -\/= L.transpose() * D.inverse() * L;}
\DoxyCodeLine{440               K.template triangularView<Eigen::StrictlyLower>() = K.transpose();}
\DoxyCodeLine{441             \}}
\DoxyCodeLine{442           \},}
\DoxyCodeLine{443           easVariant\_);}
\DoxyCodeLine{444     \}}
\DoxyCodeLine{445 }
\DoxyCodeLine{460     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01251_a22e25753bb3cf0c5b296c3af10c443b6}{calculateAt}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5ed0cee3df4cbf8a9aed6a705dd8642e}{ResultRequirementsType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01323}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{461                      \mbox{\hyperlink{a01219}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{462       \textcolor{keyword}{using namespace }Dune::Indices;}
\DoxyCodeLine{463       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{464       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00296}{Dune}};}
\DoxyCodeLine{465 }
\DoxyCodeLine{466       DisplacementBasedElement::calculateAt(req, local, result);}
\DoxyCodeLine{467 }
\DoxyCodeLine{468       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{469 }
\DoxyCodeLine{470       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d        = req.getGlobalSolution(\mbox{\hyperlink{a00279_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{471       \textcolor{keyword}{const} \textcolor{keyword}{auto} C         = DisplacementBasedElement::getMaterialTangentFunction(req.getFERequirements());}
\DoxyCodeLine{472       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numNodes = DisplacementBasedElement::numberOfNodes;}
\DoxyCodeLine{473 }
\DoxyCodeLine{474       Eigen::VectorXd disp(localView().size());}
\DoxyCodeLine{475       \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < numNodes; ++i)}
\DoxyCodeLine{476         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < Traits::mydim; ++k2)}
\DoxyCodeLine{477           disp[i * Traits::mydim + k2] = d[localView().index(localView().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{478 }
\DoxyCodeLine{479       std::visit(}
\DoxyCodeLine{480           [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{481             \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{482               \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{483               Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{484               calculateDAndLMatrix(easFunction, req.getFERequirements(), D, L);}
\DoxyCodeLine{485               \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L * disp).eval();}
\DoxyCodeLine{486               \textcolor{keyword}{const} \textcolor{keyword}{auto} M     = easFunction.calcM(local);}
\DoxyCodeLine{487               \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval = C(local);}
\DoxyCodeLine{488               \textcolor{keyword}{auto} easStress   = (CEval * M * alpha).eval();}
\DoxyCodeLine{489               \textcolor{keyword}{typename} \mbox{\hyperlink{a01219_a72132ad19ec7049750ba2c4f60cde93f}{ResultTypeMap<double>::ResultArray}} resultVector;}
\DoxyCodeLine{490               \textcolor{keywordflow}{if} (req.isResultRequested(\mbox{\hyperlink{a00279_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}})) \{}
\DoxyCodeLine{491                 resultVector.resize(3, 1);}
\DoxyCodeLine{492                 resultVector = result.\mbox{\hyperlink{a01219_a7f9a61700e42a5507d7dfcfd059a4067}{getResult}}(\mbox{\hyperlink{a00279_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}) + easStress;}
\DoxyCodeLine{493                 result.\mbox{\hyperlink{a01219_aa399a96000daf40950e388eb0b23a7c0}{insertOrAssignResult}}(\mbox{\hyperlink{a00279_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}, resultVector);}
\DoxyCodeLine{494               \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{495                 DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The requested result type is NOT implemented."{}});}
\DoxyCodeLine{496             \}}
\DoxyCodeLine{497           \},}
\DoxyCodeLine{498           easVariant\_);}
\DoxyCodeLine{499     \}}
\DoxyCodeLine{500 }
\DoxyCodeLine{506     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01251_a3990ba9792f807ae9d0c2f5fd7fb7e85}{setEASType}}(\textcolor{keywordtype}{int} numberOfEASParameters\_) \{}
\DoxyCodeLine{507       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numNodes = DisplacementBasedElement::numberOfNodes;}
\DoxyCodeLine{508       \textcolor{keywordflow}{if} (not((numNodes == 4 and Traits::mydim == 2) or (numNodes == 8 and Traits::mydim == 3))}
\DoxyCodeLine{509           and (not \mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()))}
\DoxyCodeLine{510         DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}EAS only supported for Q1 or H1 elements"{}});}
\DoxyCodeLine{511 }
\DoxyCodeLine{512       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (Traits::mydim == 2) \{}
\DoxyCodeLine{513         \textcolor{keywordflow}{switch} (numberOfEASParameters\_) \{}
\DoxyCodeLine{514           \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{515             easVariant\_ = std::monostate();}
\DoxyCodeLine{516             \textcolor{keywordflow}{break};}
\DoxyCodeLine{517           \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{518             easVariant\_ = \mbox{\hyperlink{a01231}{EASQ1E4}}(localView().element().geometry());}
\DoxyCodeLine{519             \textcolor{keywordflow}{break};}
\DoxyCodeLine{520           \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{521             easVariant\_ = \mbox{\hyperlink{a01235}{EASQ1E5}}(localView().element().geometry());}
\DoxyCodeLine{522             \textcolor{keywordflow}{break};}
\DoxyCodeLine{523           \textcolor{keywordflow}{case} 7:}
\DoxyCodeLine{524             easVariant\_ = \mbox{\hyperlink{a01239}{EASQ1E7}}(localView().element().geometry());}
\DoxyCodeLine{525             \textcolor{keywordflow}{break};}
\DoxyCodeLine{526           \textcolor{keywordflow}{default}:}
\DoxyCodeLine{527             DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The given EAS parameters are not available for the 2D case."{}});}
\DoxyCodeLine{528             \textcolor{keywordflow}{break};}
\DoxyCodeLine{529         \}}
\DoxyCodeLine{530       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (Traits::mydim == 3) \{}
\DoxyCodeLine{531         \textcolor{keywordflow}{switch} (numberOfEASParameters\_) \{}
\DoxyCodeLine{532           \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{533             easVariant\_ = std::monostate();}
\DoxyCodeLine{534             \textcolor{keywordflow}{break};}
\DoxyCodeLine{535           \textcolor{keywordflow}{case} 9:}
\DoxyCodeLine{536             easVariant\_ = \mbox{\hyperlink{a01243}{EASH1E9}}(localView().element().geometry());}
\DoxyCodeLine{537             \textcolor{keywordflow}{break};}
\DoxyCodeLine{538           \textcolor{keywordflow}{case} 21:}
\DoxyCodeLine{539             easVariant\_ = \mbox{\hyperlink{a01247}{EASH1E21}}(localView().element().geometry());}
\DoxyCodeLine{540             \textcolor{keywordflow}{break};}
\DoxyCodeLine{541           \textcolor{keywordflow}{default}:}
\DoxyCodeLine{542             DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}The given EAS parameters are not available for the 3D case."{}});}
\DoxyCodeLine{543             \textcolor{keywordflow}{break};}
\DoxyCodeLine{544         \}}
\DoxyCodeLine{545       \}}
\DoxyCodeLine{546     \}}
\DoxyCodeLine{547 }
\DoxyCodeLine{548   \textcolor{keyword}{protected}:}
\DoxyCodeLine{549     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{550     \textcolor{keyword}{inline} ScalarType \mbox{\hyperlink{a01251_afc5adc55bc187c5d033a90cbae91ae44}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par,}
\DoxyCodeLine{551                                           \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx}
\DoxyCodeLine{552                                           = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{553       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()) \textcolor{keywordflow}{return} DisplacementBasedElement::template calculateScalarImpl<ScalarType>(par, dx);}
\DoxyCodeLine{554       DUNE\_THROW(Dune::NotImplemented,}
\DoxyCodeLine{555                  \textcolor{stringliteral}{"{}EAS element do not support any scalar calculations, i.e. they are not derivable from a potential"{}});}
\DoxyCodeLine{556     \}}
\DoxyCodeLine{557 }
\DoxyCodeLine{558     \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{559     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01251_afa32c429e6121e0573a0fedbe43d2f45}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01251_a5a888bacae06491a7e890c9424518f25}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{560                              \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{561       DisplacementBasedElement::calculateVectorImpl(par, force, dx);}
\DoxyCodeLine{562       \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01251_a27a311be4e36cbb8d68d96e6d9046afd}{isDisplacementBased}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{563       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00296}{Dune}};}
\DoxyCodeLine{564       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d       = par.getGlobalSolution(\mbox{\hyperlink{a00279_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{565       \textcolor{keyword}{auto} strainFunction = DisplacementBasedElement::getStrainFunction(par, dx);}
\DoxyCodeLine{566       Eigen::VectorX<ScalarType> disp(localView().size());}
\DoxyCodeLine{567       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numNodes = DisplacementBasedElement::numberOfNodes;}
\DoxyCodeLine{568 }
\DoxyCodeLine{569       \textcolor{comment}{// FIXME this should not be needed in the future strainFunction should be able to hand out this vector}}
\DoxyCodeLine{570       \textcolor{keywordflow}{if} (dx)}
\DoxyCodeLine{571         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < numNodes; ++i)}
\DoxyCodeLine{572           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < Traits::mydim; ++k2)}
\DoxyCodeLine{573             disp[i * Traits::mydim + k2] = dx.value()[i * Traits::mydim + k2]}
\DoxyCodeLine{574                                            + d[localView().index(localView().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{575       \textcolor{keywordflow}{else}}
\DoxyCodeLine{576         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0U; i < numNodes; ++i)}
\DoxyCodeLine{577           \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} k2 = 0U; k2 < Traits::mydim; ++k2)}
\DoxyCodeLine{578             disp[i * Traits::mydim + k2] = d[localView().index(localView().tree().child(k2).localIndex(i))[0]];}
\DoxyCodeLine{579 }
\DoxyCodeLine{580       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{581 }
\DoxyCodeLine{582       \textcolor{keyword}{auto} C         = DisplacementBasedElement::getMaterialTangentFunction(par);}
\DoxyCodeLine{583       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo = localView().element().geometry();}
\DoxyCodeLine{584 }
\DoxyCodeLine{585       \textcolor{comment}{// Internal forces from enhanced strains}}
\DoxyCodeLine{586       std::visit(}
\DoxyCodeLine{587           [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{588             \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<std::monostate, EAST>) \{}
\DoxyCodeLine{589               \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} enhancedStrainSize = EAST::enhancedStrainSize;}
\DoxyCodeLine{590               Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize> D;}
\DoxyCodeLine{591               calculateDAndLMatrix(easFunction, par, D, L);}
\DoxyCodeLine{592 }
\DoxyCodeLine{593               \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L * disp).eval();}
\DoxyCodeLine{594 }
\DoxyCodeLine{595               \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{596                 \textcolor{keyword}{const} \textcolor{keyword}{auto} M            = easFunction.calcM(gp.position());}
\DoxyCodeLine{597                 \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{598                 \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval        = C(gpIndex);}
\DoxyCodeLine{599                 \textcolor{keyword}{auto} stresses           = (CEval * M * alpha).eval();}
\DoxyCodeLine{600                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numNodes; ++i) \{}
\DoxyCodeLine{601                   \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{602                   force.template segment<Traits::mydim>(Traits::mydim * i) += bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{603                 \}}
\DoxyCodeLine{604               \}}
\DoxyCodeLine{605             \}}
\DoxyCodeLine{606           \},}
\DoxyCodeLine{607           easVariant\_);}
\DoxyCodeLine{608     \}}
\DoxyCodeLine{609 }
\DoxyCodeLine{610   \textcolor{keyword}{private}:}
\DoxyCodeLine{611     \textcolor{keyword}{using }EAS2DVariantImpl = \mbox{\hyperlink{a00292_a87e3feaaba5839ab7b515df24438c07f}{EAS2DVariant<typename LocalView::Element::Geometry>}};}
\DoxyCodeLine{612     \textcolor{keyword}{using }EAS3DVariantImpl = \mbox{\hyperlink{a00292_a4e486ca9fc463568d5018e15b3d68b0d}{EAS3DVariant<typename LocalView::Element::Geometry>}};}
\DoxyCodeLine{613     std::conditional\_t<Traits::mydim == 2, EAS2DVariantImpl, EAS3DVariantImpl> easVariant\_;}
\DoxyCodeLine{614     \textcolor{keyword}{mutable} Eigen::MatrixXd L;}
\DoxyCodeLine{615     \textcolor{keyword}{template} <\textcolor{keywordtype}{int} enhancedStrainSize>}
\DoxyCodeLine{616     \textcolor{keywordtype}{void} calculateDAndLMatrix(\textcolor{keyword}{const} \textcolor{keyword}{auto}\& easFunction, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& par,}
\DoxyCodeLine{617                               Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize>\& DMat,}
\DoxyCodeLine{618                               Eigen::MatrixXd\& LMat)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{619       \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00296}{Dune}};}
\DoxyCodeLine{620       \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{621 }
\DoxyCodeLine{622       \textcolor{keyword}{auto} strainFunction = DisplacementBasedElement::getStrainFunction(par);}
\DoxyCodeLine{623       \textcolor{keyword}{const} \textcolor{keyword}{auto} C        = DisplacementBasedElement::getMaterialTangentFunction(par);}
\DoxyCodeLine{624       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo      = localView().element().geometry();}
\DoxyCodeLine{625       \textcolor{keyword}{const} \textcolor{keyword}{auto} numNodes = DisplacementBasedElement::numberOfNodes;}
\DoxyCodeLine{626       DMat.setZero();}
\DoxyCodeLine{627       LMat.setZero(enhancedStrainSize, localView().size());}
\DoxyCodeLine{628       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{629         \textcolor{keyword}{const} \textcolor{keyword}{auto} M      = easFunction.calcM(gp.position());}
\DoxyCodeLine{630         \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval  = C(gpIndex);}
\DoxyCodeLine{631         \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJ = geo.integrationElement(gp.position());}
\DoxyCodeLine{632         DMat += M.transpose() * CEval * M * detJ * gp.weight();}
\DoxyCodeLine{633         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0U; i < numNodes; ++i) \{}
\DoxyCodeLine{634           \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} I = Traits::worlddim * i;}
\DoxyCodeLine{635           \textcolor{keyword}{const} \textcolor{keyword}{auto} Bi  = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{636           LMat.template block<enhancedStrainSize, Traits::worlddim>(0, I)}
\DoxyCodeLine{637               += M.transpose() * CEval * Bi * detJ * gp.weight();}
\DoxyCodeLine{638         \}}
\DoxyCodeLine{639       \}}
\DoxyCodeLine{640     \}}
\DoxyCodeLine{641   \};}
\DoxyCodeLine{642 \}  \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{643 }
\DoxyCodeLine{644 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{645 \textcolor{preprocessor}{\#  error EnhancedAssumedStrains depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{646 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
