\hypertarget{a00098_source}{}\doxysection{tensorutils.\+hh}
\label{a00098_source}\index{tensorutils.hh@{tensorutils.hh}}
\mbox{\hyperlink{a00098}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <numeric>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <ranges>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <unsupported/Eigen/CXX11/Tensor>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <dune/common/promotiontraits.hh>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00101}{ikarus/utils/concepts.hh}}>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00137}{ikarus/utils/math.hh}}>}}
\DoxyCodeLine{13 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00219}{Ikarus}} \{}
\DoxyCodeLine{14 }
\DoxyCodeLine{15   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived, \textcolor{keyword}{typename} T, auto rank>}
\DoxyCodeLine{16   Eigen::Tensor<typename Derived::Scalar, rank> \mbox{\hyperlink{a00219_a1e9e2ec1a0fdbfe5d9f49107c87948e5}{TensorCast}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01337}{Eigen::EigenBase<Derived>}}\& matrix,}
\DoxyCodeLine{17                                                            \textcolor{keyword}{const} std::array<T, rank>\& dims) \{}
\DoxyCodeLine{18     \textcolor{keywordflow}{return} Eigen::TensorMap<const Eigen::Tensor<const typename Derived::Scalar, rank>>(matrix.derived().eval().data(),}
\DoxyCodeLine{19                                                                                        dims);}
\DoxyCodeLine{20   \}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_ab2cea9ac847cc3635812467c9d96ceb4}{dyadic}}(\textcolor{keyword}{const} \textcolor{keyword}{auto}\& A\_ij, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& B\_kl) \{}
\DoxyCodeLine{23     Eigen::array<Eigen::IndexPair<long>, 0> empty\_index\_list = \{\};}
\DoxyCodeLine{24     \textcolor{keywordflow}{return} A\_ij.contract(B\_kl, empty\_index\_list).eval();}
\DoxyCodeLine{25   \}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}, \textcolor{keywordtype}{int} dim = 3>}
\DoxyCodeLine{28   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a1c9618ef351cd986d4f64fde7f52e860}{symmetricIdentityFourthOrder}}() \{}
\DoxyCodeLine{29     Eigen::TensorFixedSize<double, Eigen::Sizes<dim, dim, dim, dim>> idTensor;}
\DoxyCodeLine{30     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim; ++i)}
\DoxyCodeLine{31       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim; ++j)}
\DoxyCodeLine{32         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < dim; ++k)}
\DoxyCodeLine{33           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < dim; ++l)}
\DoxyCodeLine{34             idTensor(i, j, k, l) = 0.5 * ((i == k) * (j == l) + (i == l) * (j == k));}
\DoxyCodeLine{35     \textcolor{keywordflow}{return} idTensor;}
\DoxyCodeLine{36   \}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}, \textcolor{keywordtype}{int} dim = 3>}
\DoxyCodeLine{39   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a2368a572348c410fd7e7deb6c6e3964a}{symmetricFourthOrder}}(\textcolor{keyword}{const} \textcolor{keyword}{auto}\& A, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& B) \{}
\DoxyCodeLine{40     Eigen::TensorFixedSize<double, Eigen::Sizes<dim, dim, dim, dim>> idTensor;}
\DoxyCodeLine{41     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim; ++i)}
\DoxyCodeLine{42       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim; ++j)}
\DoxyCodeLine{43         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < dim; ++k)}
\DoxyCodeLine{44           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < dim; ++l)}
\DoxyCodeLine{45             idTensor(i, j, k, l) = 0.5 * (A(i, k) * B(j, l) + A(i, l) * B(j, k));}
\DoxyCodeLine{46     \textcolor{keywordflow}{return} idTensor;}
\DoxyCodeLine{47   \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}, \textcolor{keywordtype}{int} dim = 3>}
\DoxyCodeLine{50   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_adb08b6f9cc40847b70286dc314a23000}{identityFourthOrder}}() \{}
\DoxyCodeLine{51     Eigen::TensorFixedSize<ScalarType, Eigen::Sizes<dim, dim, dim, dim>> idTensor;}
\DoxyCodeLine{52     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim; ++i)}
\DoxyCodeLine{53       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim; ++j)}
\DoxyCodeLine{54         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < dim; ++k)}
\DoxyCodeLine{55           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < dim; ++l)}
\DoxyCodeLine{56             idTensor(i, j, k, l) = (i == j) * (k == l);}
\DoxyCodeLine{57     \textcolor{keywordflow}{return} idTensor;}
\DoxyCodeLine{58   \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{keyword}{template} <\textcolor{keyword}{typename} AType, \textcolor{keyword}{typename} BType>}
\DoxyCodeLine{61   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a8fa2b440586483c1ee0f9b90b9081da2}{fourthOrderIKJL}}(\textcolor{keyword}{const} Eigen::MatrixBase<AType>\& A, \textcolor{keyword}{const} Eigen::MatrixBase<BType>\& B) \{}
\DoxyCodeLine{62     \textcolor{keyword}{static\_assert}(AType::RowsAtCompileTime == BType::RowsAtCompileTime);}
\DoxyCodeLine{63     \textcolor{keyword}{static\_assert}(AType::ColsAtCompileTime == BType::ColsAtCompileTime);}
\DoxyCodeLine{64     \textcolor{keyword}{using }ScalarResultType =}
\DoxyCodeLine{65         \textcolor{keyword}{typename} Dune::PromotionTraits<typename AType::Scalar, typename BType::Scalar>::PromotedType;}
\DoxyCodeLine{66     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} dim = AType::RowsAtCompileTime;}
\DoxyCodeLine{67     Eigen::TensorFixedSize<ScalarResultType, Eigen::Sizes<dim, dim, dim, dim>> res;}
\DoxyCodeLine{68     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim; ++i)}
\DoxyCodeLine{69       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim; ++j)}
\DoxyCodeLine{70         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < dim; ++k)}
\DoxyCodeLine{71           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < dim; ++l)}
\DoxyCodeLine{72             res(i, j, k, l) = A(i, k) * B(j, l);}
\DoxyCodeLine{73     \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{74   \}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType, \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} dim>}
\DoxyCodeLine{77   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_aea03dbfcd8f85ef7af004c7e09244aa9}{symTwoSlots}}(\textcolor{keyword}{const} Eigen::TensorFixedSize<ScalarType, Eigen::Sizes<dim, dim, dim, dim>>\& t,}
\DoxyCodeLine{78                    \textcolor{keyword}{const} std::array<size\_t, 2>\& slots) \{}
\DoxyCodeLine{79     std::array<size\_t, 4> shuffleSlot;}
\DoxyCodeLine{80     std::iota(shuffleSlot.begin(), shuffleSlot.end(), 0);     \textcolor{comment}{// create 0,1,2,3 array}}
\DoxyCodeLine{81     std::swap(shuffleSlot[slots[0]], shuffleSlot[slots[1]]);  \textcolor{comment}{// swap  the given slots}}
\DoxyCodeLine{82     \textcolor{keywordflow}{return} (0.5 * (t + t.shuffle(shuffleSlot))).eval();}
\DoxyCodeLine{83   \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   \textcolor{keyword}{constexpr} Eigen::Index \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(Eigen::Index i, Eigen::Index j) \textcolor{keyword}{noexcept} \{}
\DoxyCodeLine{86     \textcolor{keywordflow}{if} (i == j)  \textcolor{comment}{// \_00 -\/> 0, \_11 -\/> 1,  \_22 -\/> 2}}
\DoxyCodeLine{87       \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{88     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((i == 1 and j == 2) or (i == 2 and j == 1))  \textcolor{comment}{// \_12 and \_21 -\/-\/> 3}}
\DoxyCodeLine{89       \textcolor{keywordflow}{return} 3;}
\DoxyCodeLine{90     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((i == 0 and j == 2) or (i == 2 and j == 0))  \textcolor{comment}{// \_02 and \_20 -\/-\/> 4}}
\DoxyCodeLine{91       \textcolor{keywordflow}{return} 4;}
\DoxyCodeLine{92     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((i == 0 and j == 1) or (i == 1 and j == 0))  \textcolor{comment}{// \_01 and \_10 -\/-\/> 5}}
\DoxyCodeLine{93       \textcolor{keywordflow}{return} 5;}
\DoxyCodeLine{94     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{95       assert(i < 3 and j < 3 \&\& \textcolor{stringliteral}{"{}For Voigt notation the indices need to be 0,1 or 2."{}});}
\DoxyCodeLine{96       \_\_builtin\_unreachable();}
\DoxyCodeLine{97     \}}
\DoxyCodeLine{98   \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{101   Eigen::Matrix<ScalarType, 6, 6> \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(\textcolor{keyword}{const} Eigen::TensorFixedSize<ScalarType, Eigen::Sizes<3, 3, 3, 3>>\& ft) \{}
\DoxyCodeLine{102     Eigen::Matrix<ScalarType, 6, 6> mat;}
\DoxyCodeLine{103     \textcolor{keywordflow}{for} (Eigen::Index i = 0; i < 3; ++i)}
\DoxyCodeLine{104       \textcolor{keywordflow}{for} (Eigen::Index j = 0; j < 3; ++j)}
\DoxyCodeLine{105         \textcolor{keywordflow}{for} (Eigen::Index k = 0; k < 3; ++k)}
\DoxyCodeLine{106           \textcolor{keywordflow}{for} (Eigen::Index l = 0; l < 3; ++l)}
\DoxyCodeLine{107             mat(\mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(i, j), \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(k, l)) = ft(i, j, k, l);  \textcolor{comment}{// TODO exploit symmetry}}
\DoxyCodeLine{108     \textcolor{keywordflow}{return} mat;}
\DoxyCodeLine{109   \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST, \textcolor{keywordtype}{int} size, \textcolor{keywordtype}{int} Options, \textcolor{keywordtype}{int} MaxRows>}
\DoxyCodeLine{112   \textcolor{keyword}{requires}(size > 0 and size <= 3) \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(\textcolor{keyword}{const} Eigen::Matrix<ST, size, size, Options, MaxRows, MaxRows>\& E,}
\DoxyCodeLine{113                                                 \textcolor{keywordtype}{bool} isStrain = \textcolor{keyword}{true}) \{}
\DoxyCodeLine{114     Eigen::Vector<ST, (size * (size + 1)) / 2> EVoigt;}
\DoxyCodeLine{115     EVoigt.template segment<size>(0) = E.diagonal();}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{keyword}{const} ST possibleStrainFactor = isStrain ? 2.0 : 1.0;}
\DoxyCodeLine{118     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (size == 2)}
\DoxyCodeLine{119       EVoigt(2) = E(0, 1) * possibleStrainFactor;}
\DoxyCodeLine{120     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (size == 3) \{}
\DoxyCodeLine{121       EVoigt(size)     = E(1, 2) * possibleStrainFactor;}
\DoxyCodeLine{122       EVoigt(size + 1) = E(0, 2) * possibleStrainFactor;}
\DoxyCodeLine{123       EVoigt(size + 2) = E(0, 1) * possibleStrainFactor;}
\DoxyCodeLine{124     \}}
\DoxyCodeLine{125     \textcolor{keywordflow}{return} EVoigt;}
\DoxyCodeLine{126   \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128   \textcolor{keyword}{constexpr} std::array<size\_t, 2> \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(\textcolor{keywordtype}{size\_t} i) \{}
\DoxyCodeLine{129     \textcolor{keywordflow}{if} (i < 3)  \textcolor{comment}{// \_00 -\/> 0, \_11 -\/> 1,  \_22 -\/> 2}}
\DoxyCodeLine{130       \textcolor{keywordflow}{return} \{i, i\};}
\DoxyCodeLine{131     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (i == 3)}
\DoxyCodeLine{132       \textcolor{keywordflow}{return} \{1, 2\};}
\DoxyCodeLine{133     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (i == 4)}
\DoxyCodeLine{134       \textcolor{keywordflow}{return} \{0, 2\};}
\DoxyCodeLine{135     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (i == 5)}
\DoxyCodeLine{136       \textcolor{keywordflow}{return} \{0, 1\};}
\DoxyCodeLine{137     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{138       assert(i < 6 \&\& \textcolor{stringliteral}{"{}For Voigt notation the indices need to be 0 and 5."{}});}
\DoxyCodeLine{139       \_\_builtin\_unreachable();}
\DoxyCodeLine{140     \}}
\DoxyCodeLine{141   \}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST, \textcolor{keywordtype}{int} size>}
\DoxyCodeLine{144   \textcolor{keyword}{requires}(size == 1 or size == 3 or size == 6) \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(\textcolor{keyword}{const} Eigen::Vector<ST, size>\& EVoigt,}
\DoxyCodeLine{145                                                                \textcolor{keywordtype}{bool} isStrain = \textcolor{keyword}{true}) \{}
\DoxyCodeLine{146     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} matrixSize = (-\/1 + \mbox{\hyperlink{a00219_ae55d4d0c3478ab3ecf54ce905ddf223b}{Ikarus::ct\_sqrt}}(1 + 8 * size)) / 2;}
\DoxyCodeLine{147     Eigen::Matrix<ST, matrixSize, matrixSize> E;}
\DoxyCodeLine{148     E.diagonal() = EVoigt.template segment<3>(0);}
\DoxyCodeLine{149 }
\DoxyCodeLine{150     \textcolor{keyword}{const} ST possibleStrainFactor = isStrain ? 0.5 : 1.0;}
\DoxyCodeLine{151     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (matrixSize == 2)}
\DoxyCodeLine{152       E(0, 1) = E(1, 0) = EVoigt(2) * possibleStrainFactor;}
\DoxyCodeLine{153     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (matrixSize == 3) \{}
\DoxyCodeLine{154       E(2, 1) = E(1, 2) = EVoigt(matrixSize) * possibleStrainFactor;}
\DoxyCodeLine{155       E(2, 0) = E(0, 2) = EVoigt(matrixSize + 1) * possibleStrainFactor;}
\DoxyCodeLine{156       E(1, 0) = E(0, 1) = EVoigt(matrixSize + 2) * possibleStrainFactor;}
\DoxyCodeLine{157     \}}
\DoxyCodeLine{158     \textcolor{keywordflow}{return} E;}
\DoxyCodeLine{159   \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{162   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(\textcolor{keyword}{const} Eigen::Matrix<ScalarType, 6, 6>\& CVoigt) \{}
\DoxyCodeLine{163     Eigen::TensorFixedSize<ScalarType, Eigen::Sizes<3, 3, 3, 3>> C;}
\DoxyCodeLine{164     \textcolor{comment}{//    size\_t iR=0,jR=0;}}
\DoxyCodeLine{165     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < 6; ++i) \{}
\DoxyCodeLine{166       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < 6; ++j) \{}
\DoxyCodeLine{167         \textcolor{keyword}{auto} firstIndices                                                       = \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(i);}
\DoxyCodeLine{168         \textcolor{keyword}{auto} secondIndices                                                      = \mbox{\hyperlink{a00219_a518e0394f7c90dbe798b6cb8d757b822}{fromVoigt}}(j);}
\DoxyCodeLine{169         C(firstIndices[0], firstIndices[1], secondIndices[0], secondIndices[1]) = CVoigt(i, j);}
\DoxyCodeLine{170       \}  \textcolor{comment}{// TODO exploit symmetry}}
\DoxyCodeLine{171     \}}
\DoxyCodeLine{172     \textcolor{keywordflow}{return} C;}
\DoxyCodeLine{173   \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived, \textcolor{keywordtype}{size\_t} sizeOfCondensedIndices>}
\DoxyCodeLine{176   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a19d425a4fbc72c2ef7a97d71de9329a4}{staticCondensation}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived>\& E,}
\DoxyCodeLine{177                           \textcolor{keyword}{const} std::array<size\_t, sizeOfCondensedIndices>\& indices) \{}
\DoxyCodeLine{178     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} colsFull = std::remove\_cvref\_t<Derived>::ColsAtCompileTime;}
\DoxyCodeLine{179     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} rowsFull = std::remove\_cvref\_t<Derived>::RowsAtCompileTime;}
\DoxyCodeLine{180     \textcolor{keyword}{static\_assert}(colsFull == rowsFull, \textcolor{stringliteral}{"{}staticCondensation only allowed for square matrices"{}});}
\DoxyCodeLine{181     std::array<size\_t, rowsFull -\/ sizeOfCondensedIndices> remainingIndices\{\};}
\DoxyCodeLine{182     std::ranges::set\_difference(std::ranges::iota\_view(\textcolor{keywordtype}{size\_t}(0), \textcolor{keywordtype}{size\_t}(colsFull)), indices, remainingIndices.begin());}
\DoxyCodeLine{183 }
\DoxyCodeLine{184     \textcolor{keyword}{auto} K11 = E(remainingIndices, remainingIndices);}
\DoxyCodeLine{185     \textcolor{keyword}{auto} K12 = E(indices, remainingIndices);}
\DoxyCodeLine{186     \textcolor{keyword}{auto} K22 = E(indices, indices);}
\DoxyCodeLine{187 }
\DoxyCodeLine{188     \textcolor{keywordflow}{return} (K11 -\/ K12.transpose() * K22.inverse() * K12).eval();}
\DoxyCodeLine{189   \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Derived, \textcolor{keywordtype}{size\_t} sizeOfRemovedCols>}
\DoxyCodeLine{192   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a2f675229501979101656ec4dee7764d5}{removeCol}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived>\& E, \textcolor{keyword}{const} std::array<size\_t, sizeOfRemovedCols>\& indices) \{}
\DoxyCodeLine{193     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} colsFull = std::remove\_cvref\_t<Derived>::ColsAtCompileTime;}
\DoxyCodeLine{194     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} rowsFull = std::remove\_cvref\_t<Derived>::RowsAtCompileTime;}
\DoxyCodeLine{195     \textcolor{keyword}{static\_assert}(colsFull == 1);}
\DoxyCodeLine{196 }
\DoxyCodeLine{197     std::array<size\_t, rowsFull -\/ sizeOfRemovedCols> remainingIndices\{\};}
\DoxyCodeLine{198     std::ranges::set\_difference(std::ranges::iota\_view(\textcolor{keywordtype}{size\_t}(0), \textcolor{keywordtype}{size\_t}(rowsFull)), indices, remainingIndices.begin());}
\DoxyCodeLine{199 }
\DoxyCodeLine{200     \textcolor{keywordflow}{return} (E(remainingIndices)).eval();}
\DoxyCodeLine{201   \}}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST, \textcolor{keyword}{typename} MaterialImpl>}
\DoxyCodeLine{204   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_aba308983af2a69237076686ddad82a60}{toVoigtAndMaybeReduce}}(\textcolor{keyword}{const} Eigen::Matrix<ST, 3, 3>\& E, \textcolor{keyword}{const} MaterialImpl\&, \textcolor{keywordtype}{bool} isStrain = \textcolor{keyword}{true}) \{}
\DoxyCodeLine{205     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!MaterialImpl::isReduced)}
\DoxyCodeLine{206       \textcolor{keywordflow}{return} \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(E, isStrain);}
\DoxyCodeLine{207     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{208       \textcolor{keyword}{auto} ev = \mbox{\hyperlink{a00219_a4304655095296ce9283e012587817a51}{toVoigt}}(E, isStrain);}
\DoxyCodeLine{209       \textcolor{keyword}{static\_assert}(\textcolor{keyword}{decltype}(ev)::RowsAtCompileTime == 6 and \textcolor{keyword}{decltype}(ev)::ColsAtCompileTime == 1);}
\DoxyCodeLine{210 }
\DoxyCodeLine{211       \textcolor{keyword}{auto} evRed = \mbox{\hyperlink{a00219_a2f675229501979101656ec4dee7764d5}{removeCol}}(ev, MaterialImpl::fixedVoigtIndices);}
\DoxyCodeLine{212       \textcolor{keyword}{static\_assert}(\textcolor{keyword}{decltype}(evRed)::RowsAtCompileTime == 6 -\/ MaterialImpl::fixedVoigtIndices.size()}
\DoxyCodeLine{213                     and \textcolor{keyword}{decltype}(evRed)::ColsAtCompileTime == 1);}
\DoxyCodeLine{214       \textcolor{keywordflow}{return} evRed;}
\DoxyCodeLine{215     \}}
\DoxyCodeLine{216   \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{218   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Material, \textcolor{keyword}{typename} Derived>}
\DoxyCodeLine{219   \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) \mbox{\hyperlink{a00219_a30500f2c49b7d1997c7eb7b6ee90ad75}{enlargeIfReduced}}(\textcolor{keyword}{const} Eigen::MatrixBase<Derived>\& E) \{}
\DoxyCodeLine{220     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (!Concepts::EigenVector6<Derived> and \mbox{\hyperlink{a01581}{Concepts::EigenVector<Derived>}}) \{}
\DoxyCodeLine{221       \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{a01161_a3b749f6ed133ec43699a39a043b4e605}{Material::isReduced}}, \textcolor{stringliteral}{"{}You should only end up here, if your material is reduced"{}});}
\DoxyCodeLine{222 }
\DoxyCodeLine{223       \textcolor{keyword}{auto} freeindices = Material::MaterialImpl::freeVoigtIndices;}
\DoxyCodeLine{224       \textcolor{keyword}{auto} p\_E         = Eigen::Vector<typename Material::MaterialImpl::ScalarType, 6>::Zero().eval();}
\DoxyCodeLine{225       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ri = 0; \textcolor{keyword}{auto} i : freeindices)}
\DoxyCodeLine{226         p\_E(i) = E(ri++);}
\DoxyCodeLine{227       \textcolor{keywordflow}{return} p\_E;}
\DoxyCodeLine{228 }
\DoxyCodeLine{229     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (Concepts::EigenMatrix66<}
\DoxyCodeLine{230                              Derived> or Concepts::EigenMatrix33<Derived> or Concepts::EigenVector6<Derived>) \{}
\DoxyCodeLine{231       \textcolor{keywordflow}{return} E.derived();}
\DoxyCodeLine{232     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{233       \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{a01161_a3b749f6ed133ec43699a39a043b4e605}{Material::isReduced}}, \textcolor{stringliteral}{"{}You should only end up here, if your material is reduced"{}});}
\DoxyCodeLine{234 }
\DoxyCodeLine{235       \textcolor{keyword}{auto} freeindices = Material::MaterialImpl::freeVoigtIndices;}
\DoxyCodeLine{236       \textcolor{keyword}{auto} p\_E         = Eigen::Matrix<typename Material::MaterialImpl::ScalarType, 6, 6>::Zero().eval();}
\DoxyCodeLine{237       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ri = 0; \textcolor{keyword}{auto} i : freeindices) \{}
\DoxyCodeLine{238         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rj = 0; \textcolor{keyword}{auto} j : freeindices)}
\DoxyCodeLine{239           p\_E(i, j) = E(ri, rj++);}
\DoxyCodeLine{240         ++ri;}
\DoxyCodeLine{241       \}}
\DoxyCodeLine{242       \textcolor{keywordflow}{return} p\_E;}
\DoxyCodeLine{243     \}}
\DoxyCodeLine{244   \}}
\DoxyCodeLine{245 }
\DoxyCodeLine{246 \}  \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
