\hypertarget{a02464_source}{}\doxysection{finiteelements/mechanics/linearelastic.hh}
\label{a02464_source}\index{linearelastic.hh@{linearelastic.hh}}
\mbox{\hyperlink{a02464}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{  \#include <iosfwd>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{  \#include <optional>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{  \#include <type\_traits>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{  \#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{  \#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{  \#include <dune/localfefunctions/expressions/linearStrainsExpr.hh>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{  \#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{  \#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00260}{ikarus/finiteelements/febase.hh}}>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00263}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00254}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00206}{ikarus/finiteelements/mechanics/loads.hh}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00215}{ikarus/finiteelements/mechanics/materials.hh}}>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00251}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00047}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{31 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00050}{ikarus/utils/linearalgebrahelper.hh}}>}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00325}{Ikarus}} \{}
\DoxyCodeLine{34 }
\DoxyCodeLine{45 \textcolor{keyword}{template} <\textcolor{keyword}{typename} BH, \textcolor{keyword}{typename} FER = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false, \textcolor{keywordtype}{bool} useFlat = true>}
\DoxyCodeLine{46 \textcolor{keyword}{class }\mbox{\hyperlink{a01304}{LinearElastic}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01228}{FEBase}}<BH, useFlat, FER, useEigenRef>,}
\DoxyCodeLine{47                       \textcolor{keyword}{public} \mbox{\hyperlink{a01312}{Volume}}<LinearElastic<BH, FER, useEigenRef, useFlat>,}
\DoxyCodeLine{48                                     typename FEBase<BH, useFlat, FER, useEigenRef>::Traits>,}
\DoxyCodeLine{49                       \textcolor{keyword}{public} \mbox{\hyperlink{a01308}{Traction}}<LinearElastic<BH, FER, useEigenRef, useFlat>,}
\DoxyCodeLine{50                                       typename FEBase<BH, useFlat, FER, useEigenRef>::Traits>}
\DoxyCodeLine{51 \{}
\DoxyCodeLine{52 \textcolor{keyword}{public}:}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01228}{Base}}                 = \mbox{\hyperlink{a01228}{FEBase<BH, useFlat, FER, useEigenRef>}};}
\DoxyCodeLine{54   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a950078f863ac0e34a6633eaa6efb16e9}{Traits}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01228_ac5fdc9a8e9d4a7d670df89d397129588}{Base::Traits}};}
\DoxyCodeLine{55   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a660143a4c32e9768e75cbad2365c3f7b}{BasisHandler}}         = \textcolor{keyword}{typename} Traits::BasisHandler;}
\DoxyCodeLine{56   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a814b5f30cae83d0bf86cb814e1d1b087}{FlatBasis}}            = \textcolor{keyword}{typename} Traits::FlatBasis;}
\DoxyCodeLine{57   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}    = \textcolor{keyword}{typename} Traits::FERequirementType;}
\DoxyCodeLine{58   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a5522b3975f13520030ce71dd68ad9b84}{LocalView}}            = \textcolor{keyword}{typename} Traits::LocalView;}
\DoxyCodeLine{59   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a8b5becbccef0dc42423cd76c27bef5b8}{Geometry}}             = \textcolor{keyword}{typename} Traits::Geometry;}
\DoxyCodeLine{60   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_ad517cec2661544d1be2525a529f91432}{GridView}}             = \textcolor{keyword}{typename} Traits::GridView;}
\DoxyCodeLine{61   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a042a0043867c47d57faf6db8f5b96de0}{Element}}              = \textcolor{keyword}{typename} Traits::Element;}
\DoxyCodeLine{62   \textcolor{keyword}{using }\mbox{\hyperlink{a01312}{VolumeType}}           = \mbox{\hyperlink{a01312}{Volume<LinearElastic, Traits>}};}
\DoxyCodeLine{63   \textcolor{keyword}{using }\mbox{\hyperlink{a01308}{TractionType}}         = \mbox{\hyperlink{a01308}{Traction<LinearElastic, Traits>}};}
\DoxyCodeLine{64   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}} = Traits::mydim;}
\DoxyCodeLine{65   \textcolor{keyword}{using }\mbox{\hyperlink{a01304_a91770d9f8e1c7c06007d91ac3999999e}{LocalBasisType}}       = \textcolor{keyword}{decltype}(std::declval<LocalView>().tree().child(0).finiteElement().localBasis());}
\DoxyCodeLine{66 }
\DoxyCodeLine{80   \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{81   \mbox{\hyperlink{a01304_a3089737b2164de05fb2604d55bce0e01}{LinearElastic}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a660143a4c32e9768e75cbad2365c3f7b}{BasisHandler}}\& basisHandler, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keywordtype}{double} emod, \textcolor{keywordtype}{double} nu,}
\DoxyCodeLine{82                 VolumeLoad volumeLoad = \{\}, \textcolor{keyword}{const} BoundaryPatch<GridView>* neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{83                 NeumannBoundaryLoad neumannBoundaryLoad = \{\})}
\DoxyCodeLine{84       : \mbox{\hyperlink{a01304_a40eee3838220cccab2e15e7047991988}{Base}}(basisHandler, element),}
\DoxyCodeLine{85         \mbox{\hyperlink{a01304_a827cb2b8d4b745e07db3955c25c35f4b}{VolumeType}}(volumeLoad),}
\DoxyCodeLine{86         \mbox{\hyperlink{a01304_a1fc3d5fa49ff4f5c1e46c9f0844afc05}{TractionType}}(neumannBoundary, neumannBoundaryLoad),}
\DoxyCodeLine{87         emod\_\{emod\},}
\DoxyCodeLine{88         nu\_\{nu\} \{}
\DoxyCodeLine{89     \textcolor{keyword}{auto}\& firstChild = this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().tree().child(0);}
\DoxyCodeLine{90     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe   = firstChild.finiteElement();}
\DoxyCodeLine{91     geo\_             = std::make\_shared<const Geometry>(this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().\mbox{\hyperlink{a01304_a246ca86f533ad0ceadb983a4dbd4ae80}{geometry}}());}
\DoxyCodeLine{92     numberOfNodes\_   = fe.size();}
\DoxyCodeLine{93     order\_           = 2 * (fe.localBasis().order());}
\DoxyCodeLine{94     localBasis\_      = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{95     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().impl().getQuadratureRule(order\_); \})}
\DoxyCodeLine{96       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{97         localBasis\_.bind(this-\/>localView().element().impl().getQuadratureRule(order\_), Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{98       \textcolor{keywordflow}{else}}
\DoxyCodeLine{99         localBasis\_.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().type(), order\_),}
\DoxyCodeLine{100                          Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{101     \textcolor{keywordflow}{else}}
\DoxyCodeLine{102       localBasis\_.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().type(), order\_),}
\DoxyCodeLine{103                        Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{104   \}}
\DoxyCodeLine{113   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{114   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_a6526cbcd08616598920cf2286ff041bf}{displacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par,}
\DoxyCodeLine{115                             \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{116     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00312_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{117     \textcolor{keyword}{auto} disp     = Ikarus::FEHelper::localSolutionBlockVector<Traits>(d, this-\/>\mbox{\hyperlink{a01228_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}(), dx);}
\DoxyCodeLine{118     Dune::StandardLocalFunction uFunction(localBasis\_, disp, geo\_);}
\DoxyCodeLine{119     \textcolor{keywordflow}{return} uFunction;}
\DoxyCodeLine{120   \}}
\DoxyCodeLine{129   \textcolor{keyword}{template} <\textcolor{keyword}{class} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{130   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_a950067ec358a96fdff38c38ac6ac6ca4}{strainFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par,}
\DoxyCodeLine{131                       \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{132     \textcolor{keywordflow}{return} Dune::linearStrains(\mbox{\hyperlink{a01304_a6526cbcd08616598920cf2286ff041bf}{displacementFunction}}(par, dx));}
\DoxyCodeLine{133   \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{140   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{141     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}} == 2)}
\DoxyCodeLine{142       \textcolor{keywordflow}{return} \mbox{\hyperlink{a00325_a90678a80e6b2b4849072623df02dae58}{planeStressLinearElasticMaterialTangent}}(emod\_, nu\_);}
\DoxyCodeLine{143     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}} == 3)}
\DoxyCodeLine{144       \textcolor{keywordflow}{return} \mbox{\hyperlink{a00325_ab859759a8309b785e7872d8360171030}{linearElasticMaterialTangent3D}}(emod\_, nu\_);}
\DoxyCodeLine{145   \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{153   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_a33d2cf28926eaf2e46e3231d750b4e82}{materialTangentFunction}}([[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{154     \textcolor{keywordflow}{return} [\&]([[maybe\_unused]] \textcolor{keyword}{auto} gp) \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}(); \};}
\DoxyCodeLine{155   \}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157   \textcolor{keyword}{const} \mbox{\hyperlink{a01304_a8b5becbccef0dc42423cd76c27bef5b8}{Geometry}}\& \mbox{\hyperlink{a01304_a246ca86f533ad0ceadb983a4dbd4ae80}{geometry}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} *geo\_; \}}
\DoxyCodeLine{158   [[nodiscard]] \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01304_ad1604e983d8de31a5ca747c35bf509f5}{numberOfNodes}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} numberOfNodes\_; \}}
\DoxyCodeLine{159   [[nodiscard]] \textcolor{keywordtype}{int} \mbox{\hyperlink{a01304_ad2da7f4caadbc6df50553d71900b3bb6}{order}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} order\_; \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{167   \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{a01304_ababbfa85d0473cf7a7bd38b8f1351e1d}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(par); \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{175   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01304_a7ca7b43c3fe2c59cf64ff7a818025d63}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{176     calculateVectorImpl<double>(par, force);}
\DoxyCodeLine{177   \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{185   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01304_ab108d5374fab0ec824376ebf0ecb09f5}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{186     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01304_a950067ec358a96fdff38c38ac6ac6ca4}{strainFunction}}(par);}
\DoxyCodeLine{187     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{188     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00341}{Dune}};}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}();}
\DoxyCodeLine{191     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{192       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{193       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{194         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01228_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{195         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < numberOfNodes\_; ++j) \{}
\DoxyCodeLine{196           \textcolor{keyword}{const} \textcolor{keyword}{auto} bopJ = eps.evaluateDerivative(gpIndex, wrt(coeff(j)), on(\mbox{\hyperlink{a01228_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{197           K.template block<myDim, myDim>(i * \mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}}, j * \mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}}) += bopI.transpose() * C * bopJ * intElement;}
\DoxyCodeLine{198         \}}
\DoxyCodeLine{199       \}}
\DoxyCodeLine{200     \}}
\DoxyCodeLine{201 }
\DoxyCodeLine{202     \textcolor{comment}{// Update due to displacement-\/dependent external loads, e.g., follower loads}}
\DoxyCodeLine{203     \mbox{\hyperlink{a01312_a50c6859b6c9a40fbb8ac9cc77d8087db}{VolumeType::calculateMatrix}}(par, K);}
\DoxyCodeLine{204     \mbox{\hyperlink{a01308_aa4336b55618b836ca7b2b3aebf4242bf}{TractionType::calculateMatrix}}(par, K);}
\DoxyCodeLine{205   \}}
\DoxyCodeLine{206 }
\DoxyCodeLine{216   \textcolor{keyword}{template} <ResultType resType>}
\DoxyCodeLine{217   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_aa624dfb73fb0e733821bb63734718b04}{calculateAt}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01496}{Dune::FieldVector<double, Traits::mydim>}}\& local)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{218     \textcolor{keyword}{static\_assert}(resType == \mbox{\hyperlink{a00312_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}, \textcolor{stringliteral}{"{}The requested result type is NOT implemented."{}});}
\DoxyCodeLine{219 }
\DoxyCodeLine{220     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (resType == \mbox{\hyperlink{a00312_gga531be167e924b749eb8b4ccc7f1c18c9ad8cbb8fe32024cc3f1376a24d27aeae7}{ResultType::linearStress}}) \{}
\DoxyCodeLine{221       \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01304_a950067ec358a96fdff38c38ac6ac6ca4}{strainFunction}}(req);}
\DoxyCodeLine{222       \textcolor{keyword}{const} \textcolor{keyword}{auto} C   = \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}();}
\DoxyCodeLine{223       \textcolor{keyword}{auto} epsVoigt  = eps.evaluate(local, Dune::on(Dune::DerivativeDirections::gridElement));}
\DoxyCodeLine{224 }
\DoxyCodeLine{225       \textcolor{keywordflow}{return} (C * epsVoigt).eval();}
\DoxyCodeLine{226     \}}
\DoxyCodeLine{227   \}}
\DoxyCodeLine{228 }
\DoxyCodeLine{229 \textcolor{keyword}{private}:}
\DoxyCodeLine{230   std::shared\_ptr<const Geometry> geo\_;}
\DoxyCodeLine{231   Dune::CachedLocalBasis<std::remove\_cvref\_t<LocalBasisType>> localBasis\_;}
\DoxyCodeLine{232   \textcolor{keywordtype}{double} emod\_;}
\DoxyCodeLine{233   \textcolor{keywordtype}{double} nu\_;}
\DoxyCodeLine{234   \textcolor{keywordtype}{size\_t} numberOfNodes\_\{0\};}
\DoxyCodeLine{235   \textcolor{keywordtype}{int} order\_\{\};}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 \textcolor{keyword}{protected}:}
\DoxyCodeLine{238   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{239   \textcolor{keyword}{auto} \mbox{\hyperlink{a01304_a2bd57b0020bc5144908df7d582533cc7}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par,}
\DoxyCodeLine{240                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt) \textcolor{keyword}{const}}
\DoxyCodeLine{241       -\/> ScalarType \{}
\DoxyCodeLine{242     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01304_a6526cbcd08616598920cf2286ff041bf}{displacementFunction}}(par, dx);}
\DoxyCodeLine{243     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps       = \mbox{\hyperlink{a01304_a950067ec358a96fdff38c38ac6ac6ca4}{strainFunction}}(par, dx);}
\DoxyCodeLine{244     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00312_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{245     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{246     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00341}{Dune}};}
\DoxyCodeLine{247 }
\DoxyCodeLine{248     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}();}
\DoxyCodeLine{249 }
\DoxyCodeLine{250     ScalarType energy = 0.0;}
\DoxyCodeLine{251     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{252       \textcolor{keyword}{const} \textcolor{keyword}{auto} EVoigt = eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01228_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{253       energy += (0.5 * EVoigt.dot(C * EVoigt)) * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{254     \}}
\DoxyCodeLine{255 }
\DoxyCodeLine{256     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{257     energy += \mbox{\hyperlink{a01312_a7ec1326b708d8c08fee05ca7b601f997}{VolumeType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{258 }
\DoxyCodeLine{259     \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{260     energy += \mbox{\hyperlink{a01308_a2576d38cb79bb0b5bf59f433fa7c1633}{TractionType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{261     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{262   \}}
\DoxyCodeLine{263 }
\DoxyCodeLine{264   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{265   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01304_af75f290aad4b52072053aa027d4b2f0d}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01304_a68a72cb2746c3c4cac9ee3878d5d548e}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{266                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{267     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01304_a950067ec358a96fdff38c38ac6ac6ca4}{strainFunction}}(par, dx);}
\DoxyCodeLine{268     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{269     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00341}{Dune}};}
\DoxyCodeLine{270 }
\DoxyCodeLine{271     \textcolor{keyword}{const} \textcolor{keyword}{auto} C = \mbox{\hyperlink{a01304_a9b8a8b22100c74f236bc974262db042a}{materialTangent}}();}
\DoxyCodeLine{272 }
\DoxyCodeLine{273     \textcolor{comment}{// Internal forces}}
\DoxyCodeLine{274     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{275       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{276       \textcolor{keyword}{auto} stresses           = (C * eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01228_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}))).eval();}
\DoxyCodeLine{277       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{278         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01228_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{279         force.template segment<myDim>(\mbox{\hyperlink{a01304_abdafebbb8089d2c0a9ec5ff9ec30e87e}{myDim}} * i) += bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{280       \}}
\DoxyCodeLine{281     \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{284     \mbox{\hyperlink{a01312_a9b91a057a51ab4487656d8bd94fdd234}{VolumeType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{285 }
\DoxyCodeLine{286     \textcolor{comment}{// External forces, boundary forces, i.e., at the Neumann boundary}}
\DoxyCodeLine{287     \mbox{\hyperlink{a01308_aabcfd5d855e2230fe90abb12a1ba8d2b}{TractionType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{288   \}}
\DoxyCodeLine{289 \};}
\DoxyCodeLine{290 \} \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{291 }
\DoxyCodeLine{292 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{293 \textcolor{preprocessor}{  \#error LinearElastic depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{294 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
