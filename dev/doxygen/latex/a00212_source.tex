\hypertarget{a00212_source}{}\doxysection{enhancedassumedstrains.\+hh}
\label{a00212_source}\index{enhancedassumedstrains.hh@{enhancedassumedstrains.hh}}
\mbox{\hyperlink{a00212}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{13 \textcolor{preprocessor}{  \#include <dune/localfefunctions/derivativetransformators.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{  \#include <dune/localfefunctions/linearAlgebraHelper.hh>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{  \#include <dune/localfefunctions/meta.hh>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00167}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00227}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00218}{ikarus/finiteelements/mechanics/easvariants.hh}}>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00245}{ikarus/finiteelements/mixin.hh}}>}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00360}{Ikarus}} \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{25 \textcolor{keyword}{class }EnhancedAssumedStrains;}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \textcolor{keyword}{struct }\mbox{\hyperlink{a01409}{EnhancedAssumedStrainsPre}}}
\DoxyCodeLine{31 \{}
\DoxyCodeLine{32   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01409_a4c30fabbf2fb4739dabcf7caa3855936}{numberOfParameters}}\{\};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34   \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{35   \textcolor{keyword}{using }\mbox{\hyperlink{a01405}{Skill}} = \mbox{\hyperlink{a01405}{EnhancedAssumedStrains<PreFE, FE>}};}
\DoxyCodeLine{36 \};}
\DoxyCodeLine{37 }
\DoxyCodeLine{48 \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{49 \textcolor{keyword}{class }\mbox{\hyperlink{a01405}{EnhancedAssumedStrains}}}
\DoxyCodeLine{50 \{}
\DoxyCodeLine{51 \textcolor{keyword}{public}:}
\DoxyCodeLine{52   \textcolor{keyword}{using }\mbox{\hyperlink{a01369}{Traits}} = \mbox{\hyperlink{a01313_a826c356a5afb013faffb5f7ac893cff4}{PreFE::Traits}};}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01341}{Requirement}} =}
\DoxyCodeLine{54       \mbox{\hyperlink{a01341}{FERequirementsFactory<FESolutions::displacement, FEParameter::loadfactor, Traits::useEigenRef>::type}};}
\DoxyCodeLine{55   \textcolor{keyword}{using }\mbox{\hyperlink{a01405_a5e8657da9cafc0eb0744abc6d78f40ee}{LocalView}} = \textcolor{keyword}{typename} \mbox{\hyperlink{a01369_a06bdad066f621e46875af45a22677a3c}{Traits::LocalView}};}
\DoxyCodeLine{56   \textcolor{keyword}{using }\mbox{\hyperlink{a01405_af9a84ff5a51d180ed10a0eaae73d59d4}{Geometry}}  = \textcolor{keyword}{typename} \mbox{\hyperlink{a01369_a0b7be1104fba2d190e3fed46f291a851}{Traits::Geometry}};}
\DoxyCodeLine{57   \textcolor{keyword}{using }\mbox{\hyperlink{a01405_a3ffd06f997ccccf1b5d2625372760279}{GridView}}  = \textcolor{keyword}{typename} \mbox{\hyperlink{a01369_a3ec0294824df467074f5070cb58f5a91}{Traits::GridView}};}
\DoxyCodeLine{58   \textcolor{keyword}{using }\mbox{\hyperlink{a01409}{Pre}}       = \mbox{\hyperlink{a01409}{EnhancedAssumedStrainsPre}};}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{keyword}{using }\mbox{\hyperlink{a01405_ac0240f5e442600ad657fb9b9f4cbb219}{SupportedResultTypes}} = std::tuple<decltype(makeRT<ResultTypes::linearStress>())>;}
\DoxyCodeLine{61 }
\DoxyCodeLine{66   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01405_a75462594650477236751a2251883597b}{EnhancedAssumedStrains}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01409}{Pre}}\& pre) \{ this-\/>\mbox{\hyperlink{a01405_adda3bf7e9e3e6a6bdadab56e5d69a878}{setEASType}}(pre.\mbox{\hyperlink{a01409_a4c30fabbf2fb4739dabcf7caa3855936}{numberOfParameters}}); \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{73   \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01405_abe6a790acb94dbb3061bbbe64f73b751}{isDisplacementBased}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} easVariant\_.isDisplacmentBased(); \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{80   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& \mbox{\hyperlink{a01405_a7b28d4252e1edb4f0e1fb8ac524098ed}{easVariant}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} easVariant\_; \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{87   \textcolor{keyword}{auto} \mbox{\hyperlink{a01405_adde36207d3eb902dd9a6f7075e991649}{numberOfEASParameters}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} easVariant\_.numberOfEASParameters(); \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{103   \textcolor{keyword}{template} <\textcolor{keyword}{template} <\textcolor{keyword}{typename}, \textcolor{keywordtype}{int}, \textcolor{keywordtype}{int}> \textcolor{keyword}{class }RT>}
\DoxyCodeLine{104   \textcolor{keyword}{auto} \mbox{\hyperlink{a01405_afddcb054816acf30dd2f0543a67dc96c}{calculateAtImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Requirement}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01677}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{105                        Dune::PriorityTag<2>)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{106     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01405_abe6a790acb94dbb3061bbbe64f73b751}{isDisplacementBased}}())}
\DoxyCodeLine{107       \textcolor{keywordflow}{return} underlying().template calculateAtImpl<RT>(req, local, Dune::PriorityTag<1>());}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     \textcolor{keyword}{using namespace }Dune::Indices;}
\DoxyCodeLine{110     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{111     \textcolor{keyword}{auto} resultVector = underlying().template calculateAtImpl<RT>(req, local, Dune::PriorityTag<1>());}
\DoxyCodeLine{112     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (isSameResultType<RT, ResultTypes::linearStress>) \{}
\DoxyCodeLine{113       \textcolor{keyword}{using }RTWrapper = \mbox{\hyperlink{a01365}{ResultWrapper<RT<typename Traits::ctype, Traits::mydim, Traits::worlddim>}}, \mbox{\hyperlink{a00360_acfb09bb7db104db62d3d1d2dc3e009b2a57dea6f5039281b7fee517fc43bf3110}{ResultShape::Vector}}>;}
\DoxyCodeLine{114       RTWrapper resultWrapper;}
\DoxyCodeLine{115 }
\DoxyCodeLine{116       \textcolor{keyword}{auto} calculateAtContribution = [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{117         \textcolor{keyword}{typename} EAST::DType D;}
\DoxyCodeLine{118         calculateDAndLMatrix(easFunction, req, D, L\_);}
\DoxyCodeLine{119         \textcolor{keyword}{const} \textcolor{keyword}{auto} ufunc = underlying().displacementFunction(req);}
\DoxyCodeLine{120         \textcolor{keyword}{const} \textcolor{keyword}{auto} disp  = \mbox{\hyperlink{a00355_ga545d74839895f4576a3b8c97d72abefd}{Dune::viewAsFlatEigenVector}}(ufunc.coefficientsRef());}
\DoxyCodeLine{121         \textcolor{keyword}{const} \textcolor{keyword}{auto} C     = underlying().materialTangentFunction(req);}
\DoxyCodeLine{122         \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L\_ * disp).eval();}
\DoxyCodeLine{123         \textcolor{keyword}{const} \textcolor{keyword}{auto} M     = easFunction.calcM(local);}
\DoxyCodeLine{124         \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval = C(local);}
\DoxyCodeLine{125         \textcolor{keyword}{auto} easStress   = (CEval * M * alpha).eval();}
\DoxyCodeLine{126         resultWrapper    = resultVector.asVec() + easStress;}
\DoxyCodeLine{127       \};}
\DoxyCodeLine{128       easVariant\_(calculateAtContribution);}
\DoxyCodeLine{129       \textcolor{keywordflow}{return} resultWrapper;}
\DoxyCodeLine{130     \}}
\DoxyCodeLine{131   \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{138   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01405_adda3bf7e9e3e6a6bdadab56e5d69a878}{setEASType}}(\textcolor{keywordtype}{int} \mbox{\hyperlink{a01405_adde36207d3eb902dd9a6f7075e991649}{numberOfEASParameters}}) \{}
\DoxyCodeLine{139     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01405_adde36207d3eb902dd9a6f7075e991649}{numberOfEASParameters}} != 0)}
\DoxyCodeLine{140       \mbox{\hyperlink{a01405_a9847b385310a9f6745eb58e4f965d409}{easApplicabilityCheck}}();}
\DoxyCodeLine{141     easVariant\_.setEASType(\mbox{\hyperlink{a01405_adde36207d3eb902dd9a6f7075e991649}{numberOfEASParameters}});}
\DoxyCodeLine{142   \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144 \textcolor{keyword}{protected}:}
\DoxyCodeLine{145   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01405_ab76f2762671562a653fb346e9d4fbe3e}{bindImpl}}() \{}
\DoxyCodeLine{146     assert(underlying().localView().bound());}
\DoxyCodeLine{147     easVariant\_.bind(underlying().localView().element().geometry());}
\DoxyCodeLine{148   \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150 \textcolor{keyword}{public}:}
\DoxyCodeLine{151 \textcolor{keyword}{protected}:}
\DoxyCodeLine{152   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01405_a9847b385310a9f6745eb58e4f965d409}{easApplicabilityCheck}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{153     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numberOfNodes = underlying().numberOfNodes();}
\DoxyCodeLine{154     assert(not(not((numberOfNodes == 4 and \mbox{\hyperlink{a01369_ae15b8efa9f66a3caee81d99dd5c648de}{Traits::mydim}} == 2) or (numberOfNodes == 8 and \mbox{\hyperlink{a01369_ae15b8efa9f66a3caee81d99dd5c648de}{Traits::mydim}} == 3)) and}
\DoxyCodeLine{155                (not \mbox{\hyperlink{a01405_abe6a790acb94dbb3061bbbe64f73b751}{isDisplacementBased}}())) \&\&}
\DoxyCodeLine{156            \textcolor{stringliteral}{"{}EAS only supported for Q1 or H1 elements"{}});}
\DoxyCodeLine{157   \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{160   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01405_a41688f59fef9934faee1209a9c7d46b7}{calculateMatrixImpl}}(}
\DoxyCodeLine{161       \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Requirement}}\& par, \textcolor{keyword}{const} \mbox{\hyperlink{a00360_a390d5311179ec61d163a29c943b3d1a0}{MatrixAffordance}}\& affordance, \textcolor{keyword}{typename} Traits::template MatrixType<> K,}
\DoxyCodeLine{162       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{163     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{164     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00378}{Dune}};}
\DoxyCodeLine{165     \mbox{\hyperlink{a01405_a9847b385310a9f6745eb58e4f965d409}{easApplicabilityCheck}}();}
\DoxyCodeLine{166     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01405_abe6a790acb94dbb3061bbbe64f73b751}{isDisplacementBased}}())}
\DoxyCodeLine{167       \textcolor{keywordflow}{return};}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) LMat = [\textcolor{keyword}{this}]() -\/> \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) \{}
\DoxyCodeLine{170       \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<ScalarType, double>)}
\DoxyCodeLine{171         \textcolor{keywordflow}{return} [\textcolor{keyword}{this}]() -\/> Eigen::MatrixXd\& \{ \textcolor{keywordflow}{return} L\_; \}();}
\DoxyCodeLine{172       \textcolor{keywordflow}{else}}
\DoxyCodeLine{173         \textcolor{keywordflow}{return} Eigen::MatrixX<ScalarType>\{\};}
\DoxyCodeLine{174     \}();}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     \textcolor{keyword}{auto} calculateMatrixContribution = [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{177       \textcolor{keyword}{typename} EAST::DType D;}
\DoxyCodeLine{178       calculateDAndLMatrix(easFunction, par, D, LMat, dx);}
\DoxyCodeLine{179 }
\DoxyCodeLine{180       K.template triangularView<Eigen::Upper>() -\/= LMat.transpose() * D.inverse() * LMat;}
\DoxyCodeLine{181       K.template triangularView<Eigen::StrictlyLower>() = K.transpose();}
\DoxyCodeLine{182     \};}
\DoxyCodeLine{183     easVariant\_(calculateMatrixContribution);}
\DoxyCodeLine{184   \}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{187   \textcolor{keyword}{inline} ScalarType \mbox{\hyperlink{a01405_ae18c38ea736547657bf0dc6a93414d31}{calculateScalarImpl}}(}
\DoxyCodeLine{188       \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Requirement}}\& par, \mbox{\hyperlink{a00360_af6f894084edd9109762b86222995ef2a}{ScalarAffordance}} affordance,}
\DoxyCodeLine{189       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{190     \mbox{\hyperlink{a01405_a9847b385310a9f6745eb58e4f965d409}{easApplicabilityCheck}}();}
\DoxyCodeLine{191     \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01405_abe6a790acb94dbb3061bbbe64f73b751}{isDisplacementBased}}())}
\DoxyCodeLine{192       \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{193     DUNE\_THROW(Dune::NotImplemented,}
\DoxyCodeLine{194                \textcolor{stringliteral}{"{}EAS element do not support any scalar calculations, i.e. they are not derivable from a potential"{}});}
\DoxyCodeLine{195   \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{198   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01405_a9febb77b55a78ae825f8627d2ad1e8c7}{calculateVectorImpl}}(}
\DoxyCodeLine{199       \textcolor{keyword}{const} \mbox{\hyperlink{a01341}{Requirement}}\& par, \mbox{\hyperlink{a00360_aab9e3e38507d1db7602bc750718c302a}{VectorAffordance}} affordance, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{200       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{201     \mbox{\hyperlink{a01405_a9847b385310a9f6745eb58e4f965d409}{easApplicabilityCheck}}();}
\DoxyCodeLine{202     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00378}{Dune}};}
\DoxyCodeLine{203     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{204     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction      = underlying().displacementFunction(par, dx);}
\DoxyCodeLine{205     \textcolor{keyword}{auto} strainFunction       = underlying().strainFunction(par, dx);}
\DoxyCodeLine{206     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& numberOfNodes = underlying().numberOfNodes();}
\DoxyCodeLine{207 }
\DoxyCodeLine{208     \textcolor{keyword}{auto} calculateForceContribution = [\&]<\textcolor{keyword}{typename} EAST>(\textcolor{keyword}{const} EAST\& easFunction) \{}
\DoxyCodeLine{209       \textcolor{keyword}{typename} EAST::DType D;}
\DoxyCodeLine{210       calculateDAndLMatrix(easFunction, par, D, L\_);}
\DoxyCodeLine{211 }
\DoxyCodeLine{212       \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) LMat = [\textcolor{keyword}{this}]() -\/> \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) \{}
\DoxyCodeLine{213         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<ScalarType, double>)}
\DoxyCodeLine{214           \textcolor{keywordflow}{return} [\textcolor{keyword}{this}]() -\/> Eigen::MatrixXd\& \{ \textcolor{keywordflow}{return} L\_; \}();}
\DoxyCodeLine{215         \textcolor{keywordflow}{else}}
\DoxyCodeLine{216           \textcolor{keywordflow}{return} Eigen::MatrixX<ScalarType>\{\};}
\DoxyCodeLine{217       \}();}
\DoxyCodeLine{218       \textcolor{keyword}{const} \textcolor{keyword}{auto} disp  = \mbox{\hyperlink{a00355_ga545d74839895f4576a3b8c97d72abefd}{Dune::viewAsFlatEigenVector}}(uFunction.coefficientsRef());}
\DoxyCodeLine{219       \textcolor{keyword}{const} \textcolor{keyword}{auto} alpha = (-\/D.inverse() * L\_ * disp).eval();}
\DoxyCodeLine{220       \textcolor{keyword}{const} \textcolor{keyword}{auto} geo   = underlying().localView().element().geometry();}
\DoxyCodeLine{221       \textcolor{keyword}{auto} C           = underlying().materialTangentFunction(par);}
\DoxyCodeLine{222 }
\DoxyCodeLine{223       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{224         \textcolor{keyword}{const} \textcolor{keyword}{auto} M            = easFunction.calcM(gp.position());}
\DoxyCodeLine{225         \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{226         \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval        = C(gpIndex);}
\DoxyCodeLine{227         \textcolor{keyword}{auto} stresses           = (CEval * M * alpha).eval();}
\DoxyCodeLine{228         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes; ++i) \{}
\DoxyCodeLine{229           \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{230           force.template segment<Traits::worlddim>(\mbox{\hyperlink{a01369_a5d611e1d48285bac5c5ebd6fda9c7cc7}{Traits::worlddim}} * i) += bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{231         \}}
\DoxyCodeLine{232       \}}
\DoxyCodeLine{233     \};}
\DoxyCodeLine{234     easVariant\_(calculateForceContribution);}
\DoxyCodeLine{235   \}}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 \textcolor{keyword}{private}:}
\DoxyCodeLine{238   EAS::Impl::EASVariant<Geometry> easVariant\_;}
\DoxyCodeLine{239   \textcolor{keyword}{mutable} Eigen::MatrixXd L\_;}
\DoxyCodeLine{240 }
\DoxyCodeLine{241   \textcolor{comment}{//> CRTP}}
\DoxyCodeLine{242   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& underlying()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\mbox{\hyperlink{a01309}{FE}}\&\textcolor{keyword}{>}(*this); \}}
\DoxyCodeLine{243   \textcolor{keyword}{auto}\& underlying() \{ \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}FE\&\textcolor{keyword}{>}(*this); \}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType, \textcolor{keywordtype}{int} enhancedStrainSize>}
\DoxyCodeLine{246   \textcolor{keywordtype}{void} calculateDAndLMatrix(}
\DoxyCodeLine{247       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& easFunction, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& par, Eigen::Matrix<double, enhancedStrainSize, enhancedStrainSize>\& DMat,}
\DoxyCodeLine{248       Eigen::MatrixX<ScalarType>\& LMat,}
\DoxyCodeLine{249       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{250     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00378}{Dune}};}
\DoxyCodeLine{251     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{252 }
\DoxyCodeLine{253     \textcolor{keyword}{auto} strainFunction      = underlying().strainFunction(par, dx);}
\DoxyCodeLine{254     \textcolor{keyword}{const} \textcolor{keyword}{auto} C             = underlying().materialTangentFunction(par);}
\DoxyCodeLine{255     \textcolor{keyword}{const} \textcolor{keyword}{auto} geo           = underlying().localView().element().geometry();}
\DoxyCodeLine{256     \textcolor{keyword}{const} \textcolor{keyword}{auto} numberOfNodes = underlying().numberOfNodes();}
\DoxyCodeLine{257     DMat.setZero();}
\DoxyCodeLine{258     LMat.setZero(enhancedStrainSize, underlying().localView().size());}
\DoxyCodeLine{259     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : strainFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{260       \textcolor{keyword}{const} \textcolor{keyword}{auto} M            = easFunction.calcM(gp.position());}
\DoxyCodeLine{261       \textcolor{keyword}{const} \textcolor{keyword}{auto} CEval        = C(gpIndex);}
\DoxyCodeLine{262       \textcolor{keyword}{const} \textcolor{keywordtype}{double} detJTimesW = geo.integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{263       DMat += M.transpose() * CEval * M * detJTimesW;}
\DoxyCodeLine{264       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0U; i < numberOfNodes; ++i) \{}
\DoxyCodeLine{265         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} I = \mbox{\hyperlink{a01369_a5d611e1d48285bac5c5ebd6fda9c7cc7}{Traits::worlddim}} * i;}
\DoxyCodeLine{266         \textcolor{keyword}{const} \textcolor{keyword}{auto} Bi  = strainFunction.evaluateDerivative(gpIndex, wrt(coeff(i)), on(gridElement));}
\DoxyCodeLine{267         LMat.template block<enhancedStrainSize, Traits::worlddim>(0, I) += M.transpose() * CEval * Bi * detJTimesW;}
\DoxyCodeLine{268       \}}
\DoxyCodeLine{269     \}}
\DoxyCodeLine{270   \}}
\DoxyCodeLine{271 \};}
\DoxyCodeLine{272 }
\DoxyCodeLine{278 \textcolor{keyword}{auto} \mbox{\hyperlink{a00360_a95d330fd032b3ed38354e893a814d33a}{eas}}(\textcolor{keywordtype}{int} numberOfEASParameters = 0) \{}
\DoxyCodeLine{279   \mbox{\hyperlink{a01409}{EnhancedAssumedStrainsPre}} pre(numberOfEASParameters);}
\DoxyCodeLine{280 }
\DoxyCodeLine{281   \textcolor{keywordflow}{return} pre;}
\DoxyCodeLine{282 \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284 \} \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{285 }
\DoxyCodeLine{286 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{287 \textcolor{preprocessor}{  \#error EnhancedAssumedStrains depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{288 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
