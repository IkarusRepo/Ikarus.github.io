\hypertarget{a02512_source}{}\doxysection{finiteelements/mechanics/loads/traction.hh}
\label{a02512_source}\index{traction.hh@{traction.hh}}
\mbox{\hyperlink{a02512}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <dune/localfefunctions/derivativetransformators.hh>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <dune/localfefunctions/meta.hh>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00125}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00337}{Ikarus}} \{}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{15 \textcolor{keyword}{class }Traction;}
\DoxyCodeLine{16 }
\DoxyCodeLine{21 \textcolor{keyword}{template} <\textcolor{keyword}{typename} GV>}
\DoxyCodeLine{22 \textcolor{keyword}{struct }\mbox{\hyperlink{a01373}{NeumannBoundaryLoadPre}}}
\DoxyCodeLine{23 \{}
\DoxyCodeLine{24   \textcolor{keyword}{using }\mbox{\hyperlink{a01373_a57f15a0941a7f2f5cd9be9365b07cc62}{GridView}}                = GV;}
\DoxyCodeLine{25   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01373_a30ab2377a70a599a759395ddbe87c162}{worldDim}} = GridView::dimensionworld;}
\DoxyCodeLine{26   \textcolor{keyword}{const} BoundaryPatch<GridView>* \mbox{\hyperlink{a01373_a7041712ee512583c44a163cafc33787f}{neumannBoundary}};}
\DoxyCodeLine{27 }
\DoxyCodeLine{28   std::function<Eigen::Vector<double, worldDim>(\textcolor{keyword}{const} \mbox{\hyperlink{a01573}{Dune::FieldVector<double, worldDim>}}\&, \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)> \mbox{\hyperlink{a01373_abcca43aca1a4a4bcad580991d79b80e9}{load}};}
\DoxyCodeLine{29   \textcolor{keyword}{using }\mbox{\hyperlink{a01373_ab141e7f54614dccc0924c0bf678760d4}{BoundaryPatchType}} = BoundaryPatch<GridView>;}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{32   \textcolor{keyword}{using }\mbox{\hyperlink{a01369}{Skill}} = \mbox{\hyperlink{a01369}{Traction<PreFE, FE>}};}
\DoxyCodeLine{33 \};}
\DoxyCodeLine{34 }
\DoxyCodeLine{43 \textcolor{keyword}{template} <\textcolor{keyword}{typename} PreFE, \textcolor{keyword}{typename} FE>}
\DoxyCodeLine{44 \textcolor{keyword}{class }\mbox{\hyperlink{a01369}{Traction}}}
\DoxyCodeLine{45 \{}
\DoxyCodeLine{46 \textcolor{keyword}{public}:}
\DoxyCodeLine{47   \textcolor{keyword}{using }\mbox{\hyperlink{a01301}{Traits}}                  = \mbox{\hyperlink{a01245_a9d8e27b97d32f23d3f27b43d67719712}{PreFE::Traits}};}
\DoxyCodeLine{48   \textcolor{keyword}{using }\mbox{\hyperlink{a01369_a35959929b4a5e33f1e429c2bf5bcc10a}{FERequirementType}}       = \textcolor{keyword}{typename} \mbox{\hyperlink{a01301_a07ae507e77464265d631a82eea32e45a}{Traits::FERequirementType}};}
\DoxyCodeLine{49   \textcolor{keyword}{using }\mbox{\hyperlink{a01369_a16ae410689450d27c7fe33618c65eff5}{LocalView}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01301_a247c2f275ba82e1c6b73b157c00213c3}{Traits::LocalView}};}
\DoxyCodeLine{50   \textcolor{keyword}{using }\mbox{\hyperlink{a01369_a1ad8822c3690b4d9b7fa07998d581551}{GridView}}                = \textcolor{keyword}{typename} \mbox{\hyperlink{a01301_a4fe2f4314ca474f96a539dad1dd881e7}{Traits::GridView}};}
\DoxyCodeLine{51   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01369_a9867415553291c23807ce946f1e33b2f}{myDim}}    = \mbox{\hyperlink{a01301_ac9913312b3916225484a0e7125e4f94a}{Traits::mydim}};}
\DoxyCodeLine{52   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01369_aae1169ffc7dc4ba675566010710a6bd1}{worldDim}} = \mbox{\hyperlink{a01301_aa72f0d4219850668dc72117052455aca}{Traits::worlddim}};}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01373}{Pre}}                     = \mbox{\hyperlink{a01373}{NeumannBoundaryLoadPre<GridView>}};}
\DoxyCodeLine{54 }
\DoxyCodeLine{60   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01369_ae5de3515f363e3e48877175fe53cdb27}{Traction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01373}{Pre}}\& pre)}
\DoxyCodeLine{61       : neumannBoundaryLoad\_\{pre.load\},}
\DoxyCodeLine{62         neumannBoundary\_\{pre.neumannBoundary\} \{\}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{keyword}{protected}:}
\DoxyCodeLine{65   \textcolor{keyword}{template} <\textcolor{keyword}{template} <\textcolor{keyword}{typename}, \textcolor{keywordtype}{int}, \textcolor{keywordtype}{int}> \textcolor{keyword}{class }RT>}
\DoxyCodeLine{66   \textcolor{keyword}{requires} Dune::AlwaysFalse<RT<double, 1, 1>>::value}
\DoxyCodeLine{67   \textcolor{keyword}{auto} \mbox{\hyperlink{a01369_a0282a6c41eeb638ee2063328ddd65199}{calculateAtImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01369_a35959929b4a5e33f1e429c2bf5bcc10a}{FERequirementType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01573}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{68                        Dune::PriorityTag<0>)\textcolor{keyword}{ const }\{\}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST>}
\DoxyCodeLine{71   \textcolor{keyword}{auto} \mbox{\hyperlink{a01369_a1070b97f125444541d4fe00be9a580f7}{calculateScalarImpl}}(}
\DoxyCodeLine{72       \textcolor{keyword}{const} \mbox{\hyperlink{a01369_a35959929b4a5e33f1e429c2bf5bcc10a}{FERequirementType}}\& par,}
\DoxyCodeLine{73       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ST>>>\& dx = std::nullopt) \textcolor{keyword}{const} -\/> ST \{}
\DoxyCodeLine{74     \textcolor{keywordflow}{if} (not neumannBoundary\_ and not neumannBoundaryLoad\_)}
\DoxyCodeLine{75       \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{76     ST energy            = 0.0;}
\DoxyCodeLine{77     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = underlying().displacementFunction(par, dx);}
\DoxyCodeLine{78     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00324_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{79     \textcolor{keyword}{auto}\& element        = underlying().localView().element();}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& intersection : intersections(neumannBoundary\_-\/>gridView(), element)) \{}
\DoxyCodeLine{82       \textcolor{keywordflow}{if} (not neumannBoundary\_-\/>contains(intersection))}
\DoxyCodeLine{83         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& quadLine = Dune::QuadratureRules<double, myDim -\/ 1>::rule(intersection.type(), underlying().order());}
\DoxyCodeLine{86 }
\DoxyCodeLine{87       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& curQuad : quadLine) \{}
\DoxyCodeLine{88         \textcolor{comment}{// Local position of the quadrature point}}
\DoxyCodeLine{89         \textcolor{keyword}{const} \mbox{\hyperlink{a01573}{Dune::FieldVector<double, myDim>}}\& quadPos = intersection.geometryInInside().global(curQuad.position());}
\DoxyCodeLine{90 }
\DoxyCodeLine{91         \textcolor{keyword}{const} \textcolor{keywordtype}{double} integrationElement = intersection.geometry().integrationElement(curQuad.position());}
\DoxyCodeLine{92 }
\DoxyCodeLine{93         \textcolor{comment}{// The value of the local function}}
\DoxyCodeLine{94         \textcolor{keyword}{const} \textcolor{keyword}{auto} uVal = uFunction.evaluate(quadPos);}
\DoxyCodeLine{95 }
\DoxyCodeLine{96         \textcolor{comment}{// Value of the Neumann data at the current position}}
\DoxyCodeLine{97         \textcolor{keyword}{auto} neumannValue = neumannBoundaryLoad\_(intersection.geometry().global(curQuad.position()), lambda);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99         energy -\/= neumannValue.dot(uVal) * curQuad.weight() * integrationElement;}
\DoxyCodeLine{100       \}}
\DoxyCodeLine{101     \}}
\DoxyCodeLine{102     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{103   \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST>}
\DoxyCodeLine{106   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01369_a9701dfbcfcf15a8fccaa1b2b695b522f}{calculateVectorImpl}}(}
\DoxyCodeLine{107       \textcolor{keyword}{const} \mbox{\hyperlink{a01369_a35959929b4a5e33f1e429c2bf5bcc10a}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ST> force,}
\DoxyCodeLine{108       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ST>>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{109     \textcolor{keywordflow}{if} (not neumannBoundary\_ and not neumannBoundaryLoad\_)}
\DoxyCodeLine{110       \textcolor{keywordflow}{return};}
\DoxyCodeLine{111     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{112     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00354}{Dune}};}
\DoxyCodeLine{113     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = underlying().displacementFunction(par, dx);}
\DoxyCodeLine{114     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00324_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{115     \textcolor{keyword}{auto}\& element        = underlying().localView().element();}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\&\& intersection : intersections(neumannBoundary\_-\/>gridView(), element)) \{}
\DoxyCodeLine{118       \textcolor{keywordflow}{if} (not neumannBoundary\_-\/>contains(intersection))}
\DoxyCodeLine{119         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{120 }
\DoxyCodeLine{122       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& quadLine = Dune::QuadratureRules<double, myDim -\/ 1>::rule(intersection.type(), underlying().order());}
\DoxyCodeLine{123 }
\DoxyCodeLine{124       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& curQuad : quadLine) \{}
\DoxyCodeLine{125         \textcolor{keyword}{const} \mbox{\hyperlink{a01573}{Dune::FieldVector<double, myDim>}}\& quadPos = intersection.geometryInInside().global(curQuad.position());}
\DoxyCodeLine{126         \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = intersection.geometry().integrationElement(curQuad.position());}
\DoxyCodeLine{127 }
\DoxyCodeLine{129         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < underlying().numberOfNodes(); ++i) \{}
\DoxyCodeLine{130           \textcolor{keyword}{const} \textcolor{keyword}{auto} udCi = uFunction.evaluateDerivative(quadPos, wrt(coeff(i)));}
\DoxyCodeLine{131 }
\DoxyCodeLine{133           \textcolor{keyword}{auto} neumannValue = neumannBoundaryLoad\_(intersection.geometry().global(curQuad.position()), lambda);}
\DoxyCodeLine{134           force.template segment<worldDim>(\mbox{\hyperlink{a01369_aae1169ffc7dc4ba675566010710a6bd1}{worldDim}} * i) -\/= udCi * neumannValue * curQuad.weight() * intElement;}
\DoxyCodeLine{135         \}}
\DoxyCodeLine{136       \}}
\DoxyCodeLine{137     \}}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST>}
\DoxyCodeLine{141   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01369_a2076811a781653c669a0f2bfb7f5c9bc}{calculateMatrixImpl}}(}
\DoxyCodeLine{142       \textcolor{keyword}{const} \mbox{\hyperlink{a01369_a35959929b4a5e33f1e429c2bf5bcc10a}{FERequirementType}}\&, \textcolor{keyword}{typename} Traits::template MatrixType<>,}
\DoxyCodeLine{143       \textcolor{keyword}{const} std::optional<std::reference\_wrapper<\textcolor{keyword}{const} Eigen::VectorX<ST>>>\& = std::nullopt)\textcolor{keyword}{ const }\{\}}
\DoxyCodeLine{144 }
\DoxyCodeLine{145 \textcolor{keyword}{private}:}
\DoxyCodeLine{146   std::function<Eigen::Vector<double, worldDim>(\textcolor{keyword}{const} \mbox{\hyperlink{a01573}{Dune::FieldVector<double, worldDim>}}\&, \textcolor{keyword}{const} \textcolor{keywordtype}{double}\&)>}
\DoxyCodeLine{147       neumannBoundaryLoad\_;}
\DoxyCodeLine{148   \textcolor{keyword}{const} BoundaryPatch<GridView>* neumannBoundary\_;}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   \textcolor{comment}{//> CRTP}}
\DoxyCodeLine{151   \textcolor{keyword}{const} \textcolor{keyword}{auto}\& underlying()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\mbox{\hyperlink{a01241}{FE}}\&\textcolor{keyword}{>}(*this); \}}
\DoxyCodeLine{152   \textcolor{keyword}{auto}\& underlying() \{ \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}FE\&\textcolor{keyword}{>}(*this); \}}
\DoxyCodeLine{153 \};}
\DoxyCodeLine{154 }
\DoxyCodeLine{163 \textcolor{keyword}{template} <\textcolor{keyword}{typename} GV, \textcolor{keyword}{typename} F>}
\DoxyCodeLine{164 \textcolor{keyword}{auto} \mbox{\hyperlink{a00337_ac2ae666c1ffd22e3c22a3418ab390893}{neumannBoundaryLoad}}(\textcolor{keyword}{const} BoundaryPatch<GV>* patch, F\&\& load) \{}
\DoxyCodeLine{165   \mbox{\hyperlink{a01373}{NeumannBoundaryLoadPre<GV>}} pre(patch, std::forward<F>(load));}
\DoxyCodeLine{166 }
\DoxyCodeLine{167   \textcolor{keywordflow}{return} pre;}
\DoxyCodeLine{168 \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \} \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
