\hypertarget{a02497_source}{}\doxysection{finiteelements/mechanics/nonlinearelastic.hh}
\label{a02497_source}\index{nonlinearelastic.hh@{nonlinearelastic.hh}}
\mbox{\hyperlink{a02497}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#if HAVE\_DUNE\_LOCALFEFUNCTIONS}}
\DoxyCodeLine{13 \textcolor{preprocessor}{  \#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{  \#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{  \#include <dune/geometry/type.hh>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{  \#include <dune/localfefunctions/cachedlocalBasis/cachedlocalBasis.hh>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{  \#include <dune/localfefunctions/expressions/greenLagrangeStrains.hh>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{  \#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{  \#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00119}{ikarus/finiteelements/febase.hh}}>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00131}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00122}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00194}{ikarus/finiteelements/mechanics/loads.hh}}>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00164}{ikarus/finiteelements/mechanics/materials/tags.hh}}>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00116}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00011}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00062}{ikarus/utils/eigendunetransformations.hh}}>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{  \#include <\mbox{\hyperlink{a00065}{ikarus/utils/linearalgebrahelper.hh}}>}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00328}{Ikarus}} \{}
\DoxyCodeLine{32 }
\DoxyCodeLine{44 \textcolor{keyword}{template} <\textcolor{keyword}{typename} BH, \textcolor{keyword}{typename} MAT, \textcolor{keyword}{typename} FER = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false, \textcolor{keywordtype}{bool} useFlat = true>}
\DoxyCodeLine{45 \textcolor{keyword}{class }\mbox{\hyperlink{a01368}{NonLinearElastic}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01232}{FEBase}}<BH, useFlat, FER, useEigenRef>,}
\DoxyCodeLine{46                          \textcolor{keyword}{public} \mbox{\hyperlink{a01336}{Volume}}<NonLinearElastic<BH, MAT, FER, useEigenRef, useFlat>,}
\DoxyCodeLine{47                                        typename FEBase<BH, useFlat, FER, useEigenRef>::Traits>,}
\DoxyCodeLine{48                          \textcolor{keyword}{public} \mbox{\hyperlink{a01332}{Traction}}<NonLinearElastic<BH, MAT, FER, useEigenRef, useFlat>,}
\DoxyCodeLine{49                                          typename FEBase<BH, useFlat, FER, useEigenRef>::Traits>}
\DoxyCodeLine{50 \{}
\DoxyCodeLine{51 \textcolor{keyword}{public}:}
\DoxyCodeLine{52   \textcolor{keyword}{using }\mbox{\hyperlink{a01232}{Base}}              = \mbox{\hyperlink{a01232}{FEBase<BH, useFlat, FER, useEigenRef>}};}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a293a865db44f89553252be2da32c9991}{Traits}}            = \textcolor{keyword}{typename} \mbox{\hyperlink{a01232_ac5fdc9a8e9d4a7d670df89d397129588}{Base::Traits}};}
\DoxyCodeLine{54   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_ac05c4360f5191ebb97b85998db6199f2}{BasisHandler}}      = \textcolor{keyword}{typename} Traits::BasisHandler;}
\DoxyCodeLine{55   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a382567a9fe4fac11bbdd1f12063a14d9}{FlatBasis}}         = \textcolor{keyword}{typename} Traits::FlatBasis;}
\DoxyCodeLine{56   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}} = \textcolor{keyword}{typename} Traits::FERequirementType;}
\DoxyCodeLine{57   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_ae23978873c7c62b0448e26fd3414cb3c}{LocalView}}         = \textcolor{keyword}{typename} Traits::LocalView;}
\DoxyCodeLine{58   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_af86286299b4ce7b9477d22a03c2f4704}{Geometry}}          = \textcolor{keyword}{typename} Traits::Geometry;}
\DoxyCodeLine{59   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a28d423c3e7f434b7d776a3e3e4d498d4}{GridView}}          = \textcolor{keyword}{typename} Traits::GridView;}
\DoxyCodeLine{60   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_aa63c4e031affd156566457d226a4a083}{Element}}           = \textcolor{keyword}{typename} Traits::Element;}
\DoxyCodeLine{61   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a55d99c371dc949e4c00324bcd5ddecfd}{Material}}          = MAT;}
\DoxyCodeLine{62   \textcolor{keyword}{using }\mbox{\hyperlink{a01336}{VolumeType}}        = \mbox{\hyperlink{a01336}{Volume<NonLinearElastic, Traits>}};}
\DoxyCodeLine{63   \textcolor{keyword}{using }\mbox{\hyperlink{a01332}{TractionType}}      = \mbox{\hyperlink{a01332}{Traction<NonLinearElastic, Traits>}};}
\DoxyCodeLine{64   \textcolor{keyword}{using }\mbox{\hyperlink{a01368_a20937b8d29dbe3903394a284723b6c32}{LocalBasisType}}    = \textcolor{keyword}{decltype}(std::declval<LocalView>().tree().child(0).finiteElement().localBasis());}
\DoxyCodeLine{65 }
\DoxyCodeLine{66   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01368_ab7c8d3171e7b10131419a284feefe4aa}{myDim}}       = Traits::mydim;}
\DoxyCodeLine{67   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a2ba2ed5c7258875dfa2083e401f7bd49}{strainType}} = \mbox{\hyperlink{a00317_ggacef1e451de1a99845c59d7391064fb8faca3f1e4bb21fd00a3d29c5d8aff8e11e}{StrainTags::greenLagrangian}};}
\DoxyCodeLine{68 }
\DoxyCodeLine{81   \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{82   \mbox{\hyperlink{a01368_a3c87434ce03f479f107cd93ace1a7da5}{NonLinearElastic}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_ac05c4360f5191ebb97b85998db6199f2}{BasisHandler}}\& basisHandler, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keyword}{const} \mbox{\hyperlink{a01368_a55d99c371dc949e4c00324bcd5ddecfd}{Material}}\& mat,}
\DoxyCodeLine{83                    VolumeLoad volumeLoad = \{\}, \textcolor{keyword}{const} BoundaryPatch<GridView>* neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{84                    NeumannBoundaryLoad neumannBoundaryLoad = \{\})}
\DoxyCodeLine{85       : \mbox{\hyperlink{a01368_ac4658a7b0a61bc6aeedbbc82544f0d45}{Base}}(basisHandler, element),}
\DoxyCodeLine{86         \mbox{\hyperlink{a01368_ac482d71948b655196ad06dc23d57a467}{VolumeType}}(volumeLoad),}
\DoxyCodeLine{87         \mbox{\hyperlink{a01368_aeae332fb38224eaa5c8ed1d8c79e4532}{TractionType}}(neumannBoundary, neumannBoundaryLoad),}
\DoxyCodeLine{88         mat\_\{mat\} \{}
\DoxyCodeLine{89     \textcolor{keyword}{auto}\& firstChild = this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().tree().child(0);}
\DoxyCodeLine{90     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe   = firstChild.finiteElement();}
\DoxyCodeLine{91     geo\_             = std::make\_shared<const Geometry>(this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().\mbox{\hyperlink{a01368_a7d4ce3528b602e8573133440036dd058}{geometry}}());}
\DoxyCodeLine{92     numberOfNodes\_   = fe.size();}
\DoxyCodeLine{93     order\_           = 2 * (fe.localBasis().order());}
\DoxyCodeLine{94     localBasis\_      = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{95     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().impl().getQuadratureRule(order\_); \})}
\DoxyCodeLine{96       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{97         localBasis\_.bind(this-\/>localView().element().impl().getQuadratureRule(order\_), Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{98       \textcolor{keywordflow}{else}}
\DoxyCodeLine{99         localBasis\_.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().type(), order\_),}
\DoxyCodeLine{100                          Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{101     \textcolor{keywordflow}{else}}
\DoxyCodeLine{102       localBasis\_.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}().element().type(), order\_),}
\DoxyCodeLine{103                        Dune::bindDerivatives(0, 1));}
\DoxyCodeLine{104   \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{114   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{115   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_ae22f726fd67e4e7f1853b21fbbadff64}{displacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par,}
\DoxyCodeLine{116                             \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{117     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00315_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{118     \textcolor{keyword}{auto} disp     = Ikarus::FEHelper::localSolutionBlockVector<Traits>(d, this-\/>\mbox{\hyperlink{a01232_a53a30773e643a5bc8709ae74a2ba68d3}{localView}}(), dx);}
\DoxyCodeLine{119     Dune::StandardLocalFunction uFunction(localBasis\_, disp, geo\_);}
\DoxyCodeLine{120     \textcolor{keywordflow}{return} uFunction;}
\DoxyCodeLine{121   \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{131   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{132   \textcolor{keyword}{inline} \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a30a59eb29567415909f3d6165ebf26d1}{strainFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par,}
\DoxyCodeLine{133                              \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{134     \textcolor{keywordflow}{return} Dune::greenLagrangeStrains(\mbox{\hyperlink{a01368_ae22f726fd67e4e7f1853b21fbbadff64}{displacementFunction}}(par, dx));}
\DoxyCodeLine{135   \}}
\DoxyCodeLine{136 }
\DoxyCodeLine{146   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType, \textcolor{keywordtype}{int} strainDim, \textcolor{keywordtype}{bool} voigt = true>}
\DoxyCodeLine{147   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a25330e501f19feb4a91821464e3bbbee}{materialTangent}}(\textcolor{keyword}{const} Eigen::Vector<ScalarType, strainDim>\& strain)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{148     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<ScalarType, double>)}
\DoxyCodeLine{149       \textcolor{keywordflow}{return} mat\_.template tangentModuli<strainType, voigt>(strain);}
\DoxyCodeLine{150     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{151       \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) matAD = mat\_.template rebind<ScalarType>();}
\DoxyCodeLine{152       \textcolor{keywordflow}{return} matAD.template tangentModuli<strainType, voigt>(strain);}
\DoxyCodeLine{153     \}}
\DoxyCodeLine{154   \}}
\DoxyCodeLine{155 }
\DoxyCodeLine{164   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType, \textcolor{keywordtype}{int} strainDim>}
\DoxyCodeLine{165   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a8907a656052a2353c2e5dc8d6e477bd9}{getInternalEnergy}}(\textcolor{keyword}{const} Eigen::Vector<ScalarType, strainDim>\& strain)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{166     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<ScalarType, double>)}
\DoxyCodeLine{167       \textcolor{keywordflow}{return} mat\_.template storedEnergy<strainType>(strain);}
\DoxyCodeLine{168     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{169       \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) matAD = mat\_.template rebind<ScalarType>();}
\DoxyCodeLine{170       \textcolor{keywordflow}{return} matAD.template storedEnergy<strainType>(strain);}
\DoxyCodeLine{171     \}}
\DoxyCodeLine{172   \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{183   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType, \textcolor{keywordtype}{int} strainDim, \textcolor{keywordtype}{bool} voigt = true>}
\DoxyCodeLine{184   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a58c79c2893de7f39b999e315f573b5f4}{getStress}}(\textcolor{keyword}{const} Eigen::Vector<ScalarType, strainDim>\& strain)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{185     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (std::is\_same\_v<ScalarType, double>)}
\DoxyCodeLine{186       \textcolor{keywordflow}{return} mat\_.template stresses<strainType, voigt>(strain);}
\DoxyCodeLine{187     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{188       \textcolor{keyword}{decltype}(\textcolor{keyword}{auto}) matAD = mat\_.template rebind<ScalarType>();}
\DoxyCodeLine{189       \textcolor{keywordflow}{return} matAD.template stresses<strainType, voigt>(strain);}
\DoxyCodeLine{190     \}}
\DoxyCodeLine{191   \}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193   \textcolor{keyword}{const} \mbox{\hyperlink{a01368_af86286299b4ce7b9477d22a03c2f4704}{Geometry}}\& \mbox{\hyperlink{a01368_a7d4ce3528b602e8573133440036dd058}{geometry}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} *geo\_; \}}
\DoxyCodeLine{194   [[nodiscard]] \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01368_a5830d0db414b3fe1281a26a481e8925d}{numberOfNodes}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} numberOfNodes\_; \}}
\DoxyCodeLine{195   [[nodiscard]] \textcolor{keywordtype}{int} \mbox{\hyperlink{a01368_a4c9deac8c315fcaf9b8bb9de89e46da0}{order}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} order\_; \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{204   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01368_a674d61a7bf20d02f3fb0159cba90d1f4}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(par); \}}
\DoxyCodeLine{205 }
\DoxyCodeLine{213   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01368_ac0ebe847656a00b730d6df67d0eb4b3a}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{214     calculateVectorImpl<double>(par, force);}
\DoxyCodeLine{215   \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{224   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01368_abe95aba4255becb35502caaa4442063c}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{225     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{226     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00345}{Dune}};}
\DoxyCodeLine{227     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01368_a30a59eb29567415909f3d6165ebf26d1}{strainFunction}}(par);}
\DoxyCodeLine{228     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{229       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{230       \textcolor{keyword}{const} \textcolor{keyword}{auto} EVoigt       = (eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}))).eval();}
\DoxyCodeLine{231       \textcolor{keyword}{const} \textcolor{keyword}{auto} C            = \mbox{\hyperlink{a01368_a25330e501f19feb4a91821464e3bbbee}{materialTangent}}(EVoigt);}
\DoxyCodeLine{232       \textcolor{keyword}{const} \textcolor{keyword}{auto} stresses     = \mbox{\hyperlink{a01368_a58c79c2893de7f39b999e315f573b5f4}{getStress}}(EVoigt);}
\DoxyCodeLine{233       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{234         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{235         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < numberOfNodes\_; ++j) \{}
\DoxyCodeLine{236           \textcolor{keyword}{const} \textcolor{keyword}{auto} bopJ = eps.evaluateDerivative(gpIndex, wrt(coeff(j)), on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{237           \textcolor{keyword}{const} \textcolor{keyword}{auto} kgIJ = eps.evaluateDerivative(gpIndex, wrt(coeff(i, j)), along(stresses), on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{238           K.template block<myDim, myDim>(i * \mbox{\hyperlink{a01368_ab7c8d3171e7b10131419a284feefe4aa}{myDim}}, j * \mbox{\hyperlink{a01368_ab7c8d3171e7b10131419a284feefe4aa}{myDim}}) += (bopI.transpose() * C * bopJ + kgIJ) * intElement;}
\DoxyCodeLine{239         \}}
\DoxyCodeLine{240       \}}
\DoxyCodeLine{241     \}}
\DoxyCodeLine{242 }
\DoxyCodeLine{243     \textcolor{comment}{// Update due to displacement-\/dependent external loads, e.g., follower loads}}
\DoxyCodeLine{244     \mbox{\hyperlink{a01336_a50c6859b6c9a40fbb8ac9cc77d8087db}{VolumeType::calculateMatrix}}(par, K);}
\DoxyCodeLine{245     \mbox{\hyperlink{a01332_aa4336b55618b836ca7b2b3aebf4242bf}{TractionType::calculateMatrix}}(par, K);}
\DoxyCodeLine{246   \}}
\DoxyCodeLine{247 }
\DoxyCodeLine{253   \textcolor{keyword}{template} <\textcolor{keyword}{template} <\textcolor{keyword}{typename}, \textcolor{keywordtype}{int}, \textcolor{keywordtype}{int}> \textcolor{keyword}{class }RT>}
\DoxyCodeLine{254   \textcolor{keyword}{static} \textcolor{keyword}{consteval} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01368_afca103d2265225fda2aed2f0e81752f0}{canProvideResultType}}() \{}
\DoxyCodeLine{255     \textcolor{keywordflow}{return} isSameResultType<RT, ResultType::PK2Stress>;}
\DoxyCodeLine{256   \}}
\DoxyCodeLine{257 }
\DoxyCodeLine{267   \textcolor{keyword}{template} <\textcolor{keyword}{template} <\textcolor{keyword}{typename}, \textcolor{keywordtype}{int}, \textcolor{keywordtype}{int}> \textcolor{keyword}{class }RT>}
\DoxyCodeLine{268   \textcolor{keyword}{requires}(canProvideResultType<RT>())}
\DoxyCodeLine{269   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_a494e4dcdb1f53f01eeecb44500020f4c}{calculateAt}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& req, \textcolor{keyword}{const} \mbox{\hyperlink{a01520}{Dune::FieldVector<double, Traits::mydim>}}\& local) \textcolor{keyword}{const} \{}
\DoxyCodeLine{270     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{271 }
\DoxyCodeLine{272     \textcolor{keyword}{using }RTWrapper = \mbox{\hyperlink{a01276}{ResultWrapper<RT<typename Traits::ctype, myDim, Traits::worlddim>}}, \mbox{\hyperlink{a00328_acfb09bb7db104db62d3d1d2dc3e009b2a57dea6f5039281b7fee517fc43bf3110}{ResultShape::Vector}}>;}
\DoxyCodeLine{273     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (isSameResultType<RT, ResultType::PK2Stress>) \{}
\DoxyCodeLine{274       \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01368_ae22f726fd67e4e7f1853b21fbbadff64}{displacementFunction}}(req);}
\DoxyCodeLine{275       \textcolor{keyword}{const} \textcolor{keyword}{auto} H         = uFunction.evaluateDerivative(local, Dune::wrt(spatialAll), Dune::on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{276       \textcolor{keyword}{const} \textcolor{keyword}{auto} E         = (0.5 * (H.transpose() + H + H.transpose() * H)).eval();}
\DoxyCodeLine{277 }
\DoxyCodeLine{278       \textcolor{keywordflow}{return} RTWrapper\{mat\_.template stresses<StrainTags::greenLagrangian>(\mbox{\hyperlink{a00324_ga4304655095296ce9283e012587817a51}{toVoigt}}(E))\};}
\DoxyCodeLine{279     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{280       \textcolor{keyword}{static\_assert}(Dune::AlwaysFalse<BH>::value, \textcolor{stringliteral}{"{}The requested result type is NOT implemented."{}});}
\DoxyCodeLine{281   \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283 \textcolor{keyword}{private}:}
\DoxyCodeLine{284   std::shared\_ptr<const Geometry> geo\_;}
\DoxyCodeLine{285   Dune::CachedLocalBasis<std::remove\_cvref\_t<LocalBasisType>> localBasis\_;}
\DoxyCodeLine{286   \mbox{\hyperlink{a01340}{Material}} mat\_;}
\DoxyCodeLine{287   \textcolor{keywordtype}{size\_t} numberOfNodes\_\{0\};}
\DoxyCodeLine{288   \textcolor{keywordtype}{int} order\_\{\};}
\DoxyCodeLine{289 }
\DoxyCodeLine{290 \textcolor{keyword}{protected}:}
\DoxyCodeLine{291   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{292   \textcolor{keyword}{auto} \mbox{\hyperlink{a01368_ad7e34f32d4881e6bd7286bbdc4d6d2af}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par,}
\DoxyCodeLine{293                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt) \textcolor{keyword}{const}}
\DoxyCodeLine{294       -\/> ScalarType \{}
\DoxyCodeLine{295     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{296     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00345}{Dune}};}
\DoxyCodeLine{297     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01368_ae22f726fd67e4e7f1853b21fbbadff64}{displacementFunction}}(par, dx);}
\DoxyCodeLine{298     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps       = \mbox{\hyperlink{a01368_a30a59eb29567415909f3d6165ebf26d1}{strainFunction}}(par, dx);}
\DoxyCodeLine{299     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00315_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{300     ScalarType energy    = 0.0;}
\DoxyCodeLine{301 }
\DoxyCodeLine{302     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{303       \textcolor{keyword}{const} \textcolor{keyword}{auto} EVoigt         = (eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}))).eval();}
\DoxyCodeLine{304       \textcolor{keyword}{const} \textcolor{keyword}{auto} internalEnergy = \mbox{\hyperlink{a01368_a8907a656052a2353c2e5dc8d6e477bd9}{getInternalEnergy}}(EVoigt);}
\DoxyCodeLine{305       energy += internalEnergy * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{306     \}}
\DoxyCodeLine{307 }
\DoxyCodeLine{308     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{309     energy += \mbox{\hyperlink{a01336_a7ec1326b708d8c08fee05ca7b601f997}{VolumeType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{310 }
\DoxyCodeLine{311     \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{312     energy += \mbox{\hyperlink{a01332_a2576d38cb79bb0b5bf59f433fa7c1633}{TractionType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{313     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{314   \}}
\DoxyCodeLine{315 }
\DoxyCodeLine{316   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{317   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01368_aa36fb72f92ed5b674f56b434aedc8845}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368_a80b1ba5b790fd0a38cccd20439124d76}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{318                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{319     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{320     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00345}{Dune}};}
\DoxyCodeLine{321     \textcolor{keyword}{const} \textcolor{keyword}{auto} eps = \mbox{\hyperlink{a01368_a30a59eb29567415909f3d6165ebf26d1}{strainFunction}}(par, dx);}
\DoxyCodeLine{322 }
\DoxyCodeLine{323     \textcolor{comment}{// Internal forces}}
\DoxyCodeLine{324     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : eps.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{325       \textcolor{keyword}{const} \textcolor{keywordtype}{double} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{326       \textcolor{keyword}{const} \textcolor{keyword}{auto} EVoigt       = (eps.evaluate(gpIndex, on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}))).eval();}
\DoxyCodeLine{327       \textcolor{keyword}{const} \textcolor{keyword}{auto} stresses     = \mbox{\hyperlink{a01368_a58c79c2893de7f39b999e315f573b5f4}{getStress}}(EVoigt);}
\DoxyCodeLine{328       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{329         \textcolor{keyword}{const} \textcolor{keyword}{auto} bopI = eps.evaluateDerivative(gpIndex, wrt(coeff(i)), on(\mbox{\hyperlink{a01232_a986d3b0d39a10f702bddff51023d38ef}{gridElement}}));}
\DoxyCodeLine{330         force.template segment<myDim>(\mbox{\hyperlink{a01368_ab7c8d3171e7b10131419a284feefe4aa}{myDim}} * i) += bopI.transpose() * stresses * intElement;}
\DoxyCodeLine{331       \}}
\DoxyCodeLine{332     \}}
\DoxyCodeLine{333 }
\DoxyCodeLine{334     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{335     \mbox{\hyperlink{a01336_a9b91a057a51ab4487656d8bd94fdd234}{VolumeType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{336 }
\DoxyCodeLine{337     \textcolor{comment}{// External forces, boundary forces, i.e., at the Neumann boundary}}
\DoxyCodeLine{338     \mbox{\hyperlink{a01332_aabcfd5d855e2230fe90abb12a1ba8d2b}{TractionType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{339   \}}
\DoxyCodeLine{340 \};}
\DoxyCodeLine{341 \} \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{344 \textcolor{preprocessor}{  \#error NonLinearElastic depends on dune-\/localfefunctions, which is not included}}
\DoxyCodeLine{345 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
