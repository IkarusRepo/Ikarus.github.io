\hypertarget{a00146_source}{}\doxysection{flatassembler.\+hh}
\label{a00146_source}\index{flatassembler.hh@{flatassembler.hh}}
\mbox{\hyperlink{a00146}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/python/common/typeregistry.hh>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <dune/python/pybind11/eigen.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/python/pybind11/pybind11.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <dune/python/pybind11/stl.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <dune/python/pybind11/stl\_bind.h>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00305}{ikarus/assembler/dirichletbcenforcement.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00227}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a02717}{ikarus/utils/basis.hh}}>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00372}{Ikarus::Python}} \{}
\DoxyCodeLine{22 }
\DoxyCodeLine{40 \textcolor{keyword}{template} <\textcolor{keyword}{class }Assembler, \textcolor{keyword}{class}... options>}
\DoxyCodeLine{41 \textcolor{keywordtype}{void} \mbox{\hyperlink{a00352_ga87d3c6e620be5df59ba6923751caae86}{registerFlatAssembler}}(pybind11::handle scope, pybind11::class\_<Assembler, options...> cls) \{}
\DoxyCodeLine{42   \textcolor{keyword}{using }pybind11::operator\textcolor{stringliteral}{"{}"{}}\_a;}
\DoxyCodeLine{43   \textcolor{keyword}{using }FEContainer              = \textcolor{keyword}{typename} Assembler::FEContainer;}
\DoxyCodeLine{44   \textcolor{keyword}{using }Basis                    = \textcolor{keyword}{typename} Assembler::Basis;}
\DoxyCodeLine{45   \textcolor{keyword}{using }DirichletValuesType      = \textcolor{keyword}{typename} Assembler::DirichletValuesType;}
\DoxyCodeLine{46   \textcolor{keyword}{using }AffordanceCollectionType = \textcolor{keyword}{typename} Assembler::AffordanceCollectionType;}
\DoxyCodeLine{47   \textcolor{keyword}{using }FERequirementType        = \textcolor{keyword}{typename} Assembler::FERequirement;}
\DoxyCodeLine{48   cls.def(\mbox{\hyperlink{a00360_ac8243891c1b961e50a066140ab79a142}{pybind11::init}}([](\textcolor{keyword}{const} pybind11::list\& fes, \textcolor{keyword}{const} DirichletValuesType\& \mbox{\hyperlink{a00385_a453691a9a22118c4736e30240481a281}{dirichletValues}}) \{}
\DoxyCodeLine{49             \textcolor{comment}{/*here a copy of the whole vector of fes takes place! There is no way to prevent this if we want that}}
\DoxyCodeLine{50 \textcolor{comment}{             * the user can pass native python lists here, see}}
\DoxyCodeLine{51 \textcolor{comment}{             * https://pybind11.readthedocs.io/en/stable/advanced/cast/stl.html */}}
\DoxyCodeLine{52             FEContainer fesV = fes.template cast<FEContainer>();}
\DoxyCodeLine{53             \textcolor{keywordflow}{return} \textcolor{keyword}{new} Assembler(std::move(fesV), \mbox{\hyperlink{a00385_a453691a9a22118c4736e30240481a281}{dirichletValues}});}
\DoxyCodeLine{54           \}),}
\DoxyCodeLine{55           pybind11::keep\_alive<1, 3>());}
\DoxyCodeLine{56 }
\DoxyCodeLine{57   \textcolor{comment}{/* sparse matrices need to be copied to python therefore we remove the reference of the return type, see */}}
\DoxyCodeLine{58   \textcolor{comment}{/*  https://github.com/pybind/pybind11/blob/cbb876cc7b02c5f57e715cbc2c46ead3d1fbcf79/tests/test\_eigen\_matrix.cpp\#L332-\/L341}}
\DoxyCodeLine{59 \textcolor{comment}{   */}}
\DoxyCodeLine{60   cls.def(}
\DoxyCodeLine{61       \textcolor{stringliteral}{"{}matrix"{}},}
\DoxyCodeLine{62       [](Assembler\& self, \textcolor{keyword}{const} FERequirementType\& req, \mbox{\hyperlink{a00360_a390d5311179ec61d163a29c943b3d1a0}{Ikarus::MatrixAffordance}} affordance,}
\DoxyCodeLine{63          \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{Ikarus::DBCOption}} dbcOption) -\/> std::remove\_cvref\_t<\textcolor{keyword}{decltype}(self.matrix(req, affordance))> \{}
\DoxyCodeLine{64         \textcolor{keywordflow}{return} self.matrix(req, affordance, dbcOption);}
\DoxyCodeLine{65       \},}
\DoxyCodeLine{66       pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   cls.def(}
\DoxyCodeLine{69       \textcolor{stringliteral}{"{}matrix"{}}, [](Assembler\& self) -\/> std::remove\_cvref\_t<\textcolor{keyword}{decltype}(self.matrix())> \{ \textcolor{keywordflow}{return} self.matrix(); \},}
\DoxyCodeLine{70       pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{71 }
\DoxyCodeLine{72   cls.def(}
\DoxyCodeLine{73       \textcolor{stringliteral}{"{}matrix"{}},}
\DoxyCodeLine{74       [](Assembler\& self, \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{Ikarus::DBCOption}} dbcOption) -\/> std::remove\_cvref\_t<\textcolor{keyword}{decltype}(self.matrix(dbcOption))> \{}
\DoxyCodeLine{75         \textcolor{keywordflow}{return} self.matrix(dbcOption);}
\DoxyCodeLine{76       \},}
\DoxyCodeLine{77       pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{78 }
\DoxyCodeLine{79   cls.def(}
\DoxyCodeLine{80       \textcolor{stringliteral}{"{}vector"{}},}
\DoxyCodeLine{81       [](Assembler\& self, \textcolor{keyword}{const} FERequirementType\& req, \mbox{\hyperlink{a00360_aab9e3e38507d1db7602bc750718c302a}{Ikarus::VectorAffordance}} affordance,}
\DoxyCodeLine{82          \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{Ikarus::DBCOption}} dbcOption) \{ \textcolor{keywordflow}{return} self.vector(req, affordance, dbcOption); \},}
\DoxyCodeLine{83       pybind11::return\_value\_policy::reference);}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   cls.def(\textcolor{stringliteral}{"{}vector"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.vector(); \}, pybind11::return\_value\_policy::reference);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87   cls.def(}
\DoxyCodeLine{88       \textcolor{stringliteral}{"{}vector"{}}, [](Assembler\& self, \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{Ikarus::DBCOption}} dbcOption) \{ \textcolor{keywordflow}{return} self.vector(dbcOption); \},}
\DoxyCodeLine{89       pybind11::return\_value\_policy::reference);}
\DoxyCodeLine{90 }
\DoxyCodeLine{91   cls.def(}
\DoxyCodeLine{92       \textcolor{stringliteral}{"{}scalar"{}},}
\DoxyCodeLine{93       [](Assembler\& self, \textcolor{keyword}{const} FERequirementType\& req, \mbox{\hyperlink{a00360_af6f894084edd9109762b86222995ef2a}{Ikarus::ScalarAffordance}} affordance) \{}
\DoxyCodeLine{94         \textcolor{keywordflow}{return} self.scalar(req, affordance);}
\DoxyCodeLine{95       \},}
\DoxyCodeLine{96       pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   cls.def(\textcolor{stringliteral}{"{}scalar"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.scalar(); \}, pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   cls.def(}
\DoxyCodeLine{101       \textcolor{stringliteral}{"{}createFullVector"{}},}
\DoxyCodeLine{102       [](Assembler\& self, Eigen::Ref<const Eigen::VectorXd> redVec) \{ \textcolor{keywordflow}{return} self.createFullVector(redVec); \},}
\DoxyCodeLine{103       pybind11::return\_value\_policy::move);}
\DoxyCodeLine{104   cls.def(\textcolor{stringliteral}{"{}reducedSize"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.reducedSize(); \}, pybind11::return\_value\_policy::copy);}
\DoxyCodeLine{105   cls.def(\textcolor{stringliteral}{"{}bind"{}}, [](Assembler\& self, \textcolor{keyword}{const} FERequirementType\& req, AffordanceCollectionType affordance,}
\DoxyCodeLine{106                      \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{DBCOption}} dbcOption = \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eecabbd47109890259c0127154db1af26c75}{DBCOption::Full}}) \{ \textcolor{keywordflow}{return} self.bind(req, affordance, dbcOption); \});}
\DoxyCodeLine{107   cls.def(\textcolor{stringliteral}{"{}bind"{}}, [](Assembler\& self, \textcolor{keyword}{const} FERequirementType\& req) \{ \textcolor{keywordflow}{return} self.bind(req); \});}
\DoxyCodeLine{108   cls.def(\textcolor{stringliteral}{"{}bind"{}}, [](Assembler\& self, \textcolor{keyword}{const} AffordanceCollectionType affordance) \{ \textcolor{keywordflow}{return} self.bind(affordance); \});}
\DoxyCodeLine{109   cls.def(\textcolor{stringliteral}{"{}bind"{}}, [](Assembler\& self, \textcolor{keyword}{const} \mbox{\hyperlink{a00360_a9f83fad9f4c149f249165a13f2370eec}{DBCOption}} dbcOption) \{ \textcolor{keywordflow}{return} self.bind(dbcOption); \});}
\DoxyCodeLine{110   cls.def(\textcolor{stringliteral}{"{}bound"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.bound(); \});}
\DoxyCodeLine{111   cls.def(\textcolor{stringliteral}{"{}boundToRequirement"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.boundToRequirement(); \});}
\DoxyCodeLine{112   cls.def(\textcolor{stringliteral}{"{}boundToAffordanceCollection"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.boundToAffordanceCollection(); \});}
\DoxyCodeLine{113   cls.def(\textcolor{stringliteral}{"{}boundToDBCOption"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.boundToDBCOption(); \});}
\DoxyCodeLine{114   cls.def(\textcolor{stringliteral}{"{}requirement"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.requirement(); \});}
\DoxyCodeLine{115   cls.def(\textcolor{stringliteral}{"{}affordanceCollection"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.affordanceCollection(); \});}
\DoxyCodeLine{116   cls.def(\textcolor{stringliteral}{"{}dBCOption"{}}, [](Assembler\& self) \{ \textcolor{keywordflow}{return} self.dBCOption(); \});}
\DoxyCodeLine{117 \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{preprocessor}{\#define MAKE\_ASSEMBLER\_REGISTERY\_FUNCTION(name)                                              \(\backslash\)}}
\DoxyCodeLine{120 \textcolor{preprocessor}{  template <class Assembler, class... options>                                               \(\backslash\)}}
\DoxyCodeLine{121 \textcolor{preprocessor}{  void register\#\#name(pybind11::handle scope, pybind11::class\_<Assembler, options...> cls) \{ \(\backslash\)}}
\DoxyCodeLine{122 \textcolor{preprocessor}{    registerFlatAssembler(scope, cls);                                                       \(\backslash\)}}
\DoxyCodeLine{123 \textcolor{preprocessor}{  \}}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \mbox{\hyperlink{a00146_adda74d8564a01c0a9851a4379308a8b2}{MAKE\_ASSEMBLER\_REGISTERY\_FUNCTION}}(\mbox{\hyperlink{a01261}{SparseFlatAssembler}});}
\DoxyCodeLine{126 \mbox{\hyperlink{a00146_adda74d8564a01c0a9851a4379308a8b2}{MAKE\_ASSEMBLER\_REGISTERY\_FUNCTION}}(\mbox{\hyperlink{a01265}{DenseFlatAssembler}});}
\DoxyCodeLine{127 }
\DoxyCodeLine{128 \} \textcolor{comment}{// namespace Ikarus::Python}}

\end{DoxyCode}
