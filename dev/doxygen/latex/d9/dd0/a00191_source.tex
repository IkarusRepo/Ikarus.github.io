\hypertarget{a00191_source}{}\doxysection{pathfollowingtechnique.\+hh}
\label{a00191_source}\index{pathfollowingtechnique.hh@{pathfollowingtechnique.hh}}
\mbox{\hyperlink{a00191}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <Eigen/Core>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00185}{ikarus/controlroutines/adaptivestepsizing.hh}}>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00194}{ikarus/controlroutines/controlinfos.hh}}>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00188}{ikarus/controlroutines/pathfollowingfunctions.hh}}>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00068}{ikarus/linearalgebra/nonlinearoperator.hh}}>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00176}{ikarus/solver/nonlinearsolver/newtonraphsonwithscalarsubsidiaryfunction.hh}}>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00131}{ikarus/utils/observer/observer.hh}}>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00119}{ikarus/utils/observer/observermessages.hh}}>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00219}{Ikarus}} \{}
\DoxyCodeLine{19 }
\DoxyCodeLine{20   \textcolor{keyword}{template} <\textcolor{keyword}{typename} NonLinearSolver, \textcolor{keyword}{typename} PathFollowingType = \mbox{\hyperlink{a01097}{Ikarus::StandardArcLength}},}
\DoxyCodeLine{21             \textcolor{keyword}{typename} AdaptiveStepSizing = \mbox{\hyperlink{a01077}{Ikarus::AdaptiveStepSizing::NoOp}}>}
\DoxyCodeLine{22   \textcolor{keyword}{requires}((Concepts::PathFollowingStrategy<}
\DoxyCodeLine{23                PathFollowingType, \textcolor{keyword}{typename} NonLinearSolver::NonLinearOperator,}
\DoxyCodeLine{24                \mbox{\hyperlink{a01093}{Ikarus::SubsidiaryArgs}}>)and(Concepts::}
\DoxyCodeLine{25                                                AdaptiveStepSizingStrategy<}
\DoxyCodeLine{26                                                    AdaptiveStepSizing, \mbox{\hyperlink{a01309}{Ikarus::NonLinearSolverInformation}},}
\DoxyCodeLine{27                                                    \mbox{\hyperlink{a01093}{Ikarus::SubsidiaryArgs}},}
\DoxyCodeLine{28                                                    std::remove\_cvref\_t<typename NonLinearSolver::NonLinearOperator>>)}
\DoxyCodeLine{29            and (Concepts::NonLinearSolverCheckForPathFollowing<NonLinearSolver>)) class \mbox{\hyperlink{a01109}{PathFollowing}}}
\DoxyCodeLine{30       : public \mbox{\hyperlink{a01413}{IObservable}}<\mbox{\hyperlink{a00219}{Ikarus}}::\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893}{ControlMessages}}> \{}
\DoxyCodeLine{31   \textcolor{keyword}{public}:}
\DoxyCodeLine{32     \mbox{\hyperlink{a01109_ad5a2ab9877cc5f0377622693fd5db28e}{PathFollowing}}(\textcolor{keyword}{const} std::shared\_ptr<NonLinearSolver>\& p\_nonLinearSolver, \textcolor{keywordtype}{int} loadSteps, \textcolor{keywordtype}{double} stepSize,}
\DoxyCodeLine{33                   PathFollowingType p\_pathFollowingType   = \mbox{\hyperlink{a01097}{Ikarus::StandardArcLength}}\{\},}
\DoxyCodeLine{34                   AdaptiveStepSizing p\_adaptiveStepSizing = \{\})}
\DoxyCodeLine{35         : nonLinearSolver\{p\_nonLinearSolver\},}
\DoxyCodeLine{36           loadSteps\_\{loadSteps\},}
\DoxyCodeLine{37           stepSize\_\{stepSize\},}
\DoxyCodeLine{38           pathFollowingType\_\{p\_pathFollowingType\},}
\DoxyCodeLine{39           adaptiveStepSizing\{p\_adaptiveStepSizing\} \{\}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     \mbox{\hyperlink{a01085}{ControlInformation}} \mbox{\hyperlink{a01109_a92510c636426200fd881a72882e1f331}{run}}() \{}
\DoxyCodeLine{42       \mbox{\hyperlink{a01085}{ControlInformation}} info;}
\DoxyCodeLine{43       \textcolor{keyword}{auto}\& nonOp = nonLinearSolver-\/>nonLinearOperator();}
\DoxyCodeLine{44       this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a3fbccdb8d4ddfe10b3c9ee45ed07aad0}{ControlMessages::CONTROL\_STARTED}}, pathFollowingType\_.name);}
\DoxyCodeLine{45 }
\DoxyCodeLine{46       \mbox{\hyperlink{a01093}{SubsidiaryArgs}} subsidiaryArgs;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48       info.\mbox{\hyperlink{a01085_a4712b189651e59cd46fd43b2e6a326bf}{totalIterations}}    = 0;}
\DoxyCodeLine{49       subsidiaryArgs.\mbox{\hyperlink{a01093_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}} = stepSize\_;}
\DoxyCodeLine{50       subsidiaryArgs.\mbox{\hyperlink{a01093_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}.resizeLike(nonOp.firstParameter());}
\DoxyCodeLine{51       subsidiaryArgs.\mbox{\hyperlink{a01093_afc97f3ae46ddd6a208b90d253aa8a7e6}{DD}}.setZero();}
\DoxyCodeLine{52 }
\DoxyCodeLine{54       this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a18e0c9ecde68d13f1d2608dd1a180945}{ControlMessages::STEP\_STARTED}}, 0, subsidiaryArgs.\mbox{\hyperlink{a01093_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}});}
\DoxyCodeLine{55       \textcolor{keyword}{auto} subsidiaryFunctionPtr = [\&](\textcolor{keyword}{auto}\&\& args) \{ \textcolor{keywordflow}{return} pathFollowingType\_.evaluateSubsidiaryFunction(args); \};}
\DoxyCodeLine{56       pathFollowingType\_.initialPrediction(nonOp, subsidiaryArgs);}
\DoxyCodeLine{57       \textcolor{keyword}{auto} solverInfo = nonLinearSolver-\/>solve(subsidiaryFunctionPtr, subsidiaryArgs);}
\DoxyCodeLine{58       info.\mbox{\hyperlink{a01085_aedbd5de28f127726884cb99b067313bf}{solverInfos}}.push\_back(solverInfo);}
\DoxyCodeLine{59       info.\mbox{\hyperlink{a01085_a4712b189651e59cd46fd43b2e6a326bf}{totalIterations}} += solverInfo.iterations;}
\DoxyCodeLine{60       \textcolor{keywordflow}{if} (not solverInfo.success) \textcolor{keywordflow}{return} info;}
\DoxyCodeLine{61       this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a0d30d757bf062e88728ebe7f8e2b2577}{ControlMessages::SOLUTION\_CHANGED}});}
\DoxyCodeLine{62       this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893ae2b2386af3d7379bd2ddde735d5867b2}{ControlMessages::STEP\_ENDED}});}
\DoxyCodeLine{63 }
\DoxyCodeLine{65       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ls = 1; ls < loadSteps\_; ++ls) \{}
\DoxyCodeLine{66         subsidiaryArgs.\mbox{\hyperlink{a01093_a217c729e1ae8b05a98c852f19b0d6ae5}{currentStep}} = ls;}
\DoxyCodeLine{67 }
\DoxyCodeLine{68         adaptiveStepSizing(solverInfo, subsidiaryArgs, nonOp);}
\DoxyCodeLine{69 }
\DoxyCodeLine{70         this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a18e0c9ecde68d13f1d2608dd1a180945}{ControlMessages::STEP\_STARTED}}, subsidiaryArgs.\mbox{\hyperlink{a01093_a217c729e1ae8b05a98c852f19b0d6ae5}{currentStep}}, subsidiaryArgs.\mbox{\hyperlink{a01093_a9c0bca7ed999dcf751648d41b5d9aa78}{stepSize}});}
\DoxyCodeLine{71 }
\DoxyCodeLine{72         pathFollowingType\_.intermediatePrediction(nonOp, subsidiaryArgs);}
\DoxyCodeLine{73 }
\DoxyCodeLine{74         solverInfo = nonLinearSolver-\/>solve(subsidiaryFunctionPtr, subsidiaryArgs);}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         info.\mbox{\hyperlink{a01085_aedbd5de28f127726884cb99b067313bf}{solverInfos}}.push\_back(solverInfo);}
\DoxyCodeLine{77         info.\mbox{\hyperlink{a01085_a4712b189651e59cd46fd43b2e6a326bf}{totalIterations}} += solverInfo.iterations;}
\DoxyCodeLine{78         \textcolor{keywordflow}{if} (not solverInfo.success) \textcolor{keywordflow}{return} info;}
\DoxyCodeLine{79         this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a0d30d757bf062e88728ebe7f8e2b2577}{ControlMessages::SOLUTION\_CHANGED}});}
\DoxyCodeLine{80         this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893ae2b2386af3d7379bd2ddde735d5867b2}{ControlMessages::STEP\_ENDED}});}
\DoxyCodeLine{81       \}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83       this-\/>notify(\mbox{\hyperlink{a00219_a35fa62fd2d4186a9750af3d0692f2893a1c32d268de88f801deb25166d98a3938}{ControlMessages::CONTROL\_ENDED}}, info.\mbox{\hyperlink{a01085_a4712b189651e59cd46fd43b2e6a326bf}{totalIterations}}, pathFollowingType\_.name);}
\DoxyCodeLine{84       info.\mbox{\hyperlink{a01085_aaeccd3cd24ed5d809397ab055da1b695}{success}} = \textcolor{keyword}{true};}
\DoxyCodeLine{85       \textcolor{keywordflow}{return} info;}
\DoxyCodeLine{86     \}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88   \textcolor{keyword}{private}:}
\DoxyCodeLine{89     std::shared\_ptr<NonLinearSolver> nonLinearSolver;}
\DoxyCodeLine{90     \textcolor{keywordtype}{int} loadSteps\_;}
\DoxyCodeLine{91     \textcolor{keywordtype}{double} stepSize\_;}
\DoxyCodeLine{92     PathFollowingType pathFollowingType\_;}
\DoxyCodeLine{93     AdaptiveStepSizing adaptiveStepSizing;}
\DoxyCodeLine{94   \};}
\DoxyCodeLine{95 \}  \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
