\hypertarget{a00095_source}{}\doxysection{duneutilities.\+hh}
\label{a00095_source}\index{duneutilities.hh@{duneutilities.hh}}
\mbox{\hyperlink{a00095}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <Python.h>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <dune/fufem/dunepython.hh>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/functions/functionspacebases/basistags.hh>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <autodiff/forward/real/real.hpp>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a02465}{ikarus/utils/basis.hh}}>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00219}{Ikarus}} \{}
\DoxyCodeLine{18   \textcolor{keyword}{template} <\textcolor{keyword}{typename}... Args>}
\DoxyCodeLine{19   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_a77b24c9895c7d075f96a71b34a6df55c}{makeSharedBasis}}(Args\&\&... args) \{}
\DoxyCodeLine{20     \textcolor{keyword}{using namespace }Dune::Functions::BasisFactory;}
\DoxyCodeLine{21     \textcolor{keyword}{using }DuneBasis = \textcolor{keyword}{decltype}(\mbox{\hyperlink{a00219_a9a51c77ff0881c59e81e96c902b1fcd4}{makeBasis}}(std::forward<Args>(args)...));}
\DoxyCodeLine{22     \textcolor{keywordflow}{return} std::make\_shared<DuneBasis>(\mbox{\hyperlink{a00219_a9a51c77ff0881c59e81e96c902b1fcd4}{makeBasis}}(std::forward<Args>(args)...));}
\DoxyCodeLine{23   \}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25   \textcolor{keyword}{template} <\textcolor{keyword}{typename}... Args>}
\DoxyCodeLine{26   \textcolor{keyword}{auto} \mbox{\hyperlink{a00219_af298994b405b47b640d3f6bbab5f2bbb}{makeConstSharedBasis}}(Args\&\&... args) \{}
\DoxyCodeLine{27     \textcolor{keyword}{using namespace }Dune::Functions::BasisFactory;}
\DoxyCodeLine{28     \textcolor{keyword}{using }DuneBasis = \textcolor{keyword}{decltype}(\mbox{\hyperlink{a00219_a9a51c77ff0881c59e81e96c902b1fcd4}{makeBasis}}(std::forward<Args>(args)...));}
\DoxyCodeLine{29     \textcolor{keywordflow}{return} std::make\_shared<const DuneBasis>(\mbox{\hyperlink{a00219_a9a51c77ff0881c59e81e96c902b1fcd4}{makeBasis}}(std::forward<Args>(args)...));}
\DoxyCodeLine{30   \}}
\DoxyCodeLine{31 \}  \textcolor{comment}{// namespace Ikarus}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00231}{Python}} \{}
\DoxyCodeLine{34   \textcolor{comment}{// *****************************************************************************}}
\DoxyCodeLine{35   \textcolor{comment}{// specializations of Conversion that do the PyObject* <-\/> C++-\/type conversion}}
\DoxyCodeLine{36   \textcolor{comment}{// *****************************************************************************}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38   \textcolor{comment}{// conversion of autodiff::Real}}
\DoxyCodeLine{39   \textcolor{keyword}{template} <std::\textcolor{keywordtype}{size\_t} order, \textcolor{keyword}{class} T>}
\DoxyCodeLine{40   \textcolor{keyword}{struct }Conversion<autodiff::Real<order, T>> \{}
\DoxyCodeLine{41     \textcolor{keyword}{enum} \{ useDefaultConstructorConversion = \textcolor{keyword}{true} \};}
\DoxyCodeLine{42     \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{a01353_aab78500f06d24b5eb1cd894b68eec03c}{toC}}(PyObject* list, autodiff::Real<order, T>\& v) \{}
\DoxyCodeLine{43       \textcolor{keyword}{auto} rlist = Reference(Imp::inc(list));}
\DoxyCodeLine{44       \textcolor{comment}{// Reference is needed to enable the "{}.get()"{} function and "{}Imp::inc"{} is}}
\DoxyCodeLine{45       \textcolor{comment}{// needed since Reference owns the PyObject pointer and decrements it at the end of the scope}}
\DoxyCodeLine{46       \textcolor{comment}{// Imp::inc artificially increases the reference counter by one.}}
\DoxyCodeLine{47       \textcolor{comment}{// When we return from this function, these two cancel out and the PyObject* is as before}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49       \textcolor{keyword}{auto} wF = Callable(rlist.get(\textcolor{stringliteral}{"{}\_\_getitem\_\_"{}}));}
\DoxyCodeLine{50       \textcolor{keywordflow}{for} (std::size\_t i = 0; i < order + 1; ++i)}
\DoxyCodeLine{51         v[i] = PyFloat\_AsDouble(wF(i));}
\DoxyCodeLine{52     \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{keyword}{static} PyObject* \mbox{\hyperlink{a01353_ae7c12c134c747ccf36ff0bf9c453f69e}{toPy}}(\textcolor{keyword}{const} autodiff::Real<order, T>\& v) \{}
\DoxyCodeLine{55       \textcolor{keyword}{auto} pyMain           = Python::main();}
\DoxyCodeLine{56       Python::Module module = pyMain.import(\textcolor{stringliteral}{"{}autodiff"{}});}
\DoxyCodeLine{57 }
\DoxyCodeLine{58       \textcolor{keyword}{auto} real1stClass = module.get(\textcolor{stringliteral}{"{}real1st"{}});}
\DoxyCodeLine{59       \textcolor{keyword}{auto} real1st      = Callable(Imp::inc(real1stClass))();}
\DoxyCodeLine{60       \textcolor{keyword}{auto} wF           = Callable(Imp::inc(real1st).get(\textcolor{stringliteral}{"{}\_\_setitem\_\_"{}}));}
\DoxyCodeLine{61       \textcolor{keywordflow}{for} (std::size\_t i = 0; i < order + 1; ++i)}
\DoxyCodeLine{62         wF(i, v[i]);  \textcolor{comment}{// real1st.\_\_setitem\_\_(i,v[i]);}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64       \textcolor{keywordflow}{return} real1st;}
\DoxyCodeLine{65     \}}
\DoxyCodeLine{66   \};}
\DoxyCodeLine{67 \}  \textcolor{comment}{// namespace Python}}

\end{DoxyCode}
