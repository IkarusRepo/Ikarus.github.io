\hypertarget{a02487_source}{}\doxysection{finiteelements/mechanics/kirchhoffloveshell.hh}
\label{a02487_source}\index{kirchhoffloveshell.hh@{kirchhoffloveshell.hh}}
\mbox{\hyperlink{a02487}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <dune/fufem/boundarypatch.hh>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <dune/geometry/quadraturerules.hh>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/localfefunctions/cachedlocalBasis/cachedlocalBasis.hh>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <dune/localfefunctions/impl/standardLocalFunction.hh>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <dune/localfefunctions/manifolds/realTuple.hh>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00119}{ikarus/finiteelements/febases/powerbasisfe.hh}}>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00182}{ikarus/finiteelements/fehelper.hh}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00131}{ikarus/finiteelements/ferequirements.hh}}>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00173}{ikarus/finiteelements/mechanics/loads.hh}}>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00170}{ikarus/finiteelements/mechanics/materials.hh}}>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00179}{ikarus/finiteelements/mechanics/membranestrains.hh}}>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00125}{ikarus/finiteelements/physicshelper.hh}}>}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00316}{Ikarus}} \{}
\DoxyCodeLine{26 }
\DoxyCodeLine{38 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Basis\_, \textcolor{keyword}{typename} FERequirements\_ = FERequirements<>, \textcolor{keywordtype}{bool} useEigenRef = false>}
\DoxyCodeLine{39 \textcolor{keyword}{class }\mbox{\hyperlink{a01284}{KirchhoffLoveShell}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01216}{PowerBasisFE}}<typename Basis\_::FlatBasis>,}
\DoxyCodeLine{40                            \textcolor{keyword}{public} \mbox{\hyperlink{a01300}{Volume}}<KirchhoffLoveShell<Basis\_, FERequirements\_, useEigenRef>,}
\DoxyCodeLine{41                                          TraitsFromFE<Basis\_, FERequirements\_, useEigenRef>>,}
\DoxyCodeLine{42                            \textcolor{keyword}{public} \mbox{\hyperlink{a01296}{Traction}}<KirchhoffLoveShell<Basis\_, FERequirements\_, useEigenRef>,}
\DoxyCodeLine{43                                            TraitsFromFE<Basis\_, FERequirements\_, useEigenRef>>}
\DoxyCodeLine{44 \{}
\DoxyCodeLine{45 \textcolor{keyword}{public}:}
\DoxyCodeLine{46   \textcolor{keyword}{using }\mbox{\hyperlink{a01336}{Traits}}                 = \mbox{\hyperlink{a01336}{TraitsFromFE<Basis\_, FERequirements\_, useEigenRef>}};}
\DoxyCodeLine{47   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_af98e6a01ee535a71ad4b313e539350d9}{Basis}}                  = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_a6a750e6394db5c344790453319075dd4}{Traits::Basis}};}
\DoxyCodeLine{48   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_adcfabe21127d23b622c866763b0a2e06}{FlatBasis}}              = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_a4cd4d3b203993f8b5de5ca968bda0b97}{Traits::FlatBasis}};}
\DoxyCodeLine{49   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}      = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_ae29466435644541bf50d0f8fecbac1dd}{Traits::FERequirementType}};}
\DoxyCodeLine{50   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_abe0762d335f7a77f44e21ac8889c2317}{LocalView}}              = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_a36437741d63f3d325f363c8df4d2aac5}{Traits::LocalView}};}
\DoxyCodeLine{51   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_a3b65995044ee9ef12b0a61f2c10cd691}{Geometry}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_af8b05c9e9d401efcdb7d97e197b9fc1f}{Traits::Geometry}};}
\DoxyCodeLine{52   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_ab5ed269ad77b4a2e2e436fb81defca6f}{GridView}}               = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_ae15acf23e6cfbae7db57da6d4dd5ca80}{Traits::GridView}};}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_a3c23269e355c19d11ac92deceaebc4e1}{Element}}                = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_a179f7c62c0c2fef548d7ae31705de71e}{Traits::Element}};}
\DoxyCodeLine{54   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_a824edf6d65dea600f1c454604fec3a6f}{ResultRequirementsType}} = \textcolor{keyword}{typename} \mbox{\hyperlink{a01336_a5b3e19bb8aac79a0cceeacd20c021d97}{Traits::ResultRequirementsType}};}
\DoxyCodeLine{55   \textcolor{keyword}{using }\mbox{\hyperlink{a01216}{BasePowerFE}}            = \mbox{\hyperlink{a01216}{PowerBasisFE<FlatBasis>}}; \textcolor{comment}{// Handles globalIndices function}}
\DoxyCodeLine{56   \textcolor{keyword}{using }\mbox{\hyperlink{a01300}{VolumeType}}             = \mbox{\hyperlink{a01300}{Volume<KirchhoffLoveShell<Basis\_, FERequirements\_, useEigenRef>}}, \mbox{\hyperlink{a01336}{Traits}}>;}
\DoxyCodeLine{57   \textcolor{keyword}{using }\mbox{\hyperlink{a01296}{TractionType}}           = \mbox{\hyperlink{a01296}{Traction<KirchhoffLoveShell<Basis\_, FERequirements\_, useEigenRef>}}, \mbox{\hyperlink{a01336}{Traits}}>;}
\DoxyCodeLine{58   \textcolor{keyword}{using }\mbox{\hyperlink{a01284_aac3537d44f24e9ce48b080471bc0744b}{LocalBasisType}}         = \textcolor{keyword}{decltype}(std::declval<LocalView>().tree().child(0).finiteElement().localBasis());}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01284_a22273fa4834535f534e9dfab377aec83}{myDim}}              = \mbox{\hyperlink{a01336_a9e797097afc9ec86a072555b99778bf5}{Traits::mydim}};}
\DoxyCodeLine{61   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01284_ae10307f9b4c83ee2c8f4441a1eabe2f3}{worldDim}}           = \mbox{\hyperlink{a01336_a3505d89a76a85084fa84a196e212a64a}{Traits::worlddim}};}
\DoxyCodeLine{62   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01284_a28615c16c3294908775337438007dbff}{membraneStrainSize}} = 3;}
\DoxyCodeLine{63   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01284_aff4ce56707d43655851a80dc37f3f19b}{bendingStrainSize}}  = 3;}
\DoxyCodeLine{64 }
\DoxyCodeLine{74   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{75   \textcolor{keyword}{struct }\mbox{\hyperlink{a01288}{KinematicVariables}}}
\DoxyCodeLine{76   \{}
\DoxyCodeLine{77     Eigen::Matrix<double, 3, 3> \mbox{\hyperlink{a01288_ad316c22f4d476201d66dd916ce51579a}{C}};     }
\DoxyCodeLine{78     Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01288_adb0ea578820d6324bd697abf0103ceaf}{epsV}};   }
\DoxyCodeLine{79     Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01288_a385e50cb48b7f29f352913ef01e857ff}{kappaV}}; }
\DoxyCodeLine{80     Eigen::Matrix<ScalarType, 2, 3> \mbox{\hyperlink{a01288_a448b848a807d314c3d9b1a07bea0cc9e}{j}}; }
\DoxyCodeLine{81     Eigen::Matrix<double, 2, 3> \mbox{\hyperlink{a01288_a0ab087b4fe7a12f7cad0a0f2f1ab6bd3}{J}};     }
\DoxyCodeLine{82     Eigen::Matrix3<ScalarType> \mbox{\hyperlink{a01288_a5afc75ec69c2154ac00733db1fe5ea6f}{h}};      }
\DoxyCodeLine{83     Eigen::Matrix3<double> \mbox{\hyperlink{a01288_ad8bae2aebefb88c7d7888b14a58e0c22}{H}};          }
\DoxyCodeLine{84     Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01288_acd947bf70bae3f7ec5f58e679b19619e}{a3N}};    }
\DoxyCodeLine{85     Eigen::Vector3<ScalarType> \mbox{\hyperlink{a01288_a333dd0e23eb3fe1606a281a4f4620b05}{a3}};     }
\DoxyCodeLine{86   \};}
\DoxyCodeLine{87 }
\DoxyCodeLine{104   \textcolor{keyword}{template} <\textcolor{keyword}{typename} VolumeLoad = utils::LoadDefault, \textcolor{keyword}{typename} NeumannBoundaryLoad = utils::LoadDefault>}
\DoxyCodeLine{105   \mbox{\hyperlink{a01284_ae749b820da13eb29aafad5f0b704ea39}{KirchhoffLoveShell}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_af98e6a01ee535a71ad4b313e539350d9}{Basis}}\& globalBasis, \textcolor{keyword}{const} \textcolor{keyword}{typename} LocalView::Element\& element, \textcolor{keywordtype}{double} emod, \textcolor{keywordtype}{double} nu,}
\DoxyCodeLine{106                      \textcolor{keywordtype}{double} thickness, VolumeLoad p\_volumeLoad = \{\},}
\DoxyCodeLine{107                      \textcolor{keyword}{const} BoundaryPatch<GridView>* p\_neumannBoundary = \textcolor{keyword}{nullptr},}
\DoxyCodeLine{108                      NeumannBoundaryLoad p\_neumannBoundaryLoad        = \{\})}
\DoxyCodeLine{109       : \mbox{\hyperlink{a01284_aeaf83b598c252b329eca52e852768e0c}{BasePowerFE}}(globalBasis.flat(), element),}
\DoxyCodeLine{110         \mbox{\hyperlink{a01284_ad78f77e945ad60bf29d8d93c9a2a1ebe}{VolumeType}}(p\_volumeLoad),}
\DoxyCodeLine{111         \mbox{\hyperlink{a01284_afb43a5dc810fa4a4f0b5d078ef493c70}{TractionType}}(p\_neumannBoundary, p\_neumannBoundaryLoad),}
\DoxyCodeLine{112         emod\_\{emod\},}
\DoxyCodeLine{113         nu\_\{nu\},}
\DoxyCodeLine{114         thickness\_\{thickness\} \{}
\DoxyCodeLine{115     this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().bind(element);}
\DoxyCodeLine{116     \textcolor{keyword}{auto}\& first\_child = this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().tree().child(0);}
\DoxyCodeLine{117     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fe    = first\_child.finiteElement();}
\DoxyCodeLine{118     geo\_              = std::make\_shared<const Geometry>(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().\mbox{\hyperlink{a01284_af5dc455b63fa15beb17e93e1a118080c}{geometry}}());}
\DoxyCodeLine{119     numberOfNodes\_    = fe.size();}
\DoxyCodeLine{120     order\_            = 2 * (fe.localBasis().order());}
\DoxyCodeLine{121     localBasis        = Dune::CachedLocalBasis(fe.localBasis());}
\DoxyCodeLine{122     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{requires} \{ this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().getQuadratureRule(order\_); \})}
\DoxyCodeLine{123       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().impl().isTrimmed())}
\DoxyCodeLine{124         localBasis.bind(this-\/>localView().element().impl().getQuadratureRule(order\_), Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{125       \textcolor{keywordflow}{else}}
\DoxyCodeLine{126         localBasis.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), order\_),}
\DoxyCodeLine{127                         Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{128     \textcolor{keywordflow}{else}}
\DoxyCodeLine{129       localBasis.bind(Dune::QuadratureRules<double, myDim>::rule(this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}().element().type(), order\_),}
\DoxyCodeLine{130                       Dune::bindDerivatives(0, 1, 2));}
\DoxyCodeLine{131   \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133 \textcolor{keyword}{public}:}
\DoxyCodeLine{144   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType = \textcolor{keywordtype}{double}>}
\DoxyCodeLine{145   \textcolor{keyword}{auto} \mbox{\hyperlink{a01284_a350c17c18e3275ce3afdda767b841b7a}{displacementFunction}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& par,}
\DoxyCodeLine{146                             \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{147     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& d = par.getGlobalSolution(\mbox{\hyperlink{a00303_ggaea763c94a1cecbeefc4f8661debcc5a3a0c2d35f5f278a229db5ba41d40120f1c}{Ikarus::FESolutions::displacement}});}
\DoxyCodeLine{148     \textcolor{keyword}{auto} disp     = Ikarus::FEHelper::localSolutionBlockVector<Traits>(d, this-\/>\mbox{\hyperlink{a01216_a4b49c02de08fb5c115affa646c5f249a}{localView}}(), dx);}
\DoxyCodeLine{149     Dune::StandardLocalFunction uFunction(localBasis, disp, geo\_);}
\DoxyCodeLine{150     \textcolor{keywordflow}{return} uFunction;}
\DoxyCodeLine{151   \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   \textcolor{keyword}{const} \mbox{\hyperlink{a01284_a3b65995044ee9ef12b0a61f2c10cd691}{Geometry}}\& \mbox{\hyperlink{a01284_af5dc455b63fa15beb17e93e1a118080c}{geometry}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} *geo\_; \}}
\DoxyCodeLine{154   [[nodiscard]] \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01284_a44201ca55798fc660ed96933164db512}{numberOfNodes}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} numberOfNodes\_; \}}
\DoxyCodeLine{155   [[nodiscard]] \textcolor{keywordtype}{int} \mbox{\hyperlink{a01284_a9c160e6614cdf72561fc3f51ba0561ba}{order}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} order\_; \}}
\DoxyCodeLine{156 }
\DoxyCodeLine{165   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01284_adc4d072b60d55436de62651fb8af784d}{calculateScalar}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& req)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} calculateScalarImpl<double>(req); \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{174   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01284_a1ff594b2a01b8f20a2ff9f7dfa77a763}{calculateVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template VectorType<> force)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{175     calculateVectorImpl<double>(req, force);}
\DoxyCodeLine{176   \}}
\DoxyCodeLine{184   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01284_abfce8179210ee09d9b86c6444adf7f62}{calculateMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& req, \textcolor{keyword}{typename} Traits::template MatrixType<> K)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{185     calculateMatrixImpl<double>(req, K);}
\DoxyCodeLine{186   \}}
\DoxyCodeLine{187 }
\DoxyCodeLine{198   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01284_aadd4c3a051e2c530a9fa5ebb86417141}{calculateAt}}([[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01284_a824edf6d65dea600f1c454604fec3a6f}{ResultRequirementsType}}\& req,}
\DoxyCodeLine{199                    [[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{a01368}{Dune::FieldVector<double, Traits::mydim>}}\& local,}
\DoxyCodeLine{200                    [[maybe\_unused]] \mbox{\hyperlink{a01248}{ResultTypeMap<double>}}\& result)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{201     DUNE\_THROW(Dune::NotImplemented, \textcolor{stringliteral}{"{}No results are implemented"{}});}
\DoxyCodeLine{202   \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{204 \textcolor{keyword}{private}:}
\DoxyCodeLine{205   std::shared\_ptr<const Geometry> geo\_;}
\DoxyCodeLine{206   Dune::CachedLocalBasis<std::remove\_cvref\_t<LocalBasisType>> localBasis;}
\DoxyCodeLine{207   \mbox{\hyperlink{a01328}{DefaultMembraneStrain}} membraneStrain;}
\DoxyCodeLine{208   \textcolor{keywordtype}{double} emod\_;}
\DoxyCodeLine{209   \textcolor{keywordtype}{double} nu\_;}
\DoxyCodeLine{210   \textcolor{keywordtype}{double} thickness\_;}
\DoxyCodeLine{211   \textcolor{keywordtype}{size\_t} numberOfNodes\_\{0\};}
\DoxyCodeLine{212   \textcolor{keywordtype}{int} order\_\{\};}
\DoxyCodeLine{213 }
\DoxyCodeLine{214 \textcolor{keyword}{protected}:}
\DoxyCodeLine{234   \textcolor{keyword}{auto} \mbox{\hyperlink{a01284_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01368}{Dune::FieldVector<double, 2>}}\& gpPos, \textcolor{keywordtype}{int} gpIndex, \textcolor{keyword}{const} \mbox{\hyperlink{a01284_a3b65995044ee9ef12b0a61f2c10cd691}{Geometry}}\& geo,}
\DoxyCodeLine{235                                  \textcolor{keyword}{const} \textcolor{keyword}{auto}\& uFunction)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{236     \textcolor{keyword}{using }ScalarType = \textcolor{keyword}{typename} std::remove\_cvref\_t<\textcolor{keyword}{decltype}(uFunction)>::ctype;}
\DoxyCodeLine{237 }
\DoxyCodeLine{238     \mbox{\hyperlink{a01288}{KinematicVariables<ScalarType>}} kin;}
\DoxyCodeLine{239     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{240     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{241     \textcolor{keyword}{const} \textcolor{keyword}{auto} [X, Jd, Hd]              = geo\_-\/>impl().zeroFirstAndSecondDerivativeOfPosition(gpPos);}
\DoxyCodeLine{242     kin.J                               = toEigen(Jd);}
\DoxyCodeLine{243     kin.H                               = toEigen(Hd);}
\DoxyCodeLine{244     \textcolor{keyword}{const} Eigen::Matrix<double, 2, 2> A = kin.J * kin.J.transpose();}
\DoxyCodeLine{245     Eigen::Matrix<double, 3, 3> G       = Eigen::Matrix<double, 3, 3>::Zero();}
\DoxyCodeLine{246 }
\DoxyCodeLine{247     G.block<2, 2>(0, 0)                    = A;}
\DoxyCodeLine{248     G(2, 2)                                = 1;}
\DoxyCodeLine{249     \textcolor{keyword}{const} Eigen::Matrix<double, 3, 3> GInv = G.inverse();}
\DoxyCodeLine{250     kin.C                                  = \mbox{\hyperlink{a01284_aa135b5062856432512c7d29f1ff675b0}{materialTangent}}(GInv);}
\DoxyCodeLine{251 }
\DoxyCodeLine{252     kin.epsV = membraneStrain.\mbox{\hyperlink{a01328_acfe8c5424970d44c34005e13e851494a}{value}}(gpPos, geo, uFunction);}
\DoxyCodeLine{253 }
\DoxyCodeLine{254     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd                             = localBasis.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{255     \textcolor{keyword}{const} \textcolor{keyword}{auto} uasMatrix                        = \mbox{\hyperlink{a00311_gaf9d7cf401f9f03ce1aae728c646ce178}{Dune::viewAsEigenMatrixAsDynFixed}}(uFunction.coefficientsRef());}
\DoxyCodeLine{256     \textcolor{keyword}{const} \textcolor{keyword}{auto} hessianu                         = Ndd.transpose().template cast<ScalarType>() * uasMatrix;}
\DoxyCodeLine{257     kin.h                                       = kin.H + hessianu;}
\DoxyCodeLine{258     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 2> gradu = toEigen(uFunction.evaluateDerivative(}
\DoxyCodeLine{259         gpIndex, Dune::wrt(spatialAll), Dune::on(Dune::DerivativeDirections::referenceElement)));}
\DoxyCodeLine{260     kin.j                                       = kin.J + gradu.transpose();}
\DoxyCodeLine{261     kin.a3N                                     = (kin.j.row(0).cross(kin.j.row(1)));}
\DoxyCodeLine{262     kin.a3                                      = kin.a3N.normalized();}
\DoxyCodeLine{263     Eigen::Vector<ScalarType, 3> bV             = kin.h * kin.a3;}
\DoxyCodeLine{264     bV(2) *= 2; \textcolor{comment}{// Voigt notation requires the two here}}
\DoxyCodeLine{265     \textcolor{keyword}{const} \textcolor{keyword}{auto} BV = \mbox{\hyperlink{a00312_ga4304655095296ce9283e012587817a51}{toVoigt}}(toEigen(geo\_-\/>impl().secondFundamentalForm(gpPos)));}
\DoxyCodeLine{266     kin.kappaV    = BV -\/ bV;}
\DoxyCodeLine{267     \textcolor{keywordflow}{return} kin;}
\DoxyCodeLine{268   \}}
\DoxyCodeLine{269 }
\DoxyCodeLine{270   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{271   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01284_aab5382fc4bf1bac0f78dbd306a6ba010}{calculateMatrixImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template MatrixType<ScalarType> K,}
\DoxyCodeLine{272                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{273     K.setZero();}
\DoxyCodeLine{274     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{275     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{276     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01284_a350c17c18e3275ce3afdda767b841b7a}{displacementFunction}}(par, dx);}
\DoxyCodeLine{277     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{FEParameter::loadfactor}});}
\DoxyCodeLine{278 }
\DoxyCodeLine{279     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{280       \textcolor{keyword}{const} \textcolor{keyword}{auto} intElement = geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{281       \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, jE, J, h, H, a3N, a3] =}
\DoxyCodeLine{282           \mbox{\hyperlink{a01284_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, *geo\_, uFunction);}
\DoxyCodeLine{283       \textcolor{keyword}{const} Eigen::Vector<ScalarType, membraneStrainSize> membraneForces = thickness\_ * C * epsV;}
\DoxyCodeLine{284       \textcolor{keyword}{const} Eigen::Vector<ScalarType, bendingStrainSize> moments = Dune::power(thickness\_, 3) / 12.0 * C * kappaV;}
\DoxyCodeLine{285 }
\DoxyCodeLine{286       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Nd  = localBasis.evaluateJacobian(gpIndex);}
\DoxyCodeLine{287       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd = localBasis.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{288       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{289         Eigen::Matrix<ScalarType, membraneStrainSize, worldDim> bopIMembrane =}
\DoxyCodeLine{290             membraneStrain.\mbox{\hyperlink{a01328_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, *geo\_, uFunction, localBasis, i);}
\DoxyCodeLine{291 }
\DoxyCodeLine{292         Eigen::Matrix<ScalarType, bendingStrainSize, worldDim> bopIBending = \mbox{\hyperlink{a01284_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, i, a3N, a3);}
\DoxyCodeLine{293         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = i; j < numberOfNodes\_; ++j) \{}
\DoxyCodeLine{294           \textcolor{keyword}{auto} KBlock = K.template block<worldDim, worldDim>(\mbox{\hyperlink{a01284_ae10307f9b4c83ee2c8f4441a1eabe2f3}{worldDim}} * i, \mbox{\hyperlink{a01284_ae10307f9b4c83ee2c8f4441a1eabe2f3}{worldDim}} * j);}
\DoxyCodeLine{295           Eigen::Matrix<ScalarType, membraneStrainSize, worldDim> bopJMembrane =}
\DoxyCodeLine{296               membraneStrain.\mbox{\hyperlink{a01328_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, *geo\_, uFunction, localBasis, j);}
\DoxyCodeLine{297           Eigen::Matrix<ScalarType, bendingStrainSize, worldDim> bopJBending = \mbox{\hyperlink{a01284_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, j, a3N, a3);}
\DoxyCodeLine{298           KBlock += thickness\_ * bopIMembrane.transpose() * C * bopJMembrane * intElement;}
\DoxyCodeLine{299           KBlock += Dune::power(thickness\_, 3) / 12.0 * bopIBending.transpose() * C * bopJBending * intElement;}
\DoxyCodeLine{300 }
\DoxyCodeLine{301           Eigen::Matrix<ScalarType, worldDim, worldDim> kgMembraneIJ =}
\DoxyCodeLine{302               membraneStrain.\mbox{\hyperlink{a01328_a95cb97998e73fcf05fb7d9df0249b2e9}{secondDerivative}}(gp.position(), Nd, *geo\_, uFunction, localBasis, membraneForces, i, j);}
\DoxyCodeLine{303           Eigen::Matrix<ScalarType, worldDim, worldDim> kgBendingIJ = \mbox{\hyperlink{a01284_a1acdd9123a1e1268a5f990b5655a737c}{kgBending}}(jE, h, Nd, Ndd, a3N, a3, moments, i, j);}
\DoxyCodeLine{304           KBlock += kgMembraneIJ * intElement;}
\DoxyCodeLine{305           KBlock += kgBendingIJ * intElement;}
\DoxyCodeLine{306         \}}
\DoxyCodeLine{307       \}}
\DoxyCodeLine{308     \}}
\DoxyCodeLine{309     K.template triangularView<Eigen::StrictlyLower>() = K.transpose();}
\DoxyCodeLine{310 }
\DoxyCodeLine{311     \textcolor{comment}{// Update due to displacement-\/dependent external loads, e.g., follower loads}}
\DoxyCodeLine{312     \mbox{\hyperlink{a01300_a6903f5e92a06b8066ef67b6a1f22e142}{VolumeType::calculateMatrixImpl}}(par, K, dx);}
\DoxyCodeLine{313     \mbox{\hyperlink{a01296_aae1b4a04dd13b2ec2145ef141bf3190c}{TractionType::calculateMatrixImpl}}(par, K, dx);}
\DoxyCodeLine{314   \}}
\DoxyCodeLine{315 }
\DoxyCodeLine{316   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{317   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01284_a41a0a9873dd4107fd444250de72e99bc}{calculateVectorImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& par, \textcolor{keyword}{typename} Traits::template VectorType<ScalarType> force,}
\DoxyCodeLine{318                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{319     force.setZero();}
\DoxyCodeLine{320     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{321     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{322     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01284_a350c17c18e3275ce3afdda767b841b7a}{displacementFunction}}(par, dx);}
\DoxyCodeLine{323     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{FEParameter::loadfactor}});}
\DoxyCodeLine{324 }
\DoxyCodeLine{325     \textcolor{comment}{// Internal forces}}
\DoxyCodeLine{326     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{327       \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, jE, J, h, H, a3N, a3] =}
\DoxyCodeLine{328           \mbox{\hyperlink{a01284_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, *geo\_, uFunction);}
\DoxyCodeLine{329       \textcolor{keyword}{const} Eigen::Vector<ScalarType, 3> membraneForces = thickness\_ * C * epsV;}
\DoxyCodeLine{330       \textcolor{keyword}{const} Eigen::Vector<ScalarType, 3> moments        = Dune::power(thickness\_, 3) / 12.0 * C * kappaV;}
\DoxyCodeLine{331 }
\DoxyCodeLine{332       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Nd  = localBasis.evaluateJacobian(gpIndex);}
\DoxyCodeLine{333       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& Ndd = localBasis.evaluateSecondDerivatives(gpIndex);}
\DoxyCodeLine{334       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numberOfNodes\_; ++i) \{}
\DoxyCodeLine{335         Eigen::Matrix<ScalarType, 3, 3> bopIMembrane =}
\DoxyCodeLine{336             membraneStrain.\mbox{\hyperlink{a01328_a1c17239105e26dfdc369583624d8a200}{derivative}}(gp.position(), jE, Nd, *geo\_, uFunction, localBasis, i);}
\DoxyCodeLine{337         Eigen::Matrix<ScalarType, 3, 3> bopIBending = \mbox{\hyperlink{a01284_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(jE, h, Nd, Ndd, i, a3N, a3);}
\DoxyCodeLine{338         force.template segment<3>(3 * i) +=}
\DoxyCodeLine{339             bopIMembrane.transpose() * membraneForces * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{340         force.template segment<3>(3 * i) +=}
\DoxyCodeLine{341             bopIBending.transpose() * moments * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{342       \}}
\DoxyCodeLine{343     \}}
\DoxyCodeLine{344 }
\DoxyCodeLine{345     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{346     \mbox{\hyperlink{a01300_af2fc872a641d42398fc9d8bd60aa973c}{VolumeType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{347 }
\DoxyCodeLine{348     \textcolor{comment}{// External forces, boundary forces, i.e., at the Neumann boundary}}
\DoxyCodeLine{349     \mbox{\hyperlink{a01296_a0cac2c7cc2a06ae38bc83f97664e4d8c}{TractionType::calculateVectorImpl}}(par, force, dx);}
\DoxyCodeLine{350   \}}
\DoxyCodeLine{351 }
\DoxyCodeLine{352   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{353   \textcolor{keyword}{auto} \mbox{\hyperlink{a01284_a83c5d12a0591fce31bc29ea903156863}{calculateScalarImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01284_a6bf559258069202dfb9564448a95f856}{FERequirementType}}\& par,}
\DoxyCodeLine{354                            \textcolor{keyword}{const} std::optional<\textcolor{keyword}{const} Eigen::VectorX<ScalarType>>\& dx = std::nullopt) \textcolor{keyword}{const}}
\DoxyCodeLine{355       -\/> ScalarType \{}
\DoxyCodeLine{356     \textcolor{keyword}{using namespace }Dune::DerivativeDirections;}
\DoxyCodeLine{357     \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00321}{Dune}};}
\DoxyCodeLine{358     \textcolor{keyword}{const} \textcolor{keyword}{auto} uFunction = \mbox{\hyperlink{a01284_a350c17c18e3275ce3afdda767b841b7a}{displacementFunction}}(par, dx);}
\DoxyCodeLine{359     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& lambda   = par.getParameter(\mbox{\hyperlink{a00303_gga0c1577fd05efee8475b0f7fef795bbbeaf72bac0ac84c0315e7bcbb8aa84b2ff8}{Ikarus::FEParameter::loadfactor}});}
\DoxyCodeLine{360     ScalarType energy    = 0.0;}
\DoxyCodeLine{361 }
\DoxyCodeLine{362     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& [gpIndex, gp] : uFunction.viewOverIntegrationPoints()) \{}
\DoxyCodeLine{363       \textcolor{keyword}{const} \textcolor{keyword}{auto} [C, epsV, kappaV, j, J, h, H, a3N, a3] =}
\DoxyCodeLine{364           \mbox{\hyperlink{a01284_a02b95fb491292c3230a70d4ea77b85c8}{computeMaterialAndStrains}}(gp.position(), gpIndex, *geo\_, uFunction);}
\DoxyCodeLine{365 }
\DoxyCodeLine{366       \textcolor{keyword}{const} ScalarType membraneEnergy = 0.5 * thickness\_ * epsV.dot(C * epsV);}
\DoxyCodeLine{367       \textcolor{keyword}{const} ScalarType bendingEnergy  = 0.5 * Dune::power(thickness\_, 3) / 12.0 * kappaV.dot(C * kappaV);}
\DoxyCodeLine{368       energy += (membraneEnergy + bendingEnergy) * geo\_-\/>integrationElement(gp.position()) * gp.weight();}
\DoxyCodeLine{369     \}}
\DoxyCodeLine{370 }
\DoxyCodeLine{371     \textcolor{comment}{// External forces volume forces over the domain}}
\DoxyCodeLine{372     energy += \mbox{\hyperlink{a01300_a38b6d9f88ad5734093413497e3ac7b29}{VolumeType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{373 }
\DoxyCodeLine{374     \textcolor{comment}{// line or surface loads, i.e., neumann boundary}}
\DoxyCodeLine{375     energy += \mbox{\hyperlink{a01296_a3b3de553171d016228f21cbac1e7f47d}{TractionType::calculateScalarImpl}}(par, dx);}
\DoxyCodeLine{376     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{377   \}}
\DoxyCodeLine{378 }
\DoxyCodeLine{379   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{380   Eigen::Matrix<ScalarType, 3, 3> \mbox{\hyperlink{a01284_a1acdd9123a1e1268a5f990b5655a737c}{kgBending}}(\textcolor{keyword}{const} Eigen::Matrix<ScalarType, 2, 3>\& jcur,}
\DoxyCodeLine{381                                             \textcolor{keyword}{const} Eigen::Matrix3<ScalarType>\& h, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddN,}
\DoxyCodeLine{382                                             \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3N, \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3,}
\DoxyCodeLine{383                                             \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& S, \textcolor{keywordtype}{int} I, \textcolor{keywordtype}{int} J)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{384     Eigen::Matrix<ScalarType, 3, 3> kg;}
\DoxyCodeLine{385     kg.setZero();}
\DoxyCodeLine{386 }
\DoxyCodeLine{387     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN1i = dN(I, 0);}
\DoxyCodeLine{388     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN1j = dN(J, 0);}
\DoxyCodeLine{389     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN2i = dN(I, 1);}
\DoxyCodeLine{390     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN2j = dN(J, 1);}
\DoxyCodeLine{391 }
\DoxyCodeLine{392     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> P =}
\DoxyCodeLine{393         1.0 / a3N.norm() * (Eigen::Matrix<double, 3, 3>::Identity() -\/ a3 * a3.transpose());}
\DoxyCodeLine{394 }
\DoxyCodeLine{395     \textcolor{keyword}{const} \textcolor{keyword}{auto} a1dxI = Eigen::Matrix<double, 3, 3>::Identity() *}
\DoxyCodeLine{396                        dN1i; \textcolor{comment}{// the auto here allows the exploitation of the identity matrices,}}
\DoxyCodeLine{397     \textcolor{comment}{// due to Eigen's expression templates}}
\DoxyCodeLine{398     \textcolor{keyword}{const} \textcolor{keyword}{auto} a2dxI                            = Eigen::Matrix<double, 3, 3>::Identity() * dN2i;}
\DoxyCodeLine{399     \textcolor{keyword}{const} \textcolor{keyword}{auto} a1dxJ                            = Eigen::Matrix<double, 3, 3>::Identity() * dN1j;}
\DoxyCodeLine{400     \textcolor{keyword}{const} \textcolor{keyword}{auto} a2dxJ                            = Eigen::Matrix<double, 3, 3>::Identity() * dN2j;}
\DoxyCodeLine{401     \textcolor{keyword}{const} \textcolor{keyword}{auto} a1                               = jcur.row(0);}
\DoxyCodeLine{402     \textcolor{keyword}{const} \textcolor{keyword}{auto} a2                               = jcur.row(1);}
\DoxyCodeLine{403     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdI = a1dxI.colwise().cross(a2) -\/ a2dxI.colwise().cross(a1);}
\DoxyCodeLine{404     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdJ = a1dxJ.colwise().cross(a2) -\/ a2dxJ.colwise().cross(a1);}
\DoxyCodeLine{405     Eigen::Matrix<ScalarType, 3, 3> a3dI        = P * a3NdI;}
\DoxyCodeLine{406     Eigen::Matrix<ScalarType, 3, 3> a3dJ        = P * a3NdJ;}
\DoxyCodeLine{407     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{}
\DoxyCodeLine{408       \textcolor{keyword}{const} \textcolor{keyword}{auto} a\_albe               = h.row(i).transpose();}
\DoxyCodeLine{409       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddNI                = ddN(I, i);}
\DoxyCodeLine{410       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddNJ                = ddN(J, i);}
\DoxyCodeLine{411       Eigen::Vector3<ScalarType> vecd = P * a\_albe;}
\DoxyCodeLine{412 }
\DoxyCodeLine{413       Eigen::Matrix<ScalarType, 3, 3> a3Ndd =}
\DoxyCodeLine{414           1.0 / a3N.squaredNorm() *}
\DoxyCodeLine{415           ((3 * a3 * a3.transpose() -\/ Eigen::Matrix<double, 3, 3>::Identity()) * (a3.dot(a\_albe)) -\/}
\DoxyCodeLine{416            a\_albe * a3.transpose() -\/ a3 * a\_albe.transpose());}
\DoxyCodeLine{417 }
\DoxyCodeLine{418       Eigen::Matrix<ScalarType, 3, 3> secondDerivativeDirectorIJ = \mbox{\hyperlink{a00311_ga1496a9776a583f8b09c4244a68453394}{skew}}(((dN2i * dN1j -\/ dN1i * dN2j) * vecd).eval());}
\DoxyCodeLine{419       kg -\/= (a3NdI.transpose() * a3Ndd * a3NdJ + secondDerivativeDirectorIJ + (ddNI * a3dJ + ddNJ * a3dI.transpose())) *}
\DoxyCodeLine{420             S[i] * (i == 2 ? 2 : 1);}
\DoxyCodeLine{421     \}}
\DoxyCodeLine{422 }
\DoxyCodeLine{423     \textcolor{keywordflow}{return} kg;}
\DoxyCodeLine{424   \}}
\DoxyCodeLine{425 }
\DoxyCodeLine{426   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ScalarType>}
\DoxyCodeLine{427   Eigen::Matrix<ScalarType, 3, 3> \mbox{\hyperlink{a01284_a90e0bb85ca10d2bb5b97f509cc973931}{bopBending}}(\textcolor{keyword}{const} Eigen::Matrix<ScalarType, 2, 3>\& jcur,}
\DoxyCodeLine{428                                              \textcolor{keyword}{const} Eigen::Matrix3<ScalarType>\& h, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dN, \textcolor{keyword}{const} \textcolor{keyword}{auto}\& ddN,}
\DoxyCodeLine{429                                              \textcolor{keyword}{const} \textcolor{keywordtype}{int} node, \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3N,}
\DoxyCodeLine{430                                              \textcolor{keyword}{const} Eigen::Vector3<ScalarType>\& a3)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{431     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a1dxI =}
\DoxyCodeLine{432         Eigen::Matrix<double, 3, 3>::Identity() * dN(node, 0); \textcolor{comment}{// this should be double}}
\DoxyCodeLine{433     \textcolor{comment}{// but the cross-\/product below complains otherwise}}
\DoxyCodeLine{434     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a2dxI = Eigen::Matrix<double, 3, 3>::Identity() * dN(node, 1);}
\DoxyCodeLine{435     \textcolor{keyword}{const} \textcolor{keyword}{auto} a1                               = jcur.row(0);}
\DoxyCodeLine{436     \textcolor{keyword}{const} \textcolor{keyword}{auto} a2                               = jcur.row(1);}
\DoxyCodeLine{437     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3NdI =}
\DoxyCodeLine{438         a1dxI.colwise().cross(a2) -\/ a2dxI.colwise().cross(a1); \textcolor{comment}{// minus needed since order has}}
\DoxyCodeLine{439     \textcolor{comment}{// to be swapped to get column-\/wise cross product working}}
\DoxyCodeLine{440     \textcolor{keyword}{const} Eigen::Matrix<ScalarType, 3, 3> a3d1 =}
\DoxyCodeLine{441         1.0 / a3N.norm() * (Eigen::Matrix<double, 3, 3>::Identity() -\/ a3 * a3.transpose()) * a3NdI;}
\DoxyCodeLine{442 }
\DoxyCodeLine{443     Eigen::Matrix<ScalarType, 3, 3> bop = -\/(h * a3d1 + (a3 * ddN.row(node)).\mbox{\hyperlink{a00316_ac2c6469be19ce4ef2e630bfa1c5a5e24}{transpose}}());}
\DoxyCodeLine{444     bop.row(2) *= 2;}
\DoxyCodeLine{445 }
\DoxyCodeLine{446     \textcolor{keywordflow}{return} bop;}
\DoxyCodeLine{447   \}}
\DoxyCodeLine{448 }
\DoxyCodeLine{449   Eigen::Matrix<double, 3, 3> \mbox{\hyperlink{a01284_aa135b5062856432512c7d29f1ff675b0}{materialTangent}}(\textcolor{keyword}{const} Eigen::Matrix<double, 3, 3>\& Aconv)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{450     \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambda   = emod\_ * nu\_ / ((1.0 + nu\_) * (1.0 -\/ 2.0 * nu\_));}
\DoxyCodeLine{451     \textcolor{keyword}{const} \textcolor{keywordtype}{double} mu       = emod\_ / (2.0 * (1.0 + nu\_));}
\DoxyCodeLine{452     \textcolor{keyword}{const} \textcolor{keywordtype}{double} lambdbar = 2.0 * lambda * mu / (lambda + 2.0 * mu);}
\DoxyCodeLine{453     Eigen::TensorFixedSize<double, Eigen::Sizes<3, 3, 3, 3>> moduli;}
\DoxyCodeLine{454     \textcolor{keyword}{const} \textcolor{keyword}{auto} AconvT = \mbox{\hyperlink{a00312_ga5cfd9d098384fb067d897b3c0499b447}{tensorView}}(Aconv, std::array<Eigen::Index, 2>(\{3, 3\}));}
\DoxyCodeLine{455     moduli = lambdbar * \mbox{\hyperlink{a00312_gab2cea9ac847cc3635812467c9d96ceb4}{dyadic}}(AconvT, AconvT).eval() + 2.0 * mu * symmetricFourthOrder<double>(Aconv, Aconv);}
\DoxyCodeLine{456 }
\DoxyCodeLine{457     \textcolor{keyword}{auto} C                          = \mbox{\hyperlink{a00312_ga4304655095296ce9283e012587817a51}{toVoigt}}(moduli);}
\DoxyCodeLine{458     Eigen::Matrix<double, 3, 3> C33 = C(\{0, 1, 5\}, \{0, 1, 5\});}
\DoxyCodeLine{459     \textcolor{keywordflow}{return} C33;}
\DoxyCodeLine{460   \}}
\DoxyCodeLine{461 \};}
\DoxyCodeLine{462 \} \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
